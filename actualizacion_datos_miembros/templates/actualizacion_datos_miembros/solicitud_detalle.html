{% extends "actualizacion_datos_miembros/base_actualizacion.html" %}
{% load static %}

{% block actualizacion_content %}

<!-- ═══════════════════════════════════════════════
     CONTROL BAR
     ═══════════════════════════════════════════════ -->
<div class="odoo-control-bar">
    <div class="odoo-control-left">
        <a href="{% url 'actualizacion_datos_miembros:solicitudes_lista' %}" class="odoo-btn odoo-btn-icon">
            <span class="material-icons">arrow_back</span>
        </a>

        <div class="odoo-breadcrumb">
            <a href="{% url 'actualizacion_datos_miembros:solicitudes_lista' %}" class="odoo-breadcrumb-link">Solicitudes</a>
            <span class="material-icons odoo-breadcrumb-sep">chevron_right</span>
            <span class="odoo-breadcrumb-current">Detalle #{{ s.pk }}</span>
        </div>
    </div>
</div>

<div class="odoo-page">

    <!-- ═══════════════════════════════════════════════
         HEADER
         ═══════════════════════════════════════════════ -->
    <div class="odoo-card odoo-card-header">
        <div class="odoo-card-header-left">
            <div class="odoo-avatar-icon">
                <span class="material-icons">description</span>
            </div>

            <div class="odoo-header-text">
                <div class="odoo-header-top">
                    <h1 class="odoo-title">Solicitud de Actualización</h1>

                    {% if s.estado == Estados.PENDIENTE %}
                        <span class="odoo-badge odoo-badge-warning">
                            <span class="material-icons">schedule</span>
                            Pendiente
                        </span>
                    {% elif s.estado == Estados.APLICADA %}
                        <span class="odoo-badge odoo-badge-success">
                            <span class="material-icons">check_circle</span>
                            Aplicada
                        </span>
                    {% elif s.estado == Estados.RECHAZADA %}
                        <span class="odoo-badge odoo-badge-danger">
                            <span class="material-icons">cancel</span>
                            Rechazada
                        </span>
                    {% endif %}
                </div>

                <div class="odoo-meta">
                    <div class="odoo-meta-item">
                        <span class="material-icons">person</span>
                        <span>{{ s.miembro.nombres }} {{ s.miembro.apellidos }}</span>
                    </div>

                    {% if s.miembro.codigo %}
                    <div class="odoo-meta-item">
                        <span class="material-icons">badge</span>
                        <span>{{ s.miembro.codigo }}</span>
                    </div>
                    {% endif %}

                    <div class="odoo-meta-item">
                        <span class="material-icons">event</span>
                        <span>{{ s.creado_en|date:"d/m/Y H:i" }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ═══════════════════════════════════════════════
         ACCIONES (Solo si pendiente)
         ═══════════════════════════════════════════════ -->
    {% if s.estado == Estados.PENDIENTE %}
    <div class="odoo-card odoo-actions">
        <div class="odoo-actions-row">

            <form method="post" action="{% url 'actualizacion_datos_miembros:solicitud_aplicar' s.pk %}">
                {% csrf_token %}
                <button type="submit" class="odoo-btn odoo-btn-primary">
                    <span class="material-icons">check</span>
                    Aplicar cambios
                </button>
            </form>

            <form method="post" action="{% url 'actualizacion_datos_miembros:solicitud_rechazar' s.pk %}" class="odoo-reject-form">
                {% csrf_token %}
                <div class="odoo-input-wrap">
                    <span class="material-icons">edit_note</span>
                    <input type="text" name="nota_admin" class="odoo-input" placeholder="Motivo del rechazo (opcional)">
                </div>
                <button type="submit" class="odoo-btn odoo-btn-danger">
                    <span class="material-icons">close</span>
                    Rechazar
                </button>
            </form>

        </div>

        <div class="odoo-hint">
            <span class="material-icons">info</span>
            Solo puedes aplicar o rechazar mientras esté en estado <strong>Pendiente</strong>.
        </div>
    </div>
    {% endif %}

    <!-- ═══════════════════════════════════════════════
         DATOS SOLICITADOS
         ═══════════════════════════════════════════════ -->
    <div class="odoo-card">
        <div class="odoo-section-head">
            <span class="material-icons">list_alt</span>
            <h2>Datos solicitados</h2>
        </div>

        <!-- Contacto -->
        <div class="odoo-section">
            <div class="odoo-section-title">
                <span class="material-icons">call</span>
                <h3>Información de contacto</h3>
            </div>

            <div class="odoo-grid">
                <div class="odoo-field">
                    <label>Teléfono</label>
                    <div class="odoo-value">{{ s.telefono|default:"—" }}</div>
                </div>
                <div class="odoo-field">
                    <label>WhatsApp</label>
                    <div class="odoo-value">{{ s.whatsapp|default:"—" }}</div>
                </div>
                <div class="odoo-field">
                    <label>Email</label>
                    <div class="odoo-value">{{ s.email|default:"—" }}</div>
                </div>
            </div>
        </div>

        <!-- Dirección -->
        <div class="odoo-section">
            <div class="odoo-section-title">
                <span class="material-icons">location_on</span>
                <h3>Dirección</h3>
            </div>

            <div class="odoo-grid">
                <div class="odoo-field odoo-col-span-2">
                    <label>Dirección</label>
                    <div class="odoo-value">{{ s.direccion|default:"—" }}</div>
                </div>
                <div class="odoo-field">
                    <label>Sector</label>
                    <div class="odoo-value">{{ s.sector|default:"—" }}</div>
                </div>
                <div class="odoo-field">
                    <label>Ciudad</label>
                    <div class="odoo-value">{{ s.ciudad|default:"—" }}</div>
                </div>
                <div class="odoo-field">
                    <label>Provincia</label>
                    <div class="odoo-value">{{ s.provincia|default:"—" }}</div>
                </div>
                <div class="odoo-field">
                    <label>Código postal</label>
                    <div class="odoo-value">{{ s.codigo_postal|default:"—" }}</div>
                </div>
            </div>
        </div>

        <!-- Trabajo -->
        <div class="odoo-section">
            <div class="odoo-section-title">
                <span class="material-icons">work</span>
                <h3>Información laboral</h3>
            </div>

            <div class="odoo-grid">
                <div class="odoo-field">
                    <label>Empleador</label>
                    <div class="odoo-value">{{ s.empleador|default:"—" }}</div>
                </div>
                <div class="odoo-field">
                    <label>Puesto</label>
                    <div class="odoo-value">{{ s.puesto|default:"—" }}</div>
                </div>
                <div class="odoo-field">
                    <label>Teléfono trabajo</label>
                    <div class="odoo-value">{{ s.telefono_trabajo|default:"—" }}</div>
                </div>
                <div class="odoo-field odoo-col-span-2">
                    <label>Dirección trabajo</label>
                    <div class="odoo-value">{{ s.direccion_trabajo|default:"—" }}</div>
                </div>
            </div>
        </div>

        <!-- Emergencia -->
        <div class="odoo-section">
            <div class="odoo-section-title">
                <span class="material-icons">warning_amber</span>
                <h3>Contacto de emergencia</h3>
            </div>

            <div class="odoo-grid">
                <div class="odoo-field">
                    <label>Nombre</label>
                    <div class="odoo-value">{{ s.contacto_emergencia_nombre|default:"—" }}</div>
                </div>
                <div class="odoo-field">
                    <label>Teléfono</label>
                    <div class="odoo-value">{{ s.contacto_emergencia_telefono|default:"—" }}</div>
                </div>
                <div class="odoo-field">
                    <label>Relación</label>
                    <div class="odoo-value">{{ s.contacto_emergencia_relacion|default:"—" }}</div>
                </div>
            </div>
        </div>

        <!-- Salud -->
        <div class="odoo-section odoo-section-last">
            <div class="odoo-section-title">
                <span class="material-icons">health_and_safety</span>
                <h3>Información médica</h3>
            </div>

            <div class="odoo-grid">
                <div class="odoo-field">
                    <label>Tipo de sangre</label>
                    <div class="odoo-value">{{ s.tipo_sangre|default:"—" }}</div>
                </div>
                <div class="odoo-field odoo-col-span-2">
                    <label>Alergias</label>
                    <div class="odoo-value">{{ s.alergias|default:"—" }}</div>
                </div>
                <div class="odoo-field odoo-col-span-2">
                    <label>Condiciones médicas</label>
                    <div class="odoo-value">{{ s.condiciones_medicas|default:"—" }}</div>
                </div>
                <div class="odoo-field odoo-col-span-2">
                    <label>Medicamentos</label>
                    <div class="odoo-value">{{ s.medicamentos|default:"—" }}</div>
                </div>
            </div>
        </div>

    </div>

    <!-- ═══════════════════════════════════════════════
         METADATA
         ═══════════════════════════════════════════════ -->
    <div class="odoo-footer-meta">
        <div class="odoo-footer-meta-item">
            <span class="material-icons">schedule</span>
            <span>Enviada: {{ s.creado_en|date:"d/m/Y H:i" }}</span>
        </div>
        {% if s.ip_origen %}
        <div class="odoo-footer-meta-item">
            <span class="material-icons">public</span>
            <span>IP: {{ s.ip_origen }}</span>
        </div>
        {% endif %}
    </div>

</div>

<style>
/* =====================================
   VARIABLES (derivadas de --color-primary)
   ===================================== */
:root{
    --odoo-primary: var(--color-primary);
    --odoo-primary-dark: var(--color-primary);
    --odoo-primary-soft: rgba(0,0,0,0.04);

    --odoo-text: #212529;
    --odoo-text-muted: #6c757d;
    --odoo-border: #e5e7eb;
    --odoo-bg: #ffffff;
    --odoo-bg-gray: #f6f7fb;

    --odoo-success: #22c55e;
    --odoo-success-bg: #dcfce7;

    --odoo-warning: #f59e0b;
    --odoo-warning-bg: #fef3c7;

    --odoo-danger: #ef4444;
    --odoo-danger-bg: #fee2e2;
}

/* Layout */
.odoo-page{
    padding: 18px;
    background: var(--odoo-bg-gray);
    min-height: calc(100vh - 60px);
}
.odoo-card{
    background: var(--odoo-bg);
    border: 1px solid var(--odoo-border);
    border-radius: 14px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    overflow: hidden;
    margin-bottom: 14px;
}
.odoo-card-header{
    padding: 18px 18px;
}
.odoo-card-header-left{
    display:flex;
    gap:14px;
    align-items:flex-start;
}
.odoo-avatar-icon{
    width: 54px;
    height: 54px;
    border-radius: 14px;
    display:flex;
    align-items:center;
    justify-content:center;
    background: color-mix(in srgb, var(--odoo-primary) 20%, white);
    border: 1px solid color-mix(in srgb, var(--odoo-primary) 25%, white);
}
.odoo-avatar-icon .material-icons{
    color: var(--odoo-primary);
    font-size: 26px;
}
.odoo-header-text{ flex:1; min-width:0; }
.odoo-header-top{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    flex-wrap:wrap;
}
.odoo-title{
    margin:0;
    font-size: 20px;
    font-weight: 800;
    color: var(--odoo-text);
}
.odoo-meta{
    margin-top: 10px;
    display:flex;
    gap:14px;
    flex-wrap:wrap;
}
.odoo-meta-item{
    display:flex;
    align-items:center;
    gap:6px;
    font-size: 13px;
    color: var(--odoo-text-muted);
}
.odoo-meta-item .material-icons{
    font-size: 18px;
    color: var(--odoo-primary);
}

/* Badges */
.odoo-badge{
    display:inline-flex;
    align-items:center;
    gap:6px;
    border-radius: 999px;
    padding: 7px 12px;
    font-weight: 700;
    font-size: 12px;
    border: 1px solid transparent;
    white-space: nowrap;
}
.odoo-badge .material-icons{ font-size: 16px; }
.odoo-badge-success{
    background: var(--odoo-success-bg);
    color: #166534;
    border-color: color-mix(in srgb, var(--odoo-success) 35%, white);
}
.odoo-badge-warning{
    background: var(--odoo-warning-bg);
    color: #92400e;
    border-color: color-mix(in srgb, var(--odoo-warning) 35%, white);
}
.odoo-badge-danger{
    background: var(--odoo-danger-bg);
    color: #991b1b;
    border-color: color-mix(in srgb, var(--odoo-danger) 35%, white);
}

/* Actions */
.odoo-actions{
    padding: 16px 18px;
}
.odoo-actions-row{
    display:flex;
    gap:12px;
    align-items:center;
    flex-wrap:wrap;
}
.odoo-reject-form{
    display:flex;
    gap:10px;
    flex:1;
    flex-wrap:wrap;
    justify-content:flex-end;
}
.odoo-input-wrap{
    position:relative;
    flex:1;
    min-width: 260px;
}
.odoo-input-wrap .material-icons{
    position:absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 18px;
    color: var(--odoo-text-muted);
}
.odoo-input{
    width:100%;
    padding: 10px 12px 10px 40px;
    border-radius: 12px;
    border: 1px solid var(--odoo-border);
    background: #fff;
    font-size: 14px;
}
.odoo-input:focus{
    outline:none;
    border-color: color-mix(in srgb, var(--odoo-primary) 55%, white);
    box-shadow: 0 0 0 3px color-mix(in srgb, var(--odoo-primary) 18%, white);
}

/* Buttons */
.odoo-btn{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    gap:8px;
    border-radius: 12px;
    padding: 10px 14px;
    font-weight: 800;
    font-size: 13px;
    cursor:pointer;
    border: 1px solid transparent;
    transition: transform .15s ease, box-shadow .15s ease, background .15s ease, border-color .15s ease;
    user-select:none;
}
.odoo-btn .material-icons{ font-size: 18px; }

.odoo-btn-primary{
    background: var(--odoo-primary);
    color: #fff;
    box-shadow: 0 8px 18px color-mix(in srgb, var(--odoo-primary) 35%, transparent);
}
.odoo-btn-primary:hover{
    transform: translateY(-1px);
    box-shadow: 0 10px 22px color-mix(in srgb, var(--odoo-primary) 45%, transparent);
}

.odoo-btn-danger{
    background: #fff;
    color: var(--odoo-danger);
    border-color: color-mix(in srgb, var(--odoo-danger) 40%, white);
}
.odoo-btn-danger:hover{
    background: color-mix(in srgb, var(--odoo-danger) 6%, white);
    transform: translateY(-1px);
}

.odoo-hint{
    margin-top: 12px;
    display:flex;
    gap:10px;
    align-items:flex-start;
    padding: 12px 12px;
    border-radius: 12px;
    background: #f8fafc;
    border: 1px solid var(--odoo-border);
    color: var(--odoo-text-muted);
    font-size: 13px;
}
.odoo-hint .material-icons{
    color: var(--odoo-primary);
    font-size: 18px;
    margin-top: 1px;
}

/* Sections */
.odoo-section-head{
    display:flex;
    gap:10px;
    align-items:center;
    padding: 16px 18px;
    border-bottom: 1px solid var(--odoo-border);
    background: #fff;
}
.odoo-section-head .material-icons{
    color: var(--odoo-primary);
}
.odoo-section-head h2{
    margin:0;
    font-size: 16px;
    font-weight: 900;
    color: var(--odoo-text);
}
.odoo-section{
    padding: 16px 18px;
    border-top: 1px solid var(--odoo-border);
}
.odoo-section-title{
    display:flex;
    gap:10px;
    align-items:center;
    margin-bottom: 12px;
}
.odoo-section-title .material-icons{
    color: var(--odoo-primary);
}
.odoo-section-title h3{
    margin:0;
    font-size: 14px;
    font-weight: 900;
    color: var(--odoo-text);
}

.odoo-grid{
    display:grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 12px;
}
.odoo-col-span-2{ grid-column: 1 / -1; }

.odoo-field label{
    display:block;
    font-size: 12px;
    font-weight: 800;
    color: var(--odoo-text-muted);
    letter-spacing: .2px;
    text-transform: uppercase;
    margin-bottom: 6px;
}
.odoo-value{
    padding: 11px 12px;
    border-radius: 12px;
    background: #f8fafc;
    border: 1px solid var(--odoo-border);
    color: var(--odoo-text);
    font-size: 14px;
    word-break: break-word;
}

/* Footer meta */
.odoo-footer-meta{
    display:flex;
    gap:14px;
    flex-wrap:wrap;
    padding: 12px 16px;
    border-radius: 12px;
    background: #fff;
    border: 1px solid var(--odoo-border);
}
.odoo-footer-meta-item{
    display:flex;
    gap:8px;
    align-items:center;
    font-size: 13px;
    color: var(--odoo-text-muted);
}
.odoo-footer-meta-item .material-icons{
    font-size: 18px;
    color: #94a3b8;
}

/* Responsive */
@media (max-width: 768px){
    .odoo-page{ padding: 14px; }
    .odoo-grid{ grid-template-columns: 1fr; }
    .odoo-col-span-2{ grid-column: auto; }
    .odoo-reject-form{ justify-content: stretch; }
    .odoo-btn{ width: 100%; }
    .odoo-input-wrap{ min-width: 100%; }
    .odoo-header-top{ justify-content: flex-start; }
}

</style>

{% endblock %}
