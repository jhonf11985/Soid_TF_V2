{% extends "actualizacion_datos_miembros/base_actualizacion.html" %}
{% load static %}

{% block actualizacion_content %}

<style>
.link-share-container {
  max-width: 560px;
  margin: 2rem auto;
  padding: 0 1rem;
}

.link-share-card {
  background: #fff;
  border-radius: 16px;
  box-shadow: 0 4px 24px rgba(0,0,0,0.08);
  overflow: hidden;
}

.link-share-header {
  background: linear-gradient(135deg, #0097a7 0%, #00796b 100%);
  padding: 2rem;
  text-align: center;
  color: #fff;
}

.link-share-header .icon-circle {
  width: 72px;
  height: 72px;
  background: rgba(255,255,255,0.2);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto 1rem;
}

.link-share-header .icon-circle .material-icons {
  font-size: 36px;
}

.link-share-header h2 {
  margin: 0 0 0.5rem;
  font-size: 1.5rem;
  font-weight: 600;
}

.link-share-header p {
  margin: 0;
  opacity: 0.9;
  font-size: 0.95rem;
}

/* Status card */
.status-card {
  margin: 1.5rem 1.5rem 0;
  padding: 1rem 1.25rem;
  background: #f8fafc;
  border-radius: 12px;
  border: 1px solid #e2e8f0;
}

.status-card-inner {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 1rem;
  flex-wrap: wrap;
}

.status-info h3 {
  margin: 0 0 0.5rem;
  font-size: 1rem;
  font-weight: 600;
  color: #334155;
}

.status-meta {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  flex-wrap: wrap;
}

.status-badge {
  display: inline-flex;
  align-items: center;
  gap: 0.25rem;
  padding: 0.25rem 0.75rem;
  border-radius: 20px;
  font-size: 0.8rem;
  font-weight: 500;
}

.status-badge .material-icons {
  font-size: 16px;
}

.status-badge-success {
  background: #dcfce7;
  color: #15803d;
}

.status-badge-danger {
  background: #fee2e2;
  color: #dc2626;
}

.status-date {
  font-size: 0.75rem;
  color: #64748b;
}

.status-actions form {
  display: inline;
}

.btn-status {
  display: inline-flex;
  align-items: center;
  gap: 0.35rem;
  padding: 0.5rem 1rem;
  border: none;
  border-radius: 8px;
  font-size: 0.85rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-status .material-icons {
  font-size: 18px;
}

.btn-status-danger {
  background: #fee2e2;
  color: #dc2626;
}

.btn-status-danger:hover {
  background: #fecaca;
}

.btn-status-primary {
  background: #0097a7;
  color: #fff;
}

.btn-status-primary:hover {
  background: #00838f;
}

.link-share-body {
  padding: 1.5rem;
}

.link-input-wrapper {
  display: flex;
  gap: 0.5rem;
  background: #f5f5f5;
  border: 2px solid #e0e0e0;
  border-radius: 12px;
  padding: 0.5rem;
  transition: border-color 0.2s;
}

.link-input-wrapper:focus-within {
  border-color: #0097a7;
}

.link-input-wrapper input {
  flex: 1;
  border: none;
  background: transparent;
  padding: 0.75rem;
  font-size: 0.95rem;
  color: #424242;
  outline: none;
  min-width: 0;
}

.btn-copy {
  display: flex;
  align-items: center;
  gap: 0.4rem;
  padding: 0.75rem 1.25rem;
  background: #0097a7;
  color: #fff;
  border: none;
  border-radius: 8px;
  font-size: 0.875rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
  white-space: nowrap;
}

.btn-copy:hover {
  background: #00838f;
  transform: translateY(-1px);
}

.btn-copy:active {
  transform: translateY(0);
}

.btn-copy.copied {
  background: #43a047;
}

.btn-copy .material-icons {
  font-size: 18px;
}

.divider {
  display: flex;
  align-items: center;
  margin: 1.25rem 0;
  color: #9e9e9e;
  font-size: 0.8rem;
}

.divider::before,
.divider::after {
  content: "";
  flex: 1;
  height: 1px;
  background: #e0e0e0;
}

.divider span {
  padding: 0 0.75rem;
}

.share-buttons {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.btn-share {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  padding: 0.75rem 1.25rem;
  border: none;
  border-radius: 10px;
  font-size: 0.9rem;
  font-weight: 500;
  text-decoration: none;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-whatsapp {
  background: #25d366;
  color: #fff;
}

.btn-whatsapp:hover {
  background: #1ebe5d;
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(37, 211, 102, 0.25);
}

.btn-share .material-icons {
  font-size: 18px;
}

.link-share-footer {
  background: #fafafa;
  padding: 1rem 1.5rem;
  border-top: 1px solid #eee;
}

.footer-note {
  display: flex;
  align-items: flex-start;
  gap: 0.6rem;
  color: #757575;
  font-size: 0.8rem;
  line-height: 1.5;
}

.footer-note .material-icons {
  font-size: 18px;
  color: #0097a7;
  flex-shrink: 0;
  margin-top: 1px;
}

/* Toast notification */
.toast {
  position: fixed;
  bottom: 1.5rem;
  left: 50%;
  transform: translateX(-50%) translateY(100px);
  background: #323232;
  color: #fff;
  padding: 0.875rem 1.25rem;
  border-radius: 8px;
  font-size: 0.85rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  opacity: 0;
  transition: all 0.3s ease;
  z-index: 1000;
  max-width: calc(100vw - 2rem);
}

.toast.show {
  transform: translateX(-50%) translateY(0);
  opacity: 1;
}

.toast .material-icons {
  color: #4caf50;
  font-size: 20px;
}

/* Responsive */
@media (max-width: 480px) {
  .link-share-container {
    margin: 1rem auto;
    padding: 0 0.75rem;
  }
  
  .link-share-header {
    padding: 1.5rem 1rem;
  }
  
  .link-share-header .icon-circle {
    width: 60px;
    height: 60px;
  }
  
  .link-share-header .icon-circle .material-icons {
    font-size: 28px;
  }
  
  .link-share-header h2 {
    font-size: 1.25rem;
  }
  
  .link-share-header p {
    font-size: 0.875rem;
  }
  
  .status-card {
    margin: 1rem 1rem 0;
    padding: 0.875rem 1rem;
  }
  
  .status-card-inner {
    flex-direction: column;
    align-items: stretch;
    gap: 0.875rem;
  }
  
  .status-actions {
    width: 100%;
  }
  
  .status-actions .btn-status {
    width: 100%;
    justify-content: center;
  }
  
  .link-share-body {
    padding: 1.25rem 1rem;
  }
  
  .link-input-wrapper {
    flex-direction: column;
    padding: 0.375rem;
  }
  
  .link-input-wrapper input {
    padding: 0.625rem 0.75rem;
    font-size: 0.875rem;
  }
  
  .btn-copy {
    justify-content: center;
    padding: 0.75rem;
  }
  
  .btn-share {
    padding: 0.75rem 1rem;
  }
  
  .link-share-footer {
    padding: 1rem;
  }
}
</style>

<div class="link-share-container">
  <div class="link-share-card">
    
    <div class="link-share-header">
      <div class="icon-circle">
        <span class="material-icons">link</span>
      </div>
      <h2>Link de registro público</h2>
      <p>Comparte este enlace para inscribir nuevos miembros</p>
    </div>
    
    <div class="status-card">
      <div class="status-card-inner">
        <div class="status-info">
          <h3>Alta masiva</h3>
          <div class="status-meta">
            {% if config.activo %}
              <span class="status-badge status-badge-success">
                <span class="material-icons">lock_open</span> Activa
              </span>
            {% else %}
              <span class="status-badge status-badge-danger">
                <span class="material-icons">lock</span> Cerrada
              </span>
            {% endif %}
            <span class="status-date">
              Últ. act.: {{ config.actualizado_en|date:"d/m/Y H:i" }}
            </span>
          </div>
        </div>
        <div class="status-actions">
          {% if config.activo %}
            <form method="post">
              {% csrf_token %}
              <input type="hidden" name="accion" value="cerrar">
              <button type="submit" class="btn-status btn-status-danger">
                <span class="material-icons">lock</span> Cerrar alta
              </button>
            </form>
          {% else %}
            <form method="post">
              {% csrf_token %}
              <input type="hidden" name="accion" value="abrir">
              <button type="submit" class="btn-status btn-status-primary">
                <span class="material-icons">lock_open</span> Activar alta
              </button>
            </form>
          {% endif %}
        </div>
      </div>
    </div>

    <div class="link-share-body">
      <div class="link-input-wrapper">
        <input type="text" 
               value="{{ public_url }}" 
               readonly 
               id="alta-link-input"
               onclick="this.select()">
        <button class="btn-copy" onclick="copiarLink()" id="btn-copy">
          <span class="material-icons" id="copy-icon">content_copy</span>
          <span id="copy-text">Copiar</span>
        </button>
      </div>
      
      <div class="divider">
        <span>o comparte directamente</span>
      </div>
      
      <div class="share-buttons">
        <a class="btn-share btn-whatsapp"
           target="_blank"
           href="https://wa.me/?text=Regístrate%20aquí:%20{{ public_url|urlencode }}">
          <span class="material-icons">whatsapp</span>
          Enviar por WhatsApp
        </a>
      </div>
    </div>
    
    <div class="link-share-footer">
      <div class="footer-note">
        <span class="material-icons">info</span>
        <span>
          Cada persona que complete el formulario generará una 
          <strong>solicitud de alta</strong> que podrás revisar y aprobar.
        </span>
      </div>
    </div>
    
  </div>
</div>

<div class="toast" id="toast">
  <span class="material-icons">check_circle</span>
  <span>¡Link copiado!</span>
</div>

<script>
function copiarLink() {
  const input = document.getElementById("alta-link-input");
  const btn = document.getElementById("btn-copy");
  const icon = document.getElementById("copy-icon");
  const text = document.getElementById("copy-text");
  
  navigator.clipboard.writeText(input.value).then(() => {
    btn.classList.add("copied");
    icon.textContent = "check";
    text.textContent = "¡Copiado!";
    
    const toast = document.getElementById("toast");
    toast.classList.add("show");
    
    setTimeout(() => {
      btn.classList.remove("copied");
      icon.textContent = "content_copy";
      text.textContent = "Copiar";
      toast.classList.remove("show");
    }, 2000);
  }).catch(() => {
    input.select();
    input.setSelectionRange(0, 99999);
    document.execCommand("copy");
  });
}
</script>

{% endblock %}