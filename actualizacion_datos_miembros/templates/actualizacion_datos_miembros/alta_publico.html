<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Registro de Miembro</title>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --color-primary: {{ CFG.color_primario|default:"#0097a7" }};
            --color-primary-dark: #00838f;
            --color-primary-soft: #e0f7fa;
            --color-bg: #f5f5f7;
            --color-surface: #ffffff;
            --color-text-main: #111827;
            --color-text-muted: #6b7280;
            --color-border: #e5e7eb;
            --color-error: #ef4444;
            --radius-soft: 12px;
        }

        body {
            font-family: 'Poppins', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, var(--color-primary) 0%, #5c9ead 50%, #5c9ead 100%);
            min-height: 100vh;
            padding: 40px 20px;
            position: relative;
        }

        body::before {
            content: '';
            position: absolute;
            inset: 0;
            background-image:
                radial-gradient(circle at 20% 80%, rgba(255,255,255,0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255,255,255,0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .form-container {
            max-width: 600px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        /* ═══════════════════════════════════════
           LOGO INSTITUCIONAL
           ═══════════════════════════════════════ */
        .brand-top {
            display: flex;
            justify-content: center;
            margin-bottom: 22px;
        }

        .church-logo {
            max-height: 72px;
            object-fit: contain;
            filter: drop-shadow(0 6px 14px rgba(0,0,0,0.15));
        }

        /* ═══════════════════════════════════════
           HEADER
           ═══════════════════════════════════════ */
        .form-header {
            text-align: center;
            margin-bottom: 28px;
        }

        .form-header h1 {
            font-size: 26px;
            font-weight: 700;
            color: #fff;
            margin-bottom: 6px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .form-header p {
            font-size: 14px;
            color: rgba(255,255,255,0.9);
        }

        /* ═══════════════════════════════════════
           CARD
           ═══════════════════════════════════════ */
        .form-card {
            background: var(--color-surface);
            border-radius: 20px;
            padding: 32px;
            box-shadow: 0 25px 60px rgba(0,0,0,0.15);
        }

        /* ═══════════════════════════════════════
           MENSAJE INSTITUCIONAL
           ═══════════════════════════════════════ */
        .message {
            display: flex;
            gap: 12px;
            padding: 16px;
            margin-bottom: 28px;
            border-radius: var(--radius-soft);
            background: var(--color-primary-soft);
            border: 1px solid var(--color-primary);
            color: var(--color-primary-dark);
            font-size: 13px;
            line-height: 1.6;
        }

        .message .material-icons {
            font-size: 22px;
            flex-shrink: 0;
        }

        .message strong {
            font-weight: 700;
        }

        .message-steps {
            display: flex;
            gap: 16px;
            margin-top: 12px;
            flex-wrap: wrap;
        }

        .message-step {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            font-weight: 500;
        }

        .message-step .step-num {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--color-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 600;
        }

        /* ═══════════════════════════════════════
           SECCIONES
           ═══════════════════════════════════════ */
        .form-section {
            margin-bottom: 28px;
        }

        .form-section:last-of-type {
            margin-bottom: 0;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--color-border);
        }

        .section-icon {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            background: var(--color-primary-soft);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .section-icon .material-icons {
            font-size: 20px;
            color: var(--color-primary);
        }

        .section-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--color-text-main);
            text-transform: uppercase;
            letter-spacing: 0.04em;
        }

        /* ═══════════════════════════════════════
           GRID DE CAMPOS
           ═══════════════════════════════════════ */
        .fields-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px 20px;
        }

        .fields-grid .full-width {
            grid-column: 1 / -1;
        }

        @media (max-width: 520px) {
            .fields-grid {
                grid-template-columns: 1fr;
            }
        }

        /* ═══════════════════════════════════════
           CAMPOS DE FORMULARIO
           ═══════════════════════════════════════ */
        .form-group {
            position: relative;
        }

        .form-label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
            color: var(--color-text-muted);
        }

        .form-label .required {
            color: var(--color-error);
        }

        .input-wrapper {
            position: relative;
        }

        .input-wrapper .material-icons {
            position: absolute;
            left: 0;
            bottom: 10px;
            font-size: 18px;
            color: var(--color-text-muted);
            pointer-events: none;
            transition: color 0.2s;
        }

        .input-wrapper:focus-within .material-icons {
            color: var(--color-primary);
        }

        input, select, textarea {
            width: 100%;
            padding: 10px 0 10px 32px;
            border: none;
            border-bottom: 2px solid var(--color-border);
            border-radius: 0;
            background: transparent;
            font-family: inherit;
            font-size: 14px;
            color: var(--color-text-main);
            transition: all 0.2s;
        }

        textarea {
            min-height: 60px;
            resize: vertical;
        }

        /* Icono en textarea alineado arriba */
        .input-wrapper:has(textarea) .material-icons {
            top: 12px;
            transform: none;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-bottom-color: var(--color-primary);
            box-shadow: none;
        }

        input::placeholder, textarea::placeholder {
            color: var(--color-text-muted);
            opacity: 0.7;
        }

        select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Cpath fill='%236b7280' d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0 center;
            background-color: transparent;
            padding-right: 28px;
        }

        /* Input file especial */
        input[type="file"] {
            padding: 8px 0 8px 32px;
        }

        input[type="file"]::file-selector-button {
            padding: 5px 10px;
            border-radius: 4px;
            border: 1px solid var(--color-primary);
            background: transparent;
            color: var(--color-primary);
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            margin-right: 10px;
            transition: all 0.2s;
        }

        input[type="file"]::file-selector-button:hover {
            background: var(--color-primary);
            color: white;
        }

        .hint {
            margin-top: 4px;
            font-size: 11px;
            color: var(--color-text-muted);
        }

        .field-error {
            margin-top: 4px;
            font-size: 11px;
            color: var(--color-error);
            font-weight: 600;
        }

        /* ═══════════════════════════════════════
           ALERTAS
           ═══════════════════════════════════════ */
        .alert-error {
            display: flex;
            gap: 12px;
            padding: 14px;
            border-radius: var(--radius-soft);
            background: #fee2e2;
            border: 1px solid #fecaca;
            color: #991b1b;
            font-size: 13px;
            line-height: 1.4;
            margin-bottom: 20px;
        }

        .alert-error .material-icons {
            font-size: 22px;
            flex-shrink: 0;
        }

        /* ═══════════════════════════════════════
           BOTÓN
           ═══════════════════════════════════════ */
        .submit-btn {
            width: 100%;
            margin-top: 28px;
            padding: 16px;
            border-radius: var(--radius-soft);
            border: none;
            background: linear-gradient(135deg, var(--color-primary), #5c9ead);
            color: #fff;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,151,167,0.3);
        }

        .submit-btn:active {
            transform: translateY(0);
        }

        /* ═══════════════════════════════════════
           FOOTER
           ═══════════════════════════════════════ */
        .form-footer {
            margin-top: 18px;
            padding-top: 18px;
            border-top: 1px solid var(--color-border);
            text-align: center;
            font-size: 12px;
            color: var(--color-text-muted);
        }

        .powered-by {
            margin-top: 22px;
            text-align: center;
            font-size: 11px;
            color: rgba(255,255,255,0.75);
        }
    </style>
</head>

<body>
<div class="form-container">

    <!-- LOGO INSTITUCIONAL -->
    <div class="brand-top">
        {% if CFG.logo %}
            <img src="{{ CFG.logo.url }}"
                 alt="{{ CFG.nombre_iglesia|default:'Iglesia' }}"
                 class="church-logo">
        {% endif %}
    </div>

    <div class="form-header">
        <h1>Registro de Miembro</h1>
        <p>Actualización y validación de información</p>
    </div>

    <div class="form-card">

        <!-- MENSAJE DE PROCESO -->
        <div class="message">
            <span class="material-icons">autorenew</span>
            <div>
                <strong>Proceso de registro automatizado</strong><br>
                Este formulario forma parte de un nuevo sistema digital que nos permite
                organizar mejor la información y dar seguimiento de forma responsable.
                <div class="message-steps">
                    <div class="message-step">
                        <span class="step-num">1</span>
                        <span>Envío de solicitud</span>
                    </div>
                    <div class="message-step">
                        <span class="step-num">2</span>
                        <span>Revisión del equipo</span>
                    </div>
                    <div class="message-step">
                        <span class="step-num">3</span>
                        <span>Integración al sistema</span>
                    </div>
                </div>
            </div>
        </div>

        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}

            {% if form.non_field_errors %}
            <div class="alert-error">
                <span class="material-icons">error</span>
                <div>
                    {% for err in form.non_field_errors %}
                        <div>{{ err }}</div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- ═══════════════════════════════════════
                 SECCIÓN: DATOS PERSONALES
                 ═══════════════════════════════════════ -->
            <div class="form-section">
                <div class="section-header">
                    <div class="section-icon">
                        <span class="material-icons">person</span>
                    </div>
                    <span class="section-title">Datos personales</span>
                </div>

                <div class="fields-grid">
                    <div class="form-group">
                        <label class="form-label" for="{{ form.nombres.id_for_label }}">
                            Nombres <span class="required">*</span>
                        </label>
                        <div class="input-wrapper">
                            <span class="material-icons">badge</span>
                            {{ form.nombres }}
                        </div>
                        {% if form.nombres.errors %}
                            <div class="field-error">{{ form.nombres.errors|striptags }}</div>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="{{ form.apellidos.id_for_label }}">
                            Apellidos <span class="required">*</span>
                        </label>
                        <div class="input-wrapper">
                            <span class="material-icons">badge</span>
                            {{ form.apellidos }}
                        </div>
                        {% if form.apellidos.errors %}
                            <div class="field-error">{{ form.apellidos.errors|striptags }}</div>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="{{ form.genero.id_for_label }}">
                            Género <span class="required">*</span>
                        </label>
                        <div class="input-wrapper">
                            <span class="material-icons">wc</span>
                            {{ form.genero }}
                        </div>
                        {% if form.genero.errors %}
                            <div class="field-error">{{ form.genero.errors|striptags }}</div>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="{{ form.fecha_nacimiento.id_for_label }}">
                            Fecha de nacimiento <span class="required">*</span>
                        </label>
                        <div class="input-wrapper">
                            <span class="material-icons">cake</span>
                            {{ form.fecha_nacimiento }}
                        </div>
                        {% if form.fecha_nacimiento.errors %}
                            <div class="field-error">{{ form.fecha_nacimiento.errors|striptags }}</div>
                        {% endif %}
                    </div>

                    <div class="form-group full-width">
                        <label class="form-label" for="{{ form.estado_miembro.id_for_label }}">
                            Estado en la iglesia <span class="required">*</span>
                        </label>
                        <div class="input-wrapper">
                            <span class="material-icons">verified_user</span>
                            {{ form.estado_miembro }}
                        </div>
                        {% if form.estado_miembro.errors %}
                            <div class="field-error">{{ form.estado_miembro.errors|striptags }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- ═══════════════════════════════════════
                 SECCIÓN: CONTACTO
                 ═══════════════════════════════════════ -->
            <div class="form-section">
                <div class="section-header">
                    <div class="section-icon">
                        <span class="material-icons">phone</span>
                    </div>
                    <span class="section-title">Contacto</span>
                </div>

                <div class="fields-grid">
                    <div class="form-group">
                        <label class="form-label" for="{{ form.telefono.id_for_label }}">
                            Teléfono <span class="required">*</span>
                        </label>
                        <div class="input-wrapper">
                            <span class="material-icons">phone_iphone</span>
                            {{ form.telefono }}
                        </div>
                        <div class="hint">Ejemplo: 809-123-4567</div>
                        {% if form.telefono.errors %}
                            <div class="field-error">{{ form.telefono.errors|striptags }}</div>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="{{ form.whatsapp.id_for_label }}">
                            WhatsApp
                        </label>
                        <div class="input-wrapper">
                            <span class="material-icons">chat</span>
                            {{ form.whatsapp }}
                        </div>
                        <div class="hint">Se genera automáticamente</div>
                        {% if form.whatsapp.errors %}
                            <div class="field-error">{{ form.whatsapp.errors|striptags }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- ═══════════════════════════════════════
                 SECCIÓN: DOCUMENTOS
                 ═══════════════════════════════════════ -->
            <div class="form-section">
                <div class="section-header">
                    <div class="section-icon">
                        <span class="material-icons">folder</span>
                    </div>
                    <span class="section-title">Documentos (opcional)</span>
                </div>

                <div class="fields-grid">
                    <div class="form-group">
                        <label class="form-label" for="{{ form.cedula.id_for_label }}">
                            Cédula
                        </label>
                        <div class="input-wrapper">
                            <span class="material-icons">credit_card</span>
                            {{ form.cedula }}
                        </div>
                        <div class="hint">Solo números, sin guiones</div>
                        {% if form.cedula.errors %}
                            <div class="field-error">{{ form.cedula.errors|striptags }}</div>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="{{ form.foto.id_for_label }}">
                            Foto
                        </label>
                        <div class="input-wrapper">
                            <span class="material-icons">photo_camera</span>
                            {{ form.foto }}
                        </div>
                        <div class="hint">Puede ser desde el móvil</div>
                        {% if form.foto.errors %}
                            <div class="field-error">{{ form.foto.errors|striptags }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- ═══════════════════════════════════════
                 SECCIÓN: UBICACIÓN
                 ═══════════════════════════════════════ -->
            <div class="form-section">
                <div class="section-header">
                    <div class="section-icon">
                        <span class="material-icons">location_on</span>
                    </div>
                    <span class="section-title">Ubicación (opcional)</span>
                </div>

                <div class="fields-grid">
                    <div class="form-group">
                        <label class="form-label" for="id_sector">
                            Sector
                        </label>
                        <div class="input-wrapper">
                            <span class="material-icons">place</span>
                            <select id="id_sector" name="sector">
                                <option value="">Selecciona tu sector</option>
                                <option value="21 de Enero">21 de Enero</option>
                                <option value="30 de Mayo">30 de Mayo</option>
                                <option value="Ana Melia">Ana Melia</option>
                                <option value="Anamuya">Anamuya</option>
                                <option value="Antonio Guzmán">Antonio Guzmán</option>
                                <option value="Brisas del Duey">Brisas del Duey</option>
                                <option value="Cristo Rey">Cristo Rey</option>
                                <option value="Don Celso">Don Celso</option>
                                <option value="Duarte">Duarte</option>
                                <option value="Juan Pablo Duarte">Juan Pablo Duarte</option>
                                <option value="El Bonao">El Bonao</option>
                                <option value="El Centro">El Centro</option>
                                <option value="El Chorro">El Chorro</option>
                                <option value="El Macao">El Macao</option>
                                <option value="El Obispado">El Obispado</option>
                                <option value="El Tamarindo">El Tamarindo</option>
                                <option value="La Altagracia">La Altagracia</option>
                                <option value="La Aviación">La Aviación</option>
                                <option value="La Cabrera">La Cabrera</option>
                                <option value="La Candelaria">La Candelaria</option>
                                <option value="La Ceiba del Salado">La Ceiba del Salado</option>
                                <option value="La Colonia">La Colonia</option>
                                <option value="La Cruz">La Cruz</option>
                                <option value="La Fe">La Fe</option>
                                <option value="La Laguna">La Laguna</option>
                                <option value="La Malena">La Malena</option>
                                <option value="La Mina">La Mina</option>
                                <option value="La Otra Banda">La Otra Banda</option>
                                <option value="Las Caobas">Las Caobas</option>
                                <option value="Las Flores">Las Flores</option>
                                <option value="Las Mercedes">Las Mercedes</option>
                                <option value="Los Platanitos">Los Platanitos</option>
                                <option value="Los Ríos">Los Ríos</option>
                                <option value="Los Sotos">Los Sotos</option>
                                <option value="Luisa Perla">Luisa Perla</option>
                                <option value="Mamá Tingó">Mamá Tingó</option>
                                <option value="Nazaret">Nazaret</option>
                                <option value="San Francisco">San Francisco</option>
                                <option value="San José">San José</option>
                                <option value="San Martín">San Martín</option>
                                <option value="San Pedro">San Pedro</option>
                                <option value="Santa Cruz">Santa Cruz</option>
                                <option value="Santana">Santana</option>
                                <option value="Savica">Savica</option>
                                <option value="Villa Cerro">Villa Cerro</option>
                                <option value="Villa Hortensia">Villa Hortensia</option>
                                <option value="Villa María">Villa María</option>
                                <option value="Villa Palmera">Villa Palmera</option>
                                <option value="Villa Progreso">Villa Progreso</option>
                                <option value="Yuma">Yuma</option>
                                <option value="Otro">Otro / No aparece en la lista</option>
                            </select>
                        </div>
                        {% if form.sector.errors %}
                            <div class="field-error">{{ form.sector.errors|striptags }}</div>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="{{ form.direccion.id_for_label }}">
                            Dirección
                        </label>
                        <div class="input-wrapper">
                            <span class="material-icons">home</span>
                            {{ form.direccion }}
                        </div>
                        {% if form.direccion.errors %}
                            <div class="field-error">{{ form.direccion.errors|striptags }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <button type="submit" class="submit-btn">
                <span class="material-icons">send</span>
                Enviar solicitud
            </button>

            <div class="form-footer">
                Tu información será revisada antes de ser aplicada.
            </div>
        </form>
    </div>

    <div class="powered-by">
        {{ CFG.nombre_iglesia|default:"Iglesia Torre Fuerte" }}
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const tel = document.getElementById("id_telefono");
    const wa  = document.getElementById("id_whatsapp");
    if (!tel || !wa) return;

    function digitsOnly(v) {
        return (v || "").replace(/\D/g, "");
    }

    function formatRD(d) {
        if (d.length === 11 && d.startsWith("1")) d = d.slice(1);
        d = d.slice(0, 10);

        const a = d.slice(0, 3);
        const b = d.slice(3, 6);
        const c = d.slice(6, 10);

        if (d.length <= 3) return a;
        if (d.length <= 6) return a + "-" + b;
        return a + "-" + b + "-" + c;
    }

    function toWhatsAppE164(d) {
        if (d.length === 11 && d.startsWith("1")) d = d.slice(1);
        d = d.slice(0, 10);

        if (d.length === 10 && /^(809|829|849)/.test(d)) {
            return "+1" + d;
        }
        return "";
    }

    function isValidRD(d) {
        if (d.length === 11 && d.startsWith("1")) d = d.slice(1);
        return d.length === 10 && /^(809|829|849)/.test(d);
    }

    function paintValidity(input, valid) {
        input.style.borderColor = valid ? "" : "var(--color-error)";
    }

    function syncFromTelefono() {
        const d = digitsOnly(tel.value);
        tel.value = formatRD(d);

        const dd = digitsOnly(tel.value);
        if (dd.length > 0) paintValidity(tel, isValidRD(dd));
        else paintValidity(tel, true);

        wa.value = toWhatsAppE164(dd);
    }

    wa.setAttribute("readonly", "readonly");
    wa.setAttribute("tabindex", "-1");

    tel.addEventListener("input", syncFromTelefono);
    tel.addEventListener("blur", syncFromTelefono);

    syncFromTelefono();
});
</script>
<script>
document.addEventListener("DOMContentLoaded", function () {
  const cedula = document.getElementById("id_cedula");
  if (!cedula) return;

  function onlyDigits(v) {
    return (v || "").replace(/\D/g, "").slice(0, 11);
  }

  function formatCedulaRD(d) {
    if (d.length <= 3) return d;
    if (d.length <= 10) return d.slice(0,3) + "-" + d.slice(3);
    return d.slice(0,3) + "-" + d.slice(3,10) + "-" + d.slice(10);
  }

  function isValidCedula(d) {
    return d.length === 11;
  }

  cedula.addEventListener("input", function () {
    const digits = onlyDigits(cedula.value);
    cedula.value = formatCedulaRD(digits);

    // Pintar error solo si escribió algo
    if (digits.length > 0 && !isValidCedula(digits)) {
      cedula.style.borderBottomColor = "var(--color-error)";
    } else {
      cedula.style.borderBottomColor = "";
    }
  });
});
</script>

</body>
</html>