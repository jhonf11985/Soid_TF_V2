{% extends 'finanzas_app/base_finanzas.html' %}
{% load static %}

{% block title %}Nuevo proveedor · Soid_Tf_2{% endblock %}

{% block finanzas_content %}

<div class="odoo-page">

    <!-- BARRA SUPERIOR -->
    <div class="odoo-topbar">
        <div class="odoo-topbar-left">
            <a href="{% url 'finanzas_app:proveedores_list' %}" class="odoo-back-link">
                <span class="material-icons">arrow_back</span>
            </a>
            <div class="odoo-breadcrumb">
                <span class="odoo-breadcrumb-parent">Proveedores</span>
                <span class="odoo-breadcrumb-separator">/</span>
                <span class="odoo-breadcrumb-current">Nuevo</span>
            </div>
        </div>
        <div class="odoo-topbar-right">
            <span class="odoo-record-count">Nuevo</span>
        </div>
    </div>

    <!-- BARRA DE ACCIONES -->
    <div class="odoo-actionbar">
        <div class="odoo-actionbar-left">
            <button type="submit" form="proveedor-form" class="odoo-btn odoo-btn-primary">
                Guardar
            </button>
            <a href="{% url 'finanzas_app:proveedores_list' %}" class="odoo-btn odoo-btn-secondary">
                Cancelar
            </a>
        </div>
    </div>

    <!-- FORMULARIO PRINCIPAL -->
    <div class="odoo-form-sheet">
        <form method="post" novalidate id="proveedor-form">
            {% csrf_token %}

            <!-- ERRORES GENERALES -->
            {% if form.non_field_errors %}
                <div class="odoo-form-errors">
                    {% for err in form.non_field_errors %}
                        <div class="odoo-error">{{ err }}</div>
                    {% endfor %}
                </div>
            {% endif %}

            <!-- CONTENIDO EN DOS COLUMNAS -->
            <div class="odoo-form-content">

                <!-- COLUMNA IZQUIERDA -->
                <div class="odoo-form-col">

                    <div class="odoo-field-separator">
                        <span>Identidad</span>
                    </div>

                    <div class="odoo-field-row">
                        <label>Nombre</label>
                        <div class="odoo-field-value">
                            {{ form.nombre }}
                            {% if form.nombre.errors %}<span class="odoo-error">{{ form.nombre.errors.0 }}</span>{% endif %}
                        </div>
                    </div>

                    <div class="odoo-field-row">
                        <label>Persona/Empresa</label>
                        <div class="odoo-field-value">
                            {{ form.tipo }}
                            {% if form.tipo.errors %}<span class="odoo-error">{{ form.tipo.errors.0 }}</span>{% endif %}
                        </div>
                    </div>

                    <div class="odoo-field-row">
                        <label>Tipo proveedor</label>
                        <div class="odoo-field-value">
                            {{ form.tipo_proveedor }}
                            {% if form.tipo_proveedor.errors %}<span class="odoo-error">{{ form.tipo_proveedor.errors.0 }}</span>{% endif %}
                            <span class="odoo-field-hint">Servicio (ej. sonido) o Consumibles (ej. papelería).</span>
                        </div>
                    </div>

                    <div class="odoo-field-row">
                        <label>Miembro</label>
                        <div class="odoo-field-value">
                            {{ form.miembro }}
                            {% if form.miembro.errors %}<span class="odoo-error">{{ form.miembro.errors.0 }}</span>{% endif %}
                            <span class="odoo-field-hint">Opcional. Útil si el proveedor es un miembro.</span>
                        </div>
                    </div>

                    <div class="odoo-field-separator" style="margin-top:10px;">
                        <span>Documento</span>
                    </div>

                    <div class="odoo-field-row">
                        <label>Tipo doc.</label>
                        <div class="odoo-field-value">
                            {{ form.tipo_documento }}
                            {% if form.tipo_documento.errors %}<span class="odoo-error">{{ form.tipo_documento.errors.0 }}</span>{% endif %}
                        </div>
                    </div>

                    <div class="odoo-field-row">
                        <label>Número</label>
                        <div class="odoo-field-value">
                            {{ form.documento }}
                            {% if form.documento.errors %}<span class="odoo-error">{{ form.documento.errors.0 }}</span>{% endif %}
                            <span class="odoo-field-hint">Guárdalo sin guiones. El sistema valida longitud.</span>
                        </div>
                    </div>

                </div>

                <!-- COLUMNA DERECHA -->
                <div class="odoo-form-col">

                    <div class="odoo-field-separator">
                        <span>Contacto</span>
                    </div>

                    <div class="odoo-field-row">
                        <label>Teléfono</label>
                        <div class="odoo-field-value">
                            {{ form.telefono }}
                            {% if form.telefono.errors %}<span class="odoo-error">{{ form.telefono.errors.0 }}</span>{% endif %}
                        </div>
                    </div>

                    <div class="odoo-field-row">
                        <label>Email</label>
                        <div class="odoo-field-value">
                            {{ form.email }}
                            {% if form.email.errors %}<span class="odoo-error">{{ form.email.errors.0 }}</span>{% endif %}
                        </div>
                    </div>

                    <div class="odoo-field-row">
                        <label>Dirección</label>
                        <div class="odoo-field-value">
                            {{ form.direccion }}
                            {% if form.direccion.errors %}<span class="odoo-error">{{ form.direccion.errors.0 }}</span>{% endif %}
                        </div>
                    </div>

                    <div class="odoo-field-separator" style="margin-top:10px;">
                        <span>Pago</span>
                    </div>

                    <div class="odoo-field-row">
                        <label>Días de pago</label>
                        <div class="odoo-field-value">
                            {{ form.plazo_dias_pago }}
                            {% if form.plazo_dias_pago.errors %}<span class="odoo-error">{{ form.plazo_dias_pago.errors.0 }}</span>{% endif %}
                            <span class="odoo-field-hint">Ej: 15 / 30 / 45. Se usa si la factura no trae vencimiento.</span>
                        </div>
                    </div>

                    <div class="odoo-field-row">
                        <label>Método</label>
                        <div class="odoo-field-value">
                            {{ form.metodo_pago_preferido }}
                            {% if form.metodo_pago_preferido.errors %}<span class="odoo-error">{{ form.metodo_pago_preferido.errors.0 }}</span>{% endif %}
                        </div>
                    </div>

                    <div class="odoo-field-separator" style="margin-top:10px;">
                        <span>Banco</span>
                    </div>

                    <div class="odoo-field-row">
                        <label>Banco</label>
                        <div class="odoo-field-value">
                            {{ form.banco }}
                            {% if form.banco.errors %}<span class="odoo-error">{{ form.banco.errors.0 }}</span>{% endif %}
                        </div>
                    </div>

                    <div class="odoo-field-row">
                        <label>Tipo cuenta</label>
                        <div class="odoo-field-value">
                            {{ form.tipo_cuenta }}
                            {% if form.tipo_cuenta.errors %}<span class="odoo-error">{{ form.tipo_cuenta.errors.0 }}</span>{% endif %}
                        </div>
                    </div>

                    <div class="odoo-field-row">
                        <label>Número cuenta</label>
                        <div class="odoo-field-value">
                            {{ form.numero_cuenta }}
                            {% if form.numero_cuenta.errors %}<span class="odoo-error">{{ form.numero_cuenta.errors.0 }}</span>{% endif %}
                        </div>
                    </div>

                    <div class="odoo-field-row">
                        <label>Titular</label>
                        <div class="odoo-field-value">
                            {{ form.titular_cuenta }}
                            {% if form.titular_cuenta.errors %}<span class="odoo-error">{{ form.titular_cuenta.errors.0 }}</span>{% endif %}
                            <span class="odoo-field-hint">Opcional si el titular es distinto al proveedor.</span>
                        </div>
                    </div>

                </div>

            </div>

            <!-- NOTAS + CONTROL (ANCHO COMPLETO) -->
            <div class="odoo-form-full">

                <div class="odoo-field-separator">
                    <span>Control</span>
                </div>

                <div class="odoo-field-row">
                    <label>Bloqueado</label>
                    <div class="odoo-field-value">
                        {{ form.bloqueado }}
                        {% if form.bloqueado.errors %}<span class="odoo-error">{{ form.bloqueado.errors.0 }}</span>{% endif %}
                        <span class="odoo-field-hint">Si está bloqueado, no se permiten nuevas cuentas por pagar.</span>
                    </div>
                </div>

                <div class="odoo-field-row">
                    <label>Activo</label>
                    <div class="odoo-field-value">
                        {{ form.activo }}
                        {% if form.activo.errors %}<span class="odoo-error">{{ form.activo.errors.0 }}</span>{% endif %}
                    </div>
                </div>

                <div class="odoo-field-row">
                    <label>Notas</label>
                    <div class="odoo-field-value">
                        {{ form.notas }}
                        {% if form.notas.errors %}<span class="odoo-error">{{ form.notas.errors.0 }}</span>{% endif %}
                        <span class="odoo-field-hint">Opcional. Información adicional sobre el proveedor.</span>
                    </div>
                </div>

            </div>

        </form>
    </div>

</div>

<script>
(function(){
    const metodo = document.getElementById("id_metodo_pago_preferido");
    const banco = document.getElementById("id_banco");
    const tipoCuenta = document.getElementById("id_tipo_cuenta");
    const numCuenta = document.getElementById("id_numero_cuenta");
    const titular = document.getElementById("id_titular_cuenta");

    function setRowDisabled(el, disabled){
        if(!el) return;
        const row = el.closest(".odoo-field-row");
        if(!row) return;

        row.classList.toggle("odoo-disabled", disabled);
        el.disabled = disabled;

        if(disabled){
            el.value = (el.tagName === "SELECT") ? "" : el.value;
        }
    }

    function toggleBanco(){
        const isTransfer = metodo && metodo.value === "transferencia";
        // Si no es transferencia, deshabilitamos (no ocultamos para que el usuario entienda)
        setRowDisabled(banco, !isTransfer);
        setRowDisabled(tipoCuenta, !isTransfer);
        setRowDisabled(numCuenta, !isTransfer);
        setRowDisabled(titular, !isTransfer);
    }

    if(metodo){
        metodo.addEventListener("change", toggleBanco);
        toggleBanco();
    }
})();
</script>

<style>
    /* (Tu CSS se mantiene casi igual; añadimos solo estas 2 clases) */
    .odoo-form-errors{
        padding: 12px 24px;
        border-bottom: 1px solid var(--odoo-border);
        background: #fff7f7;
    }
    .odoo-disabled{
        opacity: .55;
        pointer-events: auto;
    }
</style>

{% endblock %}
