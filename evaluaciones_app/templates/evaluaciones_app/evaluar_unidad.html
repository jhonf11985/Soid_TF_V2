{% extends "evaluaciones_app/base_evaluaciones.html" %}
{% load eval_tags %}

{% block evaluaciones_content %}

<form method="post">
  {% csrf_token %}

  <div style="margin-bottom:12px; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:10px;">
    <h2 style="margin:0; font-size:18px;">Evaluar unidad</h2>
    <input type="text" id="buscador" placeholder="Buscar miembro..." 
           style="padding:6px 10px; border:1px solid var(--border); border-radius:6px; width:200px;">
  </div>

  <table style="width:100%; border-collapse:collapse; font-family:Arial, sans-serif;">
    <thead>
      <tr>
        <th style="text-align:left; padding:10px; border-bottom:2px solid var(--border);">Miembro</th>
        <th style="text-align:center; padding:10px; border-bottom:2px solid var(--border);">Asistencia</th>
      </tr>
    </thead>

    <tbody id="tabla-miembros">
      {% for mem in membresias %}
        {% if mem.miembo_fk %}
          {% with m=mem.miembo_fk %}
            {% with ev=existentes|get_item:m.id %}
              <tr class="fila-miembro">
                <td style="padding:10px; border-bottom:1px solid var(--border);">
                  <div style="font-weight:700;">{{ m.nombres }} {{ m.apellidos }}</div>
                  <div class="text-muted" style="font-size:12px;">{{ m.codigo_miembro|default:"" }}</div>
                </td>
                <td style="padding:10px; border-bottom:1px solid var(--border); text-align:center;">
                  <select name="asistencia_{{ m.id }}" style="padding:6px 10px;">
                    {% for v in "12345" %}
                      <option value="{{ v }}" {% if ev and ev.asistencia|stringformat:"s" == v %}selected{% endif %}>{{ v }}</option>
                    {% endfor %}
                  </select>
                </td>
              </tr>
            {% endwith %}
          {% endwith %}
        {% endif %}
      {% endfor %}
    </tbody>
  </table>

  <div style="margin-top:15px; text-align:right;">
    <button type="submit" style="padding:8px 16px; border:none; background:#2563eb; color:white; border-radius:6px; cursor:pointer;">
      Guardar evaluaci√≥n
    </button>
  </div>

</form>

<script>
  const input = document.getElementById('buscador');
  const filas = document.querySelectorAll('.fila-miembro');
  input.addEventListener('input', () => {
    const q = (input.value || '').toLowerCase();
    filas.forEach(tr => {
      const text = tr.innerText.toLowerCase();
      tr.style.display = text.includes(q) ? '' : 'none';
    });
  });
</script>

{% endblock %}