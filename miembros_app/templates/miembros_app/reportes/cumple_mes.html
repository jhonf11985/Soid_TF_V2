{% extends 'core/reporte_base.html' %}



{% block title %}Cumpleaños del mes{% endblock %}

{% block breadcrumb %}
Miembros / Reportes / Cumpleaños del mes
{% endblock %}
{% block content %}

<section class="page-header">
    <div>
        <h1 class="page-title">Cumpleaños del mes</h1>
        <p class="page-subtitle">
            Lista de cumpleaños para el mes de
            {{ nombre_mes|capfirst }} {{ anio }}.
        </p>
    </div>
</section>

<section class="page-section">

    <!-- Filtros -->
    <form method="get" class="form-grid" style="margin-bottom: 12px; align-items: flex-end;">

        <!-- Mes -->
        <div class="form-field">
            <label for="id_mes">Mes</label>
            <select id="id_mes" name="mes">
                <option value="1"  {% if mes == 1 %}selected{% endif %}>Enero</option>
                <option value="2"  {% if mes == 2 %}selected{% endif %}>Febrero</option>
                <option value="3"  {% if mes == 3 %}selected{% endif %}>Marzo</option>
                <option value="4"  {% if mes == 4 %}selected{% endif %}>Abril</option>
                <option value="5"  {% if mes == 5 %}selected{% endif %}>Mayo</option>
                <option value="6"  {% if mes == 6 %}selected{% endif %}>Junio</option>
                <option value="7"  {% if mes == 7 %}selected{% endif %}>Julio</option>
                <option value="8"  {% if mes == 8 %}selected{% endif %}>Agosto</option>
                <option value="9"  {% if mes == 9 %}selected{% endif %}>Septiembre</option>
                <option value="10" {% if mes == 10 %}selected{% endif %}>Octubre</option>
                <option value="11" {% if mes == 11 %}selected{% endif %}>Noviembre</option>
                <option value="12" {% if mes == 12 %}selected{% endif %}>Diciembre</option>
            </select>
        </div>

        <!-- Checkboxes compactos -->
        <div class="form-field form-field-full">
            <div style="display:flex; flex-wrap:wrap; gap:12px;">

                <!-- Solo activos -->
                <label style="display:flex; align-items:center; gap:6px; cursor:pointer;">
                    <input type="hidden" name="solo_activos" value="0">
                    <input
                        type="checkbox"
                        name="solo_activos"
                        value="1"
                        {% if solo_activos %}checked{% endif %}
                    >
                    Solo miembros activos
                </label>

                <!-- Solo oficiales -->
                <label style="display:flex; align-items:center; gap:6px; cursor:pointer;">
                    <input type="hidden" name="solo_oficiales" value="0">
                    <input
                        type="checkbox"
                        name="solo_oficiales"
                        value="1"
                        {% if solo_oficiales %}checked{% endif %}
                    >
                    Solo oficiales (≥ {{ EDAD_MINIMA_MIEMBRO_OFICIAL }} años)
                </label>

            </div>
        </div>

        <!-- Acciones -->
        <div class="form-actions" style="justify-content:flex-start; border-top:none; padding-top:0;">
            <button type="submit" class="btn-secondary">
                <span class="material-icons" style="font-size:16px;">search</span>
                Aplicar filtros
            </button>
            <button type="button" class="btn-secondary" onclick="window.print()">
                <span class="material-icons" style="font-size:16px;">print</span>
                Imprimir
            </button>
        </div>

        <!-- Resumen -->
        <div class="form-field form-field-full" style="margin-top:-4px; font-size:12px; color:#6b7280;">
            {% if miembros %}
                {{ miembros|length }} cumpleaños encontrados para {{ nombre_mes|capfirst }}.
            {% else %}
                No hay cumpleaños registrados para {{ nombre_mes|capfirst }}.
            {% endif %}
        </div>

    </form>

    <!-- Tabla -->
    <div class="table-wrapper">
        <table class="table">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Miembro</th>
                    <th>Cumpleaños</th>
                    <th>Edad actual</th>
                    <th>Cumple</th>
                    <th>Contacto</th>
                    <th>Estado</th>
                </tr>
            </thead>

            <tbody>
            {% if miembros %}
                {% for m in miembros %}
                <tr>
                    <td>{{ forloop.counter }}</td>

                    <!-- Miembro -->
                    <td>
                        <div style="font-weight:600; font-size:13px;">
                            <a href="{% url 'miembros_app:detalle' m.pk %}">
                                {{ m.nombres }} {{ m.apellidos }}
                            </a>
                        </div>
                        <div style="font-size:11px; color:#6b7280;">
                            {{ m.profesion|default:"Sin profesión registrada" }}
                        </div>
                    </td>

                    <!-- Cumpleaños -->
                    <td>
                        {% if m.fecha_nacimiento %}
                            {{ m.fecha_nacimiento|date:"d/m" }}
                        {% else %}
                            <span style="font-size:11px; color:#9ca3af;">—</span>
                        {% endif %}
                    </td>

                    <!-- Edad actual -->
                    <td>
                        {% if m.calcular_edad %}
                            {{ m.calcular_edad }} años
                        {% else %}
                            <span style="font-size:11px; color:#9ca3af;">—</span>
                        {% endif %}
                    </td>

                    <!-- Edad que cumple -->
                    <td>
                        {% if m.edad_que_cumple %}
                            <span style="
                                display:inline-block;
                                padding:2px 8px;
                                border-radius:999px;
                                background:#ecfdf3;
                                color:#166534;
                                font-size:11px;
                                font-weight:600;
                            ">
                                {{ m.edad_que_cumple }} años
                            </span>
                        {% else %}
                            <span style="font-size:11px; color:#9ca3af;">—</span>
                        {% endif %}
                    </td>

                    <!-- Contacto -->
                        <!-- Contacto -->
<td>
    {% if m.telefono or m.whatsapp %}
        <div style="font-size:12px;">
            {% if m.telefono %}
                {% with numero=m.telefono %}
                    {{ numero }}
                    <a href="https://wa.me/{{ numero|cut:' '|cut:'-' }}"
                       target="_blank"
                       title="Enviar WhatsApp">
                        <svg xmlns="http://www.w3.org/2000/svg"
                            width="13"
                            height="13"
                            viewBox="0 0 24 24"
                            style="margin-left:6px; fill:#6b7280;">
                            <path d="M12 2C6.486 2 2 6.486 2 12c0 1.86.507 3.599 1.387 5.106L2 22l5.043-1.356A9.93 9.93 0 0 0 12 22c5.514 0 10-4.486 10-10S17.514 2 12 2zm0 18a7.93 7.93 0 0 1-4.062-1.129l-.289-.172-2.999.807.802-2.92-.188-.3A7.924 7.924 0 0 1 4 12c0-4.411 3.589-8 8-8s8 3.589 8 8-3.589 8-8 8zm4.427-5.444c-.239-.119-1.415-.699-1.635-.777-.22-.08-.38-.119-.54.119-.159.239-.62.777-.76.936-.14.159-.28.18-.519.06-.239-.119-1.01-.372-1.926-1.185-.711-.633-1.192-1.414-1.332-1.653-.14-.239-.015-.368.105-.487.108-.108.239-.28.359-.419.119-.14.159-.239.239-.398.08-.159.04-.298-.02-.418-.06-.119-.539-1.298-.739-1.777-.195-.468-.394-.405-.539-.414l-.459-.008c-.159 0-.418.06-.638.298-.22.239-.839.82-.839 1.997 0 1.177.859 2.315.979 2.475.119.159 1.689 2.577 4.139 3.614.579.25 1.03.399 1.382.511.581.185 1.109.159 1.528.096.467-.069 1.415-.579 1.614-1.137.199-.557.199-1.037.139-1.137-.06-.099-.219-.159-.458-.278z"/>
                        </svg>
                    </a>
                {% endwith %}
            {% else %}
                {% with numero=m.whatsapp %}
                    {{ numero }}
                    <a href="https://wa.me/{{ numero|cut:' '|cut:'-' }}"
                        target="_blank"
                        title="Enviar WhatsApp">
                        <svg xmlns="http://www.w3.org/2000/svg"
                            width="13"
                            height="13"
                            viewBox="0 0 24 24"
                            style="margin-left:6px; fill:#6b7280;">
                            <path d="M12 2C6.486 2 2 6.486 2 12c0 1.86.507 3.599 1.387 5.106L2 22l5.043-1.356A9.93 9.93 0 0 0 12 22c5.514 0 10-4.486 10-10S17.514 2 12 2zm0 18a7.93 7.93 0 0 1-4.062-1.129l-.289-.172-2.999.807.802-2.92-.188-.3A7.924 7.924 0 0 1 4 12c0-4.411 3.589-8 8-8s8 3.589 8 8-3.589 8-8 8zm4.427-5.444c-.239-.119-1.415-.699-1.635-.777-.22-.08-.38-.119-.54.119-.159.239-.62.777-.76.936-.14.159-.28.18-.519.06-.239-.119-1.01-.372-1.926-1.185-.711-.633-1.192-1.414-1.332-1.653-.14-.239-.015-.368.105-.487.108-.108.239-.28.359-.419.119-.14.159-.239.239-.398.08-.159.04-.298-.02-.418-.06-.119-.539-1.298-.739-1.777-.195-.468-.394-.405-.539-.414l-.459-.008c-.159 0-.418.06-.638.298-.22.239-.839.82-.839 1.997 0 1.177.859 2.315.979 2.475.119.159 1.689 2.577 4.139 3.614.579.25 1.03.399 1.382.511.581.185 1.109.159 1.528.096.467-.069 1.415-.579 1.614-1.137.199-.557.199-1.037.139-1.137-.06-.099-.219-.159-.458-.278z"/>
                        </svg>
                    </a>
                {% endwith %}
            {% endif %}
        </div>
    {% endif %}

    {% if m.email %}
        <div style="font-size:12px;">{{ m.email }}</div>
    {% endif %}

    {% if not m.telefono and not m.whatsapp and not m.email %}
        <span style="font-size:11px; color:#6b7280;">Sin datos</span>
    {% endif %}
</td>


                    <!-- Estado -->
                    <td>
                        {% if not m.activo %}
                            <div style="
                                display:inline-block;
                                padding:2px 6px;
                                border-radius:999px;
                                background:#fee2e2;
                                color:#b91c1c;
                                font-size:11px;
                                font-weight:600;">
                                Inactivo
                            </div>
                        {% else %}
                            {% if m.estado_miembro %}
                                <div style="font-size:12px; font-weight:600; color:#111827;">
                                    {{ m.get_estado_miembro_display }}
                                </div>
                            {% else %}
                                <div style="font-size:11px; color:#6b7280;">Sin estado</div>
                            {% endif %}
                        {% endif %}
                    </td>

                </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="7" class="table-empty">
                        No se encontraron cumpleaños para este mes.
                    </td>
                </tr>
            {% endif %}
            </tbody>
        </table>
    </div>

</section>

<style>
@media print {
    .topbar,
    .main-nav,
    .footer,
    .form-actions,
    .form-grid,
    .page-header-actions {
        display: none !important;
    }

    .layout {
        margin: 0;
        max-width: 100%;
        padding: 0;
    }

    .page-section {
        box-shadow: none;
        border: none;
        padding: 0;
    }

    .page-title {
        font-size: 18px;
        margin-bottom: 4px;
    }

    .page-subtitle {
        font-size: 11px;
    }

    .table th,
    .table td {
        font-size: 11px;
        padding: 4px 4px;
    }
    @media print {
  .sidebar,
  .sidebar-nav,
  .layout-sidebar,
  .sidebar-wrapper {
    display: none !important;
  }
}

}
</style>

{% endblock %}
