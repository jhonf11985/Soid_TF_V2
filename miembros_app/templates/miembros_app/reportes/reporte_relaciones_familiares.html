{% extends 'core/base_modulo.html' %}

{% block title %}Familias de la Iglesia{% endblock %}

{% block breadcrumb %}
Miembros / Reportes / Familias
{% endblock %}

{% block content %}

<section class="page-header no-print">
    <div>
        <h1 class="page-title">Familias de la Iglesia</h1>
        <p class="page-subtitle">
            Análisis completo de relaciones familiares entre los miembros
        </p>
    </div>
    <div class="page-header-actions">
        <button type="button" class="btn-secondary" onclick="window.print()">
            <span class="material-icons">print</span>
            Imprimir
        </button>
    </div>
</section>

<section class="page-section">

    {# ═══════════════════════════════════════════════════════════════════════════ #}
    {# CABEZAL INSTITUCIONAL - SOLO IMPRESIÓN                                       #}
    {# ═══════════════════════════════════════════════════════════════════════════ #}
    <div class="print-header only-print">
        {% if CFG.logo %}
            <img src="{{ CFG.logo.url }}" alt="{{ CFG.nombre_iglesia|default:'Logo' }}" class="print-logo">
        {% endif %}
        <h2 class="print-church-name">
            {{ CFG.nombre_iglesia|default:'IGLESIA TORRE FUERTE'|upper }}
        </h2>
        {% if CFG.denominacion %}
            <div class="print-denomination">{{ CFG.denominacion }}</div>
        {% endif %}
        <div class="print-report-info">
            <strong>Reporte:</strong> Familias de la Iglesia &nbsp;·&nbsp;
            <strong>Fecha:</strong> {{ hoy|date:"d/m/Y" }}
        </div>
        <hr class="print-divider">
    </div>

    {# ═══════════════════════════════════════════════════════════════════════════ #}
    {# RESUMEN ESTADÍSTICO                                                          #}
    {# ═══════════════════════════════════════════════════════════════════════════ #}
    <div class="stats-grid no-print">
        <div class="stat-card stat-primary">
            <div class="stat-icon" style="background: #dbeafe;">
                <span class="material-icons" style="color: #2563eb;">account_tree</span>
            </div>
            <div class="stat-content">
                <span class="stat-value">{{ total_familias_extendidas }}</span>
                <span class="stat-label">Familias Extendidas</span>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon" style="background: #dcfce7;">
                <span class="material-icons" style="color: #16a34a;">family_restroom</span>
            </div>
            <div class="stat-content">
                <span class="stat-value">{{ total_familias_nucleares }}</span>
                <span class="stat-label">Familias Nucleares</span>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon" style="background: #fce7f3;">
                <span class="material-icons" style="color: #db2777;">favorite</span>
            </div>
            <div class="stat-content">
                <span class="stat-value">{{ total_parejas }}</span>
                <span class="stat-label">Parejas/Matrimonios</span>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon" style="background: #fef3c7;">
                <span class="material-icons" style="color: #d97706;">groups</span>
            </div>
            <div class="stat-content">
                <span class="stat-value">{{ total_personas_en_familias }}</span>
                <span class="stat-label">Personas en familias</span>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon" style="background: #e0e7ff;">
                <span class="material-icons" style="color: #6366f1;">child_care</span>
            </div>
            <div class="stat-content">
                <span class="stat-value">{{ total_hijos }}</span>
                <span class="stat-label">Hijos registrados</span>
            </div>
        </div>
    </div>

    {# ═══════════════════════════════════════════════════════════════════════════ #}
    {# FILTROS Y BÚSQUEDA                                                           #}
    {# ═══════════════════════════════════════════════════════════════════════════ #}
    <form method="get" class="filter-panel no-print">
        <div class="filter-row">
            <div class="filter-field" style="flex: 2;">
                <label for="id_q">
                    <span class="material-icons">search</span>
                    Buscar
                </label>
                <input type="text" id="id_q" name="q" 
                       placeholder="Apellido o nombre de cualquier miembro..." 
                       value="{{ query }}">
            </div>

            <div class="filter-field">
                <label for="id_tipo">
                    <span class="material-icons">filter_list</span>
                    Tipo de familia
                </label>
                <select id="id_tipo" name="tipo">
                    <option value="">Todas</option>
                    <option value="extendida" {% if tipo_filtro == 'extendida' %}selected{% endif %}>Solo Extendidas</option>
                    <option value="nuclear" {% if tipo_filtro == 'nuclear' %}selected{% endif %}>Solo Nucleares</option>
                    <option value="pareja" {% if tipo_filtro == 'pareja' %}selected{% endif %}>Solo Parejas</option>
                </select>
            </div>

            <div class="filter-actions-inline">
                <button type="submit" class="btn-primary">
                    <span class="material-icons">search</span>
                    Filtrar
                </button>
                {% if query or tipo_filtro %}
                <a href="{% url 'miembros_app:reporte_relaciones_familiares' %}" class="btn-secondary">
                    <span class="material-icons">clear</span>
                    Limpiar
                </a>
                {% endif %}
            </div>
        </div>
        
        {% if query or tipo_filtro %}
        <div class="filter-result-info">
            Mostrando <strong>{{ total_resultados }}</strong> resultado{{ total_resultados|pluralize:"s" }}
            {% if query %}con "{{ query }}"{% endif %}
            {% if tipo_filtro %}(tipo: {{ tipo_filtro }}){% endif %}
        </div>
        {% endif %}
    </form>

    {# ═══════════════════════════════════════════════════════════════════════════ #}
    {# NAVEGACIÓN POR SECCIONES (Tabs)                                              #}
    {# ═══════════════════════════════════════════════════════════════════════════ #}
    <div class="section-tabs no-print">
        <button class="tab-btn active" data-section="todas">
            <span class="material-icons">view_list</span>
            Todas
            <span class="tab-count">{{ total_resultados }}</span>
        </button>
        <button class="tab-btn" data-section="extendidas">
            <span class="material-icons">account_tree</span>
            Extendidas
            <span class="tab-count">{{ familias_extendidas|length }}</span>
        </button>
        <button class="tab-btn" data-section="nucleares">
            <span class="material-icons">family_restroom</span>
            Nucleares
            <span class="tab-count">{{ familias_nucleares|length }}</span>
        </button>
        <button class="tab-btn" data-section="parejas">
            <span class="material-icons">favorite</span>
            Parejas
            <span class="tab-count">{{ parejas|length }}</span>
        </button>
    </div>

    {# ═══════════════════════════════════════════════════════════════════════════ #}
    {# SECCIÓN: FAMILIAS NUCLEARES                                                  #}
    {# ═══════════════════════════════════════════════════════════════════════════ #}
    {% if familias_nucleares %}
    <div class="familia-section" data-section="nucleares">
        <div class="section-header">
            <div class="section-title">
                <span class="material-icons">family_restroom</span>
                <h2>Familias Nucleares</h2>
            </div>
            <span class="section-count">{{ familias_nucleares|length }} familia{{ familias_nucleares|length|pluralize:"s" }}</span>
        </div>
        <p class="section-description">
            Unidades familiares: padres con sus hijos
        </p>

        <div class="familias-grid">
            {% for familia in familias_nucleares %}
            <div class="familia-card familia-nuclear">
                <div class="familia-header nuclear-header">
                    <div class="familia-titulo">
                        <span class="familia-numero">{{ forloop.counter }}</span>
                        <div>
                            <h3>
                                {% if familia.nombre_referencia %}
                                    Familia de {{ familia.nombre_referencia }}
                                {% else %}
                                    Familia {{ familia.apellido }}
                                {% endif %}
                            </h3>
                            <span class="familia-tipo-badge nuclear">
                                <span class="material-icons">family_restroom</span>
                                {% if familia.num_hijos == 1 %}1 hijo{% else %}{{ familia.num_hijos }} hijos{% endif %}
                            </span>
                        </div>
                    </div>
                    <span class="familia-count">{{ familia.miembros|length }} miembros</span>
                </div>

                <div class="familia-miembros">
                    {# Padres #}
                    <div class="padres-section">
                        {% for persona in familia.padres %}
                        <div class="familia-persona {% if persona.es_cabeza %}es-cabeza{% endif %}">
                            <div class="persona-avatar {% if persona.genero == 'masculino' %}avatar-m{% elif persona.genero == 'femenino' %}avatar-f{% else %}avatar-u{% endif %}">
                                <span class="material-icons">person</span>
                            </div>
                            <div class="persona-info">
                                <span class="persona-nombre">
                                    {{ persona.nombre_completo }}
                                    {% if persona.es_cabeza %}
                                        <span class="badge-cabeza">★</span>
                                    {% endif %}
                                </span>
                                <span class="persona-detalle">
                                    {{ persona.rol }}
                                    {% if persona.edad %} · {{ persona.edad }} años{% endif %}
                                </span>
                            </div>
                            <a href="{% url 'miembros_app:detalle' persona.id %}" 
                               class="btn-ver no-print">
                                <span class="material-icons">chevron_right</span>
                            </a>
                        </div>
                        {% endfor %}
                    </div>

                    {# Hijos #}
                    {% if familia.hijos %}
                    <div class="hijos-divider">
                        <span class="material-icons">arrow_downward</span>
                        <span>Hijos</span>
                    </div>
                    <div class="hijos-section">
                        {% for persona in familia.hijos %}
                        <div class="familia-persona hijo-item">
                            <div class="persona-avatar {% if persona.genero == 'masculino' %}avatar-m{% elif persona.genero == 'femenino' %}avatar-f{% else %}avatar-u{% endif %}">
                                <span class="material-icons">{% if persona.edad and persona.edad < 12 %}child_care{% else %}face{% endif %}</span>
                            </div>
                            <div class="persona-info">
                                <span class="persona-nombre">{{ persona.nombre_completo }}</span>
                                <span class="persona-detalle">
                                    {{ persona.rol }}
                                    {% if persona.edad %} · {{ persona.edad }} años{% endif %}
                                </span>
                            </div>
                            <a href="{% url 'miembros_app:detalle' persona.id %}" 
                               class="btn-ver no-print">
                                <span class="material-icons">chevron_right</span>
                            </a>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>

                {% if familia.telefono %}
                <div class="familia-footer">
                    <span class="material-icons">phone</span>
                    {{ familia.telefono }}
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {# ═══════════════════════════════════════════════════════════════════════════ #}
    {# SECCIÓN: FAMILIAS EXTENDIDAS                                                 #}
    {# ═══════════════════════════════════════════════════════════════════════════ #}
    {% if familias_extendidas %}
    <div class="familia-section" data-section="extendidas">
        <div class="section-header">
            <div class="section-title">
                <span class="material-icons">account_tree</span>
                <h2>Familias Extendidas</h2>
            </div>
            <span class="section-count">{{ familias_extendidas|length }} familia{{ familias_extendidas|length|pluralize:"s" }}</span>
        </div>
        <p class="section-description">
            Grupos familiares con múltiples núcleos conectados (padres, hijos casados con sus familias, etc.)
        </p>

        <div class="familias-grid familias-extendidas-grid">
            {% for familia in familias_extendidas %}
            <div class="familia-card familia-extendida">
                <div class="familia-header">
                    <div class="familia-titulo">
                        <span class="familia-numero">{{ forloop.counter }}</span>
                        <div>
                            <h3>Familia {{ familia.apellido }}</h3>
                            <span class="familia-tipo-badge extendida">
                                <span class="material-icons">account_tree</span>
                                {% if familia.num_nucleos %}
                                    {{ familia.num_nucleos }} núcleo{{ familia.num_nucleos|pluralize:"s" }}
                                {% else %}
                                    Grupo familiar
                                {% endif %}
                            </span>
                        </div>
                    </div>
                    <span class="familia-count">{{ familia.total_miembros }} miembros</span>
                </div>

                <div class="familia-miembros">
                    {% if familia.es_grupo_general and familia.miembros_generales %}
                        {# Grupo general sin estructura nuclear #}
                        <div class="miembros-generales">
                            {% for persona in familia.miembros_generales %}
                            <div class="familia-persona {% if persona.es_cabeza %}es-cabeza{% endif %}">
                                <div class="persona-avatar {% if persona.genero == 'masculino' %}avatar-m{% elif persona.genero == 'femenino' %}avatar-f{% else %}avatar-u{% endif %}">
                                    <span class="material-icons">person</span>
                                </div>
                                <div class="persona-info">
                                    <span class="persona-nombre">
                                        {{ persona.nombre_completo }}
                                        {% if persona.es_cabeza %}
                                            <span class="badge-cabeza">★</span>
                                        {% endif %}
                                    </span>
                                    <span class="persona-detalle">
                                        {{ persona.rol }}
                                        {% if persona.edad %} · {{ persona.edad }} años{% endif %}
                                    </span>
                                </div>
                                <a href="{% url 'miembros_app:detalle' persona.id %}" 
                                   class="btn-ver no-print">
                                    <span class="material-icons">chevron_right</span>
                                </a>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        {# Subfamilias nucleares #}
                        {% for subfamilia in familia.subfamilias %}
                        <div class="subfamilia-bloque">
                            <div class="subfamilia-header">
                                <span class="material-icons">family_restroom</span>
                                <span class="subfamilia-titulo">
                                    {% if subfamilia.nombre_referencia %}
                                        Núcleo de {{ subfamilia.nombre_referencia }}
                                    {% else %}
                                        Núcleo {{ forloop.counter }}
                                    {% endif %}
                                    {% if subfamilia.num_hijos %}
                                        · {{ subfamilia.num_hijos }} hijo{{ subfamilia.num_hijos|pluralize:"s" }}
                                    {% endif %}
                                </span>
                            </div>

                            {# Padres #}
                            {% if subfamilia.padres %}
                            <div class="padres-grupo">
                                {% for persona in subfamilia.padres %}
                                <div class="familia-persona {% if persona.es_cabeza %}es-cabeza{% endif %}">
                                    <div class="persona-avatar {% if persona.genero == 'masculino' %}avatar-m{% elif persona.genero == 'femenino' %}avatar-f{% else %}avatar-u{% endif %}">
                                        <span class="material-icons">person</span>
                                    </div>
                                    <div class="persona-info">
                                        <span class="persona-nombre">
                                            {{ persona.nombre_completo }}
                                            {% if persona.es_cabeza %}
                                                <span class="badge-cabeza">★</span>
                                            {% endif %}
                                        </span>
                                        <span class="persona-detalle">
                                            {{ persona.rol }}
                                            {% if persona.edad %} · {{ persona.edad }} años{% endif %}
                                        </span>
                                    </div>
                                    <a href="{% url 'miembros_app:detalle' persona.id %}" 
                                       class="btn-ver no-print">
                                        <span class="material-icons">chevron_right</span>
                                    </a>
                                </div>
                                {% endfor %}
                            </div>
                            {% endif %}

                            {# Hijos #}
                            {% if subfamilia.hijos %}
                            <div class="hijos-conector">
                                <div class="conector-linea"></div>
                                <span class="conector-label">Hijos</span>
                                <div class="conector-linea"></div>
                            </div>
                            <div class="hijos-grupo">
                                {% for persona in subfamilia.hijos %}
                                <div class="familia-persona hijo-item">
                                    <div class="persona-avatar {% if persona.genero == 'masculino' %}avatar-m{% elif persona.genero == 'femenino' %}avatar-f{% else %}avatar-u{% endif %}">
                                        <span class="material-icons">{% if persona.edad and persona.edad < 12 %}child_care{% else %}face{% endif %}</span>
                                    </div>
                                    <div class="persona-info">
                                        <span class="persona-nombre">{{ persona.nombre_completo }}</span>
                                        <span class="persona-detalle">
                                            {{ persona.rol }}
                                            {% if persona.edad %} · {{ persona.edad }} años{% endif %}
                                        </span>
                                    </div>
                                    <a href="{% url 'miembros_app:detalle' persona.id %}" 
                                       class="btn-ver no-print">
                                        <span class="material-icons">chevron_right</span>
                                    </a>
                                </div>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>

                        {% if not forloop.last %}
                        <div class="subfamilia-separator"></div>
                        {% endif %}
                        {% endfor %}
                    {% endif %}
                </div>

                {% if familia.telefono or familia.direccion %}
                <div class="familia-footer">
                    {% if familia.telefono %}
                    <span class="footer-item">
                        <span class="material-icons">phone</span>
                        {{ familia.telefono }}
                    </span>
                    {% endif %}
                    {% if familia.direccion %}
                    <span class="footer-item">
                        <span class="material-icons">location_on</span>
                        {{ familia.direccion|truncatewords:6 }}
                    </span>
                    {% endif %}
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {# ═══════════════════════════════════════════════════════════════════════════ #}
    {# SECCIÓN: PAREJAS / MATRIMONIOS                                               #}
    {# ═══════════════════════════════════════════════════════════════════════════ #}
    {% if parejas %}
    <div class="familia-section" data-section="parejas">
        <div class="section-header">
            <div class="section-title">
                <span class="material-icons">favorite</span>
                <h2>Parejas / Matrimonios</h2>
            </div>
            <span class="section-count">{{ parejas|length }} pareja{{ parejas|length|pluralize:"s" }}</span>
        </div>
        <p class="section-description">
            Cónyuges sin hijos registrados en el sistema
        </p>

        <div class="parejas-grid">
            {% for pareja in parejas %}
            <div class="pareja-card">
                <div class="pareja-content">
                    {# Persona 1 #}
                    <div class="pareja-persona">
                        <div class="persona-avatar {% if pareja.persona1.genero == 'masculino' %}avatar-m{% elif pareja.persona1.genero == 'femenino' %}avatar-f{% else %}avatar-u{% endif %}">
                            <span class="material-icons">person</span>
                        </div>
                        <div class="persona-info">
                            <span class="persona-nombre">{{ pareja.persona1.nombre_completo }}</span>
                            <span class="persona-detalle">
                                {% if pareja.persona1.genero == 'femenino' %}Esposa{% else %}Esposo{% endif %}
                                {% if pareja.persona1.edad %} · {{ pareja.persona1.edad }} años{% endif %}
                            </span>
                        </div>
                        <a href="{% url 'miembros_app:detalle' pareja.persona1.id %}" 
                           class="btn-ver no-print">
                            <span class="material-icons">chevron_right</span>
                        </a>
                    </div>

                    {# Conector #}
                    <div class="pareja-conector">
                        <span class="material-icons">favorite</span>
                    </div>

                    {# Persona 2 #}
                    <div class="pareja-persona">
                        <div class="persona-avatar {% if pareja.persona2.genero == 'masculino' %}avatar-m{% elif pareja.persona2.genero == 'femenino' %}avatar-f{% else %}avatar-u{% endif %}">
                            <span class="material-icons">person</span>
                        </div>
                        <div class="persona-info">
                            <span class="persona-nombre">{{ pareja.persona2.nombre_completo }}</span>
                            <span class="persona-detalle">
                                {% if pareja.persona2.genero == 'femenino' %}Esposa{% else %}Esposo{% endif %}
                                {% if pareja.persona2.edad %} · {{ pareja.persona2.edad }} años{% endif %}
                            </span>
                        </div>
                        <a href="{% url 'miembros_app:detalle' pareja.persona2.id %}" 
                           class="btn-ver no-print">
                            <span class="material-icons">chevron_right</span>
                        </a>
                    </div>
                </div>

                {% if pareja.telefono %}
                <div class="pareja-footer">
                    <span class="material-icons">phone</span>
                    {{ pareja.telefono }}
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {# ═══════════════════════════════════════════════════════════════════════════ #}
    {# MENSAJE: SIN RESULTADOS                                                      #}
    {# ═══════════════════════════════════════════════════════════════════════════ #}
    {% if not familias_extendidas and not familias_nucleares and not parejas %}
    <div class="empty-state">
        <span class="material-icons">family_restroom</span>
        <h3>No se encontraron familias</h3>
        {% if query or tipo_filtro %}
        <p>No hay resultados para los filtros aplicados.</p>
        <a href="{% url 'miembros_app:reporte_relaciones_familiares' %}" class="btn-primary">
            <span class="material-icons">clear</span>
            Limpiar filtros
        </a>
        {% else %}
        <p>Aún no hay relaciones familiares registradas.</p>
        <p class="text-muted">Puedes agregar relaciones desde la ficha de cada miembro.</p>
        {% endif %}
    </div>
    {% endif %}

</section>

<style>
/* ═══════════════════════════════════════════════════════════════════════════════
   ESTILOS DEL REPORTE DE FAMILIAS - V2
   ═══════════════════════════════════════════════════════════════════════════════ */

.only-print {
    display: none !important;
}

/* ─────────────────────────────────────────────────────────────────────────────
   GRID DE ESTADÍSTICAS
   ───────────────────────────────────────────────────────────────────────────── */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 16px;
    margin-bottom: 24px;
}

.stat-card {
    display: flex;
    align-items: center;
    gap: 14px;
    background: #fff;
    border: 1px solid #e5e7eb;
    border-radius: 10px;
    padding: 16px;
    transition: box-shadow 0.2s;
}

.stat-card:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}

.stat-icon {
    width: 48px;
    height: 48px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.stat-icon .material-icons {
    font-size: 24px;
}

.stat-content {
    display: flex;
    flex-direction: column;
}

.stat-value {
    font-size: 28px;
    font-weight: 700;
    color: #1f2937;
    line-height: 1.1;
}

.stat-label {
    font-size: 13px;
    color: #6b7280;
    margin-top: 2px;
}

/* ─────────────────────────────────────────────────────────────────────────────
   PANEL DE FILTROS
   ───────────────────────────────────────────────────────────────────────────── */
.filter-panel {
    background: #f9fafb;
    border: 1px solid #e5e7eb;
    border-radius: 10px;
    padding: 16px;
    margin-bottom: 24px;
}

.filter-row {
    display: flex;
    gap: 16px;
    align-items: flex-end;
}

.filter-field {
    flex: 1;
}

.filter-field label {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 13px;
    font-weight: 500;
    color: #374151;
    margin-bottom: 6px;
}

.filter-field label .material-icons {
    font-size: 16px;
    color: #6b7280;
}

.filter-field input,
.filter-field select {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    font-size: 14px;
    background: #fff;
}

.filter-field input:focus,
.filter-field select:focus {
    outline: none;
    border-color: #714b67;
    box-shadow: 0 0 0 3px rgba(113, 75, 103, 0.1);
}

.filter-actions-inline {
    display: flex;
    gap: 8px;
}

.filter-result-info {
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px solid #e5e7eb;
    font-size: 13px;
    color: #6b7280;
}

/* ─────────────────────────────────────────────────────────────────────────────
   TABS DE SECCIONES
   ───────────────────────────────────────────────────────────────────────────── */
.section-tabs {
    display: flex;
    gap: 8px;
    margin-bottom: 24px;
    border-bottom: 2px solid #e5e7eb;
    padding-bottom: 0;
}

.tab-btn {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 12px 18px;
    background: transparent;
    border: none;
    border-bottom: 2px solid transparent;
    margin-bottom: -2px;
    font-size: 14px;
    font-weight: 500;
    color: #6b7280;
    cursor: pointer;
    transition: all 0.2s;
}

.tab-btn:hover {
    color: #374151;
    background: #f3f4f6;
}

.tab-btn.active {
    color: #714b67;
    border-bottom-color: #714b67;
}

.tab-btn .material-icons {
    font-size: 18px;
}

.tab-count {
    background: #e5e7eb;
    color: #374151;
    font-size: 12px;
    padding: 2px 8px;
    border-radius: 10px;
    font-weight: 600;
}

.tab-btn.active .tab-count {
    background: #714b67;
    color: #fff;
}

/* ─────────────────────────────────────────────────────────────────────────────
   SECCIONES DE FAMILIAS
   ───────────────────────────────────────────────────────────────────────────── */
.familia-section {
    margin-bottom: 32px;
}

.section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 8px;
}

.section-title {
    display: flex;
    align-items: center;
    gap: 10px;
}

.section-title .material-icons {
    font-size: 28px;
    color: #714b67;
}

.section-title h2 {
    font-size: 20px;
    font-weight: 600;
    color: #1f2937;
    margin: 0;
}

.section-count {
    font-size: 14px;
    color: #6b7280;
    background: #f3f4f6;
    padding: 4px 12px;
    border-radius: 16px;
}

.section-description {
    font-size: 14px;
    color: #6b7280;
    margin: 0 0 20px 38px;
}

/* ─────────────────────────────────────────────────────────────────────────────
   GRID DE FAMILIAS
   ───────────────────────────────────────────────────────────────────────────── */
.familias-grid,
.parejas-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
    gap: 20px;
}

.familias-extendidas-grid {
    grid-template-columns: repeat(auto-fill, minmax(450px, 1fr));
}

/* ─────────────────────────────────────────────────────────────────────────────
   TARJETA DE FAMILIA
   ───────────────────────────────────────────────────────────────────────────── */
.familia-card,
.pareja-card {
    background: #fff;
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    overflow: hidden;
    transition: transform 0.2s, box-shadow 0.2s;
}

.familia-card:hover,
.pareja-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(0,0,0,0.1);
}

.familia-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: #fff;
}

.familia-header.nuclear-header {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
}

.familia-titulo {
    display: flex;
    align-items: center;
    gap: 12px;
}

.familia-numero {
    width: 28px;
    height: 28px;
    background: rgba(255,255,255,0.2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 13px;
    font-weight: 600;
}

.familia-titulo h3 {
    font-size: 16px;
    font-weight: 600;
    margin: 0;
}

.familia-tipo-badge {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    font-size: 12px;
    padding: 2px 8px;
    background: rgba(255,255,255,0.2);
    border-radius: 12px;
    margin-top: 4px;
}

.familia-tipo-badge .material-icons {
    font-size: 14px;
}

.familia-count {
    font-size: 13px;
    background: rgba(255,255,255,0.2);
    padding: 4px 12px;
    border-radius: 16px;
}

/* ─────────────────────────────────────────────────────────────────────────────
   MIEMBROS DE FAMILIA
   ───────────────────────────────────────────────────────────────────────────── */
.familia-miembros {
    padding: 16px;
}

.subfamilia-bloque {
    padding: 12px;
    background: #f9fafb;
    border-radius: 8px;
}

.subfamilia-header {
    display: flex;
    align-items: center;
    gap: 8px;
    padding-bottom: 12px;
    margin-bottom: 12px;
    border-bottom: 1px dashed #d1d5db;
}

.subfamilia-header .material-icons {
    font-size: 20px;
    color: #714b67;
}

.subfamilia-titulo {
    font-size: 13px;
    font-weight: 600;
    color: #374151;
}

.subfamilia-separator {
    height: 1px;
    background: linear-gradient(to right, transparent, #d1d5db, transparent);
    margin: 16px 0;
}

.padres-grupo,
.hijos-grupo,
.padres-section,
.hijos-section,
.miembros-generales {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.familia-persona {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 12px;
    background: #fff;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    transition: background 0.2s;
}

.familia-persona:hover {
    background: #f9fafb;
}

.familia-persona.es-cabeza {
    background: #fffbeb;
    border-color: #fcd34d;
}

.persona-avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.persona-avatar .material-icons {
    font-size: 20px;
    color: #fff;
}

.persona-avatar.avatar-m {
    background: linear-gradient(135deg, #3b82f6, #1d4ed8);
}

.persona-avatar.avatar-f {
    background: linear-gradient(135deg, #ec4899, #be185d);
}

.persona-avatar.avatar-u {
    background: linear-gradient(135deg, #6b7280, #374151);
}

.persona-info {
    flex: 1;
    min-width: 0;
}

.persona-nombre {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 14px;
    font-weight: 500;
    color: #1f2937;
}

.persona-detalle {
    font-size: 12px;
    color: #6b7280;
    margin-top: 2px;
}

.badge-cabeza {
    color: #d97706;
    font-size: 14px;
}

.btn-ver {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #f3f4f6;
    border-radius: 6px;
    color: #6b7280;
    text-decoration: none;
    transition: all 0.2s;
}

.btn-ver:hover {
    background: #714b67;
    color: #fff;
}

/* ─────────────────────────────────────────────────────────────────────────────
   CONECTORES
   ───────────────────────────────────────────────────────────────────────────── */
.hijos-conector,
.hijos-divider {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 0;
    color: #9ca3af;
    font-size: 12px;
    font-weight: 500;
    text-transform: uppercase;
}

.conector-linea {
    flex: 1;
    height: 1px;
    background: #d1d5db;
}

.hijos-divider {
    justify-content: center;
}

.hijos-divider .material-icons {
    font-size: 16px;
}

/* ─────────────────────────────────────────────────────────────────────────────
   FOOTER DE FAMILIA
   ───────────────────────────────────────────────────────────────────────────── */
.familia-footer,
.pareja-footer {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 12px 16px;
    background: #f9fafb;
    border-top: 1px solid #e5e7eb;
    font-size: 13px;
    color: #6b7280;
}

.footer-item {
    display: flex;
    align-items: center;
    gap: 6px;
}

.footer-item .material-icons {
    font-size: 16px;
}

/* ─────────────────────────────────────────────────────────────────────────────
   TARJETA DE PAREJA
   ───────────────────────────────────────────────────────────────────────────── */
.pareja-content {
    display: flex;
    align-items: center;
    padding: 16px;
    gap: 12px;
}

.pareja-persona {
    flex: 1;
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    background: #f9fafb;
    border-radius: 8px;
}

.pareja-conector {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    color: #ec4899;
}

.pareja-conector .material-icons {
    font-size: 24px;
}

/* ─────────────────────────────────────────────────────────────────────────────
   ESTADO VACÍO
   ───────────────────────────────────────────────────────────────────────────── */
.empty-state {
    text-align: center;
    padding: 60px 20px;
    color: #6b7280;
}

.empty-state .material-icons {
    font-size: 64px;
    color: #d1d5db;
    margin-bottom: 16px;
}

.empty-state h3 {
    font-size: 18px;
    color: #374151;
    margin: 0 0 8px;
}

.empty-state p {
    margin: 0 0 16px;
}

.text-muted {
    color: #9ca3af;
}

/* ─────────────────────────────────────────────────────────────────────────────
   BOTONES
   ───────────────────────────────────────────────────────────────────────────── */
.btn-primary,
.btn-secondary {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 10px 16px;
    border-radius: 6px;
    font-size: 14px;
    font-weight: 500;
    text-decoration: none;
    cursor: pointer;
    transition: all 0.2s;
    border: none;
}

.btn-primary {
    background: #714b67;
    color: #fff;
}

.btn-primary:hover {
    background: #5a3d53;
}

.btn-secondary {
    background: #fff;
    color: #374151;
    border: 1px solid #d1d5db;
}

.btn-secondary:hover {
    background: #f3f4f6;
}

/* ═══════════════════════════════════════════════════════════════════════════════
   IMPRESIÓN
   ═══════════════════════════════════════════════════════════════════════════════ */
@media print {
    .topbar, .main-nav, .sidebar, .footer, .no-print {
        display: none !important;
    }

    .only-print {
        display: block !important;
    }

    body, .layout, .main-content {
        margin: 0 !important;
        padding: 0 !important;
        max-width: 100% !important;
    }

    .page-section {
        box-shadow: none !important;
        border: none !important;
        padding: 0 !important;
    }

    .print-header {
        text-align: center;
        margin-bottom: 20px;
    }

    .print-logo {
        max-height: 50px;
        margin-bottom: 8px;
    }

    .print-church-name {
        font-size: 18px;
        font-weight: 700;
        margin: 0;
    }

    .print-denomination {
        font-size: 12px;
        color: #555;
    }

    .print-report-info {
        font-size: 11px;
        color: #666;
        margin-top: 6px;
    }

    .print-divider {
        margin: 12px 0;
        border: none;
        border-top: 1px solid #ddd;
    }

    .familia-section {
        page-break-inside: avoid;
        margin-bottom: 24px;
    }

    .familias-grid,
    .parejas-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
    }

    .familia-card,
    .pareja-card {
        break-inside: avoid;
        border: 1px solid #ccc;
        box-shadow: none !important;
        transform: none !important;
    }

    .familia-header,
    .familia-header.nuclear-header {
        background: #f5f5f5 !important;
        color: #333 !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
    }

    .persona-avatar {
        width: 28px;
        height: 28px;
    }

    .persona-avatar .material-icons {
        font-size: 16px;
    }

    .persona-nombre {
        font-size: 12px;
    }

    .persona-detalle {
        font-size: 10px;
    }

    .familia-titulo h3 {
        font-size: 14px;
    }

    .familia-numero {
        width: 22px;
        height: 22px;
        font-size: 11px;
    }
}

/* ═══════════════════════════════════════════════════════════════════════════════
   RESPONSIVE
   ═══════════════════════════════════════════════════════════════════════════════ */
@media (max-width: 1200px) {
    .stats-grid {
        grid-template-columns: repeat(3, 1fr);
    }
}

@media (max-width: 768px) {
    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
    }

    .stat-card {
        padding: 14px;
    }

    .stat-value {
        font-size: 24px;
    }

    .filter-row {
        flex-direction: column;
    }

    .filter-actions-inline {
        width: 100%;
    }

    .filter-actions-inline .btn-primary {
        flex: 1;
    }

    .section-tabs {
        gap: 4px;
        overflow-x: auto;
    }

    .tab-btn {
        padding: 10px 14px;
        font-size: 13px;
        white-space: nowrap;
    }

    .tab-btn .material-icons {
        display: none;
    }

    .familias-grid,
    .familias-extendidas-grid,
    .parejas-grid {
        grid-template-columns: 1fr;
    }

    .pareja-content {
        flex-direction: column;
    }

    .pareja-persona {
        width: 100%;
    }

    .pareja-conector {
        flex-direction: row;
        padding: 8px 0;
    }
}

@media (max-width: 480px) {
    .stats-grid {
        grid-template-columns: 1fr;
    }

    .section-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
    }

    .section-description {
        margin-left: 0;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Tabs functionality
    const tabs = document.querySelectorAll('.tab-btn');
    const sections = document.querySelectorAll('.familia-section');
    
    tabs.forEach(tab => {
        tab.addEventListener('click', function() {
            const targetSection = this.dataset.section;
            
            // Update active tab
            tabs.forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            
            // Show/hide sections
            if (targetSection === 'todas') {
                sections.forEach(s => s.style.display = 'block');
            } else {
                sections.forEach(s => {
                    if (s.dataset.section === targetSection) {
                        s.style.display = 'block';
                    } else {
                        s.style.display = 'none';
                    }
                });
            }
        });
    });
});
</script>

{% endblock %}