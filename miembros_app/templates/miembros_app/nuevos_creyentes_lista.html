{% extends 'miembros_app/base_miembros.html' %}
{% load static %}

{% block title %}Nuevos creyentes{% endblock %}

{% block miembros_content %}

<!-- BARRA DE CONTROL SUPERIOR (Estilo Odoo - Igual a listado_miembros) -->
<div class="odoo-control-bar no-print">
    <div class="odoo-control-left">
        <a href="{% url 'miembros_app:nuevo_creyente_crear' %}" class="odoo-btn odoo-btn-primary">
            <span class="material-icons">add</span>
            Nuevo
        </a>
        
        <div class="odoo-breadcrumb">
            <span class="odoo-breadcrumb-title">Nuevos creyentes</span>
            <span class="material-icons odoo-breadcrumb-icon">settings</span>
        </div>
    </div>

    <div class="odoo-control-center">
        <form method="get" class="odoo-search-form" id="main-search-form">
            <span class="material-icons odoo-search-icon">search</span>
            
            <div class="odoo-search-filters">
                {% if query %}
                <span class="odoo-filter-tag">"{{ query }}"<button type="button" onclick="removeFilter('q')" class="odoo-filter-remove">×</button></span>
                {% endif %}
                {% if genero_filtro %}
                <span class="odoo-filter-tag">{{ genero_filtro }}<button type="button" onclick="removeFilter('genero')" class="odoo-filter-remove">×</button></span>
                {% endif %}
                {% if fecha_desde or fecha_hasta %}
                <span class="odoo-filter-tag">{% if fecha_desde %}{{ fecha_desde }}{% endif %}{% if fecha_desde and fecha_hasta %} - {% endif %}{% if fecha_hasta %}{{ fecha_hasta }}{% endif %}<button type="button" onclick="removeFilter('fecha_desde'); removeFilter('fecha_hasta');" class="odoo-filter-remove">×</button></span>
                {% endif %}
                {% if solo_contacto %}
                <span class="odoo-filter-tag">Con contacto<button type="button" onclick="removeFilter('solo_contacto')" class="odoo-filter-remove">×</button></span>
                {% endif %}
            </div>
            
            <input type="text" name="q" class="odoo-search-input" placeholder="Buscar..." value="{{ query }}">
            
            <input type="hidden" name="genero" value="{{ genero_filtro }}">
            <input type="hidden" name="fecha_desde" value="{{ fecha_desde }}">
            <input type="hidden" name="fecha_hasta" value="{{ fecha_hasta }}">
            {% if solo_contacto %}<input type="hidden" name="solo_contacto" value="1">{% endif %}
            
            <div class="odoo-filter-dropdown">
                <button type="button" class="odoo-filter-btn" onclick="toggleFilterPanel()">
                    <span class="material-icons">filter_list</span>
                    Filtros
                    <span class="material-icons">arrow_drop_down</span>
                </button>
            </div>
        </form>
    </div>

    <div class="odoo-control-right">
        <span class="odoo-pagination-info">
            {% if miembros %}1-{{ miembros|length }} / {{ miembros|length }}{% else %}0 / 0{% endif %}
        </span>
        
        <div class="odoo-pagination-btns">
            <button class="odoo-page-btn" disabled><span class="material-icons">chevron_left</span></button>
            <button class="odoo-page-btn" disabled><span class="material-icons">chevron_right</span></button>
        </div>

        <div class="odoo-view-toggle">
            <button type="button" class="odoo-view-btn active" data-view="lista" title="Vista lista">
                <span class="material-icons">view_list</span>
            </button>
            <button type="button" class="odoo-view-btn" data-view="grid" title="Vista tarjetas">
                <span class="material-icons">grid_view</span>
            </button>
        </div>

        <div class="odoo-actions-menu">
            <button type="button" class="odoo-action-btn" onclick="toggleActionsMenu()">
                <span class="material-icons">more_vert</span>
            </button>
            <div class="odoo-actions-dropdown" id="actions-dropdown">
                <button type="button" onclick="window.print()">
                    <span class="material-icons">print</span>Imprimir
                </button>
                <a href="{% url 'miembros_app:nuevos_creyentes_enviar_email' %}{% if request.GET %}?{{ request.GET.urlencode }}{% endif %}">
                    <span class="material-icons">mail</span>Enviar por correo
                </a>
            </div>
        </div>
    </div>
</div>

<!-- PANEL DE FILTROS -->
<div class="odoo-filter-overlay no-print" id="filter-overlay"></div>
<div class="odoo-filter-panel no-print" id="filter-panel">
    <div class="odoo-filter-panel-header">
        <span>Filtros</span>
        <button type="button" class="odoo-filter-close-btn" id="filter-close-btn">
            <span class="material-icons">close</span>
        </button>
    </div>
    <form method="get" class="odoo-filter-form">
        <input type="hidden" name="q" value="{{ query }}">
        <input type="hidden" name="filtros_abiertos" value="1">
        <div class="odoo-filter-grid">
            <div class="odoo-filter-group">
                <label>Género</label>
                <select name="genero">
                    <option value="">Todos</option>
                    {% for value, label in generos_choices %}
                    <option value="{{ value }}" {% if value == genero_filtro %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="odoo-filter-group">
                <label>Conversión desde</label>
                <input type="date" name="fecha_desde" value="{{ fecha_desde }}">
            </div>
            <div class="odoo-filter-group">
                <label>Conversión hasta</label>
                <input type="date" name="fecha_hasta" value="{{ fecha_hasta }}">
            </div>
            <div class="odoo-filter-group">
                <label>Opciones</label>
                <div class="odoo-filter-checks">
                    <label class="odoo-filter-checkbox">
                        <input type="checkbox" name="solo_contacto" value="1" {% if solo_contacto %}checked{% endif %}>
                        Solo con contacto
                    </label>
                </div>
            </div>
        </div>
        <div class="odoo-filter-actions">
            <button type="button" class="odoo-btn odoo-btn-secondary" onclick="clearFilters()">Limpiar</button>
            <button type="submit" class="odoo-btn odoo-btn-primary">Aplicar filtros</button>
        </div>
    </form>
</div>

<!-- ENCABEZADO PARA IMPRESIÓN -->
<div class="only-print" style="text-align:center; margin-bottom:12px;">
    {% if CFG.logo %}<img src="{{ CFG.logo.url }}" alt="{{ CFG.nombre_iglesia|default:'Logo' }}" style="max-height:70px; margin-bottom:6px;">{% endif %}
    <h2 style="margin:0; font-size:18px; font-weight:700;">{% if CFG.nombre_iglesia %}{{ CFG.nombre_iglesia|upper }}{% else %}IGLESIA{% endif %}</h2>
    {% if CFG.denominacion %}<div style="font-size:12px; color:#4b5563;">{{ CFG.denominacion }}</div>{% endif %}
    {% if CFG.lema %}<div style="font-size:12px; color:#6b7280; font-style:italic;">"{{ CFG.lema }}"</div>{% endif %}
    <div style="font-size:11px; color:#6b7280; margin-top:6px;">Listado de nuevos creyentes · {% now "d/m/Y" %}</div>
    <hr style="margin-top:10px; border:none; border-top:1px solid #e5e7eb;">
</div>

<!-- TABLA DE NUEVOS CREYENTES (Vista Lista) -->
<div class="odoo-list-container" id="vista-lista">
    <table class="odoo-table">
        <thead>
            <tr>
                <th class="odoo-th-checkbox no-print"><input type="checkbox" id="select-all"></th>
                <th class="odoo-th-sortable">Código<span class="material-icons odoo-sort-icon">unfold_more</span></th>
                <th class="odoo-th-sortable odoo-th-main">Nuevo creyente<span class="material-icons odoo-sort-icon">unfold_more</span></th>
                <th>Edad</th>
                <th>Contacto</th>
                <th>Conversión</th>
                {% if 'nuevo_creyente' not in MODULOS_ACTIVOS %}<th>Padres espirituales</th>{% endif %}
                {% if 'nuevo_creyente' in MODULOS_ACTIVOS %}<th>Estado</th>{% endif %}
                <th class="no-print"></th>
            </tr>
        </thead>
        <tbody>
            {% if miembros %}
                {% for m in miembros %}
                <tr class="odoo-row" onclick="window.location='{% url 'miembros_app:nuevo_creyente_detalle' m.pk %}'" style="cursor: pointer;">
                    <td class="odoo-td-checkbox no-print" onclick="event.stopPropagation();"><input type="checkbox" class="row-checkbox" value="{{ m.pk }}"></td>
                    <td class="odoo-td-code">{% if m.codigo_seguimiento %}{{ m.codigo_seguimiento }}{% else %}<span class="odoo-empty">—</span>{% endif %}</td>
                    <td class="odoo-td-main">
                        <div class="odoo-member-name">
                            <a href="{% url 'miembros_app:nuevo_creyente_detalle' m.pk %}" onclick="event.stopPropagation();" class="no-print">{{ m.nombres }} {{ m.apellidos }}</a>
                            <span class="only-print">{{ m.nombres }} {{ m.apellidos }}</span>
                        </div>
                        {% if m.genero %}<div class="odoo-member-sub">{{ m.get_genero_display }}</div>{% endif %}
                    </td>
                    <td>{% if m.calcular_edad %}{{ m.calcular_edad }}{% else %}<span class="odoo-empty">—</span>{% endif %}</td>
                    <td class="odoo-td-contact">
                        {% if m.telefono or m.email %}
                            {% if m.telefono %}
                            <div class="odoo-contact-line">{{ m.telefono }}
                                <a href="https://wa.me/{{ m.telefono|cut:' '|cut:'-' }}" target="_blank" onclick="event.stopPropagation();" class="odoo-wa-link no-print" title="WhatsApp">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.486 2 2 6.486 2 12c0 1.86.507 3.599 1.387 5.106L2 22l5.043-1.356A9.93 9.93 0 0 0 12 22c5.514 0 10-4.486 10-10S17.514 2 12 2z"/></svg>
                                </a>
                            </div>
                            {% endif %}
                            {% if m.email %}<div class="odoo-contact-email">{{ m.email }}</div>{% endif %}
                        {% else %}<span class="odoo-empty">Sin datos</span>{% endif %}
                    </td>
                    <td>{% if m.fecha_conversion %}{{ m.fecha_conversion|date:"d/m/Y" }}{% else %}<span class="odoo-empty">—</span>{% endif %}</td>
                    {% if 'nuevo_creyente' not in MODULOS_ACTIVOS %}
                    <td>{% with padres=m.padres_espirituales.all %}{% if padres %}<div class="odoo-padres-list">{% for padre in padres %}{{ padre.nombres }} {{ padre.apellidos }}{% if not forloop.last %}, {% endif %}{% endfor %}</div>{% else %}<span class="odoo-empty">Sin asignar</span>{% endif %}{% endwith %}</td>
                    {% endif %}
                    {% if 'nuevo_creyente' in MODULOS_ACTIVOS %}
                    <td>{% if m.nc_enviado %}<span class="odoo-badge odoo-badge-success">En seguimiento</span>{% else %}<span class="odoo-badge odoo-badge-warning">Pendiente</span>{% endif %}</td>
                    {% endif %}
                    <td class="odoo-td-actions no-print" onclick="event.stopPropagation();">
                        <div class="odoo-row-actions">
                            <a href="{% url 'miembros_app:nuevo_creyente_detalle' m.pk %}" class="odoo-action-icon" title="Ver"><span class="material-icons">visibility</span></a>
                            <a href="{% url 'miembros_app:nuevo_creyente_editar' m.pk %}" class="odoo-action-icon" title="Editar"><span class="material-icons">edit</span></a>
                            {% if 'nuevo_creyente' in MODULOS_ACTIVOS %}
                                {% if not m.activo %}<span class="odoo-action-icon odoo-action-disabled" title="Inactivo"><span class="material-icons">block</span></span>
                                {% elif m.nc_enviado %}<span class="odoo-action-icon odoo-action-disabled" title="Ya enviado"><span class="material-icons">send</span></span>
                                {% else %}<form method="post" action="{% url 'miembros_app:enviar_a_nuevo_creyente' m.pk %}" style="display:inline;" onsubmit="return confirm('¿Enviar a seguimiento?');"><input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}"><input type="hidden" name="next" value="{{ request.get_full_path }}"><button type="submit" class="odoo-action-icon" title="Enviar a seguimiento"><span class="material-icons">send</span></button></form>{% endif %}
                            {% endif %}
                        </div>
                    </td>
                </tr>
                {% endfor %}
            {% else %}
                <tr><td colspan="8" class="odoo-empty-row"><span class="material-icons">search_off</span>No se encontraron nuevos creyentes con los filtros actuales.</td></tr>
            {% endif %}
        </tbody>
    </table>
    {% if miembros %}<div class="odoo-table-footer"><span class="odoo-total-label">Total:</span><span class="odoo-total-value">{{ miembros|length }} nuevo{{ miembros|length|pluralize:"s" }} creyente{{ miembros|length|pluralize:"s" }}</span></div>{% endif %}
</div>

<!-- VISTA KANBAN (Tarjetas estilo Odoo) -->
<div class="odoo-kanban-container no-print" id="vista-cuadricula" style="display: none;">
    {% if miembros %}
        <div class="odoo-kanban-grid">
            {% for m in miembros %}
            <article class="odoo-kanban-card" onclick="window.location='{% url 'miembros_app:nuevo_creyente_detalle' m.pk %}'">
                <div class="odoo-kanban-avatar" style="background: {% cycle '#3b82f6' '#10b981' '#f59e0b' '#ef4444' '#8b5cf6' '#ec4899' %};">
                    <span class="odoo-kanban-initial">{{ m.nombres|slice:":1"|upper }}</span>
                </div>
                <div class="odoo-kanban-content">
                    <div class="odoo-kanban-header">
                        <div class="odoo-kanban-name">{{ m.nombres }} {{ m.apellidos }}</div>
                        {% if 'nuevo_creyente' in MODULOS_ACTIVOS %}
                        <span class="odoo-kanban-status {% if m.nc_enviado %}is-success{% else %}is-pending{% endif %}"></span>
                        {% endif %}
                    </div>
                    {% if m.telefono %}
                    <div class="odoo-kanban-phone">{{ m.telefono }}</div>
                    {% endif %}
                    <div class="odoo-kanban-footer">
                        {% if m.fecha_conversion %}<span class="odoo-kanban-date">{{ m.fecha_conversion|date:"d/m/Y" }}</span>{% endif %}
                        {% if m.telefono %}
                        <a href="https://wa.me/{{ m.telefono|cut:' '|cut:'-' }}" target="_blank" class="odoo-kanban-wa" onclick="event.stopPropagation();" title="WhatsApp">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.486 2 2 6.486 2 12c0 1.86.507 3.599 1.387 5.106L2 22l5.043-1.356A9.93 9.93 0 0 0 12 22c5.514 0 10-4.486 10-10S17.514 2 12 2z"/></svg>
                        </a>
                        {% endif %}
                    </div>
                </div>
            </article>
            {% endfor %}
        </div>
    {% else %}
        <div class="odoo-empty-kanban"><span class="material-icons">search_off</span><p>No se encontraron nuevos creyentes.</p></div>
    {% endif %}
</div>

<!-- ESTILOS (Igual a listado_miembros.html) -->
<style>
.odoo-control-bar{display:flex;align-items:center;justify-content:space-between;gap:16px;padding:8px 16px;background:#f8f9fa;border-bottom:1px solid #dee2e6;position:sticky;top:0;z-index:100}
.odoo-control-left{display:flex;align-items:center;gap:12px}
.odoo-control-center{flex:1;max-width:600px}
.odoo-control-right{display:flex;align-items:center;gap:12px}
.odoo-btn{display:inline-flex;align-items:center;gap:4px;padding:6px 12px;font-size:13px;font-weight:500;border:none;border-radius:4px;cursor:pointer;text-decoration:none;transition:all .15s ease}
.odoo-btn .material-icons{font-size:18px}
.odoo-btn-primary{background:#017e84;color:#fff}
.odoo-btn-primary:hover{background:#016166}
.odoo-btn-secondary{background:#f8f9fa;color:#495057;border:1px solid #dee2e6}
.odoo-btn-secondary:hover{background:#e9ecef}
.odoo-breadcrumb{display:flex;align-items:center;gap:6px;padding:4px 10px;background:#fff;border:1px solid #dee2e6;border-radius:4px;font-size:13px;color:#495057}
.odoo-breadcrumb-title{font-weight:500}
.odoo-breadcrumb-icon{font-size:16px;color:#6c757d;cursor:pointer}
.odoo-search-form{display:flex;align-items:center;background:#fff;border:1px solid #dee2e6;border-radius:4px;padding:0 8px;gap:8px}
.odoo-search-icon{font-size:20px;color:#6c757d}
.odoo-search-filters{display:flex;gap:6px;flex-wrap:wrap}
.odoo-filter-tag{display:inline-flex;align-items:center;gap:4px;background:#e3f2fd;color:#1565c0;padding:2px 8px;border-radius:3px;font-size:12px}
.odoo-filter-remove{background:none;border:none;color:#1565c0;cursor:pointer;font-size:14px;line-height:1;padding:0}
.odoo-filter-remove:hover{color:#0d47a1}
.odoo-search-input{flex:1;border:none;padding:8px 0;font-size:14px;outline:none;min-width:120px}
.odoo-filter-dropdown{border-left:1px solid #dee2e6;padding-left:8px}
.odoo-filter-btn{display:flex;align-items:center;gap:2px;background:none;border:none;color:#6c757d;font-size:13px;cursor:pointer;padding:4px}
.odoo-filter-btn:hover{color:#495057}
.odoo-filter-btn .material-icons{font-size:18px}
.odoo-pagination-info{font-size:13px;color:#6c757d}
.odoo-pagination-btns{display:flex;gap:2px}
.odoo-page-btn{background:#fff;border:1px solid #dee2e6;border-radius:4px;padding:4px;cursor:pointer;display:flex}
.odoo-page-btn:disabled{opacity:.5;cursor:not-allowed}
.odoo-page-btn .material-icons{font-size:18px;color:#6c757d}
.odoo-view-toggle{display:flex;border:1px solid #dee2e6;border-radius:4px;overflow:hidden}
.odoo-view-btn{background:#fff;border:none;padding:6px 8px;cursor:pointer;display:flex;border-right:1px solid #dee2e6}
.odoo-view-btn:last-child{border-right:none}
.odoo-view-btn .material-icons{font-size:18px;color:#6c757d}
.odoo-view-btn.active{background:#e9ecef}
.odoo-view-btn.active .material-icons{color:#495057}
.odoo-actions-menu{position:relative}
.odoo-action-btn{background:#fff;border:1px solid #dee2e6;border-radius:4px;padding:4px;cursor:pointer;display:flex}
.odoo-action-btn .material-icons{font-size:20px;color:#6c757d}
.odoo-actions-dropdown{display:none;position:absolute;top:100%;right:0;background:#fff;border:1px solid #dee2e6;border-radius:4px;box-shadow:0 4px 12px rgba(0,0,0,.15);min-width:180px;z-index:200;margin-top:4px}
.odoo-actions-dropdown.show{display:block}
.odoo-actions-dropdown button,.odoo-actions-dropdown a{display:flex;align-items:center;gap:8px;width:100%;padding:10px 12px;font-size:13px;color:#495057;background:none;border:none;cursor:pointer;text-decoration:none}
.odoo-actions-dropdown button:hover,.odoo-actions-dropdown a:hover{background:#f8f9fa}
.odoo-actions-dropdown .material-icons{font-size:18px;color:#6c757d}
.odoo-filter-overlay{display:none}
.odoo-filter-panel{display:none;background:#f8f9fa;border-bottom:1px solid #dee2e6;padding:16px}
.odoo-filter-panel.is-open{display:block}
.odoo-filter-panel-header{display:none}
.odoo-filter-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:16px}
.odoo-filter-group{display:flex;flex-direction:column;gap:4px}
.odoo-filter-group label{font-size:12px;font-weight:500;color:#495057}
.odoo-filter-group select,.odoo-filter-group input[type="date"]{padding:8px 10px;font-size:13px;border:1px solid #ced4da;border-radius:4px;background:#fff}
.odoo-filter-group select:focus,.odoo-filter-group input:focus{outline:none;border-color:#017e84}
.odoo-filter-checks{display:flex;flex-wrap:wrap;gap:12px}
.odoo-filter-checkbox{display:flex;align-items:center;gap:6px;font-size:13px;color:#495057;cursor:pointer}
.odoo-filter-checkbox input{width:16px;height:16px;accent-color:#017e84}
.odoo-filter-actions{display:flex;justify-content:flex-end;gap:8px;margin-top:16px;padding-top:16px;border-top:1px solid #dee2e6}
.odoo-list-container{background:#fff}
.odoo-table{width:100%;border-collapse:collapse}
.odoo-table thead{position:sticky;top:49px;z-index:50}
.odoo-table th{background:#f8f9fa;padding:10px 12px;font-size:12px;font-weight:600;text-align:left;color:#495057;border-bottom:2px solid #dee2e6;white-space:nowrap}
.odoo-table td{padding:10px 12px;font-size:13px;border-bottom:1px solid #e9ecef;vertical-align:middle}
.odoo-th-checkbox,.odoo-td-checkbox{width:40px;text-align:center}
.odoo-th-sortable{cursor:pointer}
.odoo-th-sortable:hover{background:#e9ecef}
.odoo-sort-icon{font-size:16px;vertical-align:middle;opacity:.5}
.odoo-td-code{font-family:'Roboto Mono',monospace;font-size:12px;color:#6c757d}
.odoo-td-main{min-width:200px}
.odoo-member-name a{color:#017e84;text-decoration:none;font-weight:500}
.odoo-member-name a:hover{text-decoration:underline}
.odoo-member-sub{font-size:12px;color:#6c757d;margin-top:2px}
.odoo-td-contact{min-width:150px}
.odoo-contact-line{display:flex;align-items:center;gap:6px;font-size:13px}
.odoo-wa-link{color:#25d366;display:inline-flex}
.odoo-wa-link:hover{color:#128c7e}
.odoo-contact-email{font-size:12px;color:#6c757d;margin-top:2px}
.odoo-empty{color:#adb5bd}
.odoo-padres-list{font-size:12px;color:#495057;line-height:1.4}
.odoo-badge{display:inline-flex;align-items:center;gap:4px;padding:3px 8px;font-size:11px;font-weight:500;border-radius:3px}
.odoo-badge-success{background:#d1fae5;color:#065f46}
.odoo-badge-warning{background:#fef3c7;color:#92400e}
.odoo-badge-info{background:#dbeafe;color:#1e40af}
.odoo-td-actions{width:100px}
.odoo-row-actions{display:flex;align-items:center;gap:4px}
.odoo-action-icon{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border:none;background:transparent;color:#6c757d;border-radius:4px;cursor:pointer;text-decoration:none;transition:all .15s ease}
.odoo-action-icon:hover{background:#e9ecef;color:#495057}
.odoo-action-icon .material-icons{font-size:18px}
.odoo-action-disabled{opacity:.35;cursor:not-allowed}
.odoo-action-disabled:hover{background:transparent;color:#6c757d}
.odoo-row{transition:background .15s ease}
.odoo-row:hover{background:#f8f9fa}
.odoo-empty-row{text-align:center;padding:48px 24px!important;color:#6c757d}
.odoo-empty-row .material-icons{font-size:48px;opacity:.5;display:block;margin-bottom:8px}
.odoo-table-footer{display:flex;align-items:center;gap:8px;padding:12px 16px;background:#f8f9fa;border-top:1px solid #dee2e6;font-size:13px}
.odoo-total-label{color:#6c757d}
.odoo-total-value{font-weight:500;color:#495057}
.odoo-kanban-container{padding:12px;background:#f8f9fa;min-height:calc(100vh - 200px)}
.odoo-kanban-grid{display:flex;flex-direction:column;gap:8px}
.odoo-kanban-card{display:flex;background:#fff;border-radius:10px;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,.08);cursor:pointer;transition:all .2s ease}
.odoo-kanban-card:active{transform:scale(.98);background:#f9fafb}
.odoo-kanban-avatar{width:72px;min-width:72px;display:flex;align-items:center;justify-content:center;color:#fff}
.odoo-kanban-initial{font-size:28px;font-weight:600}
.odoo-kanban-content{flex:1;padding:12px;display:flex;flex-direction:column;justify-content:center;min-width:0}
.odoo-kanban-header{display:flex;align-items:center;gap:8px;margin-bottom:2px}
.odoo-kanban-name{font-size:15px;font-weight:600;color:#1f2937;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.odoo-kanban-status{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.odoo-kanban-status.is-success{background:#10b981}
.odoo-kanban-status.is-pending{background:#f59e0b}
.odoo-kanban-phone{font-size:13px;color:#6b7280;margin-bottom:4px}
.odoo-kanban-footer{display:flex;align-items:center;justify-content:space-between}
.odoo-kanban-date{font-size:12px;color:#9ca3af}
.odoo-kanban-wa{width:32px;height:32px;display:flex;align-items:center;justify-content:center;background:#dcfce7;color:#16a34a;border-radius:50%;text-decoration:none}
.odoo-kanban-wa:active{background:#bbf7d0}
.odoo-empty-kanban{text-align:center;padding:64px 24px;color:#6b7280}
.odoo-empty-kanban .material-icons{font-size:64px;opacity:.4;margin-bottom:16px}
.only-print{display:none}
@media print{.no-print{display:none!important}.only-print{display:block!important}.odoo-table thead{position:static}.odoo-table th,.odoo-table td{font-size:10px;padding:4px 6px}.odoo-row-actions{display:none}}

/* RESPONSIVE */
@media (max-width:1024px){.odoo-control-bar{flex-wrap:wrap;gap:8px}.odoo-control-center{order:3;max-width:100%;flex-basis:100%}}
@media (max-width:768px){
#vista-lista{display:none!important}
#vista-cuadricula{display:block!important}
.odoo-view-toggle{display:none}
.odoo-control-bar{padding:8px 12px;gap:8px}
.odoo-control-left{flex:1}
.odoo-control-right{gap:6px}
.odoo-pagination-info,.odoo-pagination-btns{display:none}
.odoo-search-form{padding:6px 10px}
.odoo-search-input{font-size:14px}
.odoo-filter-grid{grid-template-columns:1fr 1fr;gap:10px}
.odoo-filter-group label{font-size:11px}
.odoo-filter-group select,.odoo-filter-group input{font-size:13px;padding:8px 10px}
.odoo-filter-panel{padding:12px}
.odoo-filter-actions{flex-wrap:wrap;gap:8px}
.odoo-filter-actions .odoo-btn{flex:1;justify-content:center}
.odoo-kanban-grid{gap:10px;padding:12px}
.odoo-kanban-avatar{width:64px;min-width:64px}
.odoo-kanban-initial{font-size:24px}
.odoo-btn{padding:8px 12px;font-size:13px}
.odoo-btn .material-icons{font-size:18px}
.odoo-btn-primary span:not(.material-icons){display:none}
.odoo-btn-primary{padding:8px 10px}
.odoo-filter-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:1000;opacity:0;transition:opacity .25s ease}
.odoo-filter-overlay.is-open{display:block;opacity:1}
.odoo-filter-panel{position:fixed;bottom:0;left:0;right:0;max-height:85vh;background:#fff;border-radius:20px 20px 0 0;box-shadow:0 -4px 20px rgba(0,0,0,.15);z-index:1001;transform:translateY(100%);transition:transform .3s cubic-bezier(.4,0,.2,1);overflow:hidden;display:flex;flex-direction:column}
.odoo-filter-panel.is-open{transform:translateY(0)}
.odoo-filter-panel-header{display:flex;align-items:center;justify-content:space-between;padding:16px 20px;border-bottom:1px solid #e5e7eb;font-weight:600;font-size:16px;color:#1f2937;flex-shrink:0}
.odoo-filter-close-btn{width:32px;height:32px;border-radius:50%;background:#f3f4f6;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;color:#6b7280}
.odoo-filter-close-btn:hover{background:#e5e7eb}
.odoo-filter-form{flex:1;overflow-y:auto;padding:16px;padding-bottom:calc(16px + env(safe-area-inset-bottom,0))}
.odoo-filter-grid{grid-template-columns:1fr 1fr;gap:12px}
.odoo-filter-actions{flex-direction:row;gap:10px}
.odoo-filter-actions .odoo-btn{flex:1;justify-content:center;padding:12px}
}
@media (max-width:400px){
.odoo-kanban-avatar{width:56px;min-width:56px}
.odoo-kanban-initial{font-size:22px}
.odoo-kanban-name{font-size:14px}
.odoo-kanban-content{padding:10px}
.odoo-filter-grid{grid-template-columns:1fr}
}
</style>

<!-- SCRIPTS -->
<script>
function toggleFilterPanel(){const p=document.getElementById('filter-panel'),o=document.getElementById('filter-overlay'),m=window.innerWidth<=768;if(m){p.classList.toggle('is-open');o.classList.toggle('is-open');document.body.style.overflow=p.classList.contains('is-open')?'hidden':''}else{p.classList.toggle('is-open')}}
function closeFilterPanel(){const p=document.getElementById('filter-panel'),o=document.getElementById('filter-overlay');p.classList.remove('is-open');o.classList.remove('is-open');document.body.style.overflow=''}
function clearFilters(){const f=document.querySelector('.odoo-filter-form');f.querySelectorAll('select').forEach(s=>s.value='');f.querySelectorAll('input[type="date"]').forEach(i=>i.value='');f.querySelectorAll('input[type="checkbox"]').forEach(c=>c.checked=false)}
function toggleActionsMenu(){document.getElementById('actions-dropdown').classList.toggle('show')}
document.addEventListener('click',function(e){const m=document.querySelector('.odoo-actions-menu'),d=document.getElementById('actions-dropdown');if(m&&!m.contains(e.target))d.classList.remove('show')});
document.addEventListener('DOMContentLoaded',function(){const o=document.getElementById('filter-overlay'),c=document.getElementById('filter-close-btn');if(o)o.addEventListener('click',closeFilterPanel);if(c)c.addEventListener('click',closeFilterPanel)});
function removeFilter(n){const f=document.getElementById('main-search-form'),i=f.querySelector('input[name="'+n+'"]');if(i){if(i.type==='checkbox')i.checked=false;else i.value=''}let h=f.querySelector('input[name="filtros_abiertos"]');if(!h){h=document.createElement('input');h.type='hidden';h.name='filtros_abiertos';f.appendChild(h)}h.value='1';f.submit()}
document.addEventListener('DOMContentLoaded',function(){const p=new URLSearchParams(window.location.search);if(p.get('filtros_abiertos')==='1'){document.getElementById('filter-panel').classList.add('is-open');if(window.innerWidth<=768)document.getElementById('filter-overlay').classList.add('is-open')}});
document.addEventListener('DOMContentLoaded',function(){const bl=document.querySelector('.odoo-view-btn[data-view="lista"]'),bg=document.querySelector('.odoo-view-btn[data-view="grid"]'),vl=document.getElementById('vista-lista'),vg=document.getElementById('vista-cuadricula');if(!bl||!bg||!vl||!vg)return;function setView(v){if(v==='grid'){vl.style.display='none';vg.style.display='';bg.classList.add('active');bl.classList.remove('active')}else{vl.style.display='';vg.style.display='none';bl.classList.add('active');bg.classList.remove('active')}try{localStorage.setItem('nc_vista',v)}catch(e){}}let s=null;try{s=localStorage.getItem('nc_vista')}catch(e){}setView(s==='grid'?'grid':'lista');bl.addEventListener('click',function(){setView('lista')});bg.addEventListener('click',function(){setView('grid')})});
document.addEventListener('DOMContentLoaded',function(){const sa=document.getElementById('select-all'),rc=document.querySelectorAll('.row-checkbox');if(sa)sa.addEventListener('change',function(){rc.forEach(cb=>cb.checked=sa.checked)})});
</script>

{% endblock %}