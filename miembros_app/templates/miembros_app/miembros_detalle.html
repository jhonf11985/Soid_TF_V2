{% extends 'miembros_app/base_miembros.html' %}

{% block title %}{{ miembro.nombres }} {{ miembro.apellidos }}{% endblock %}

{% block miembros_content %}

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     BARRA DE CONTROL SUPERIOR (Estilo Odoo)
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="odoo-control-bar">
    <div class="odoo-control-left">
        <a href="{% url 'miembros_app:lista' %}" class="odoo-btn odoo-btn-secondary">
            <span class="material-icons">arrow_back</span>
        </a>
        
        <div class="odoo-breadcrumb">
            <a href="{% url 'miembros_app:lista' %}" class="odoo-breadcrumb-link">Miembros</a>
            <span class="material-icons">chevron_right</span>
            <span class="odoo-breadcrumb-current">{{ miembro.codigo_miembro }}</span>
        </div>
    </div>

    <div class="odoo-control-right">
        <a href="{% url 'miembros_app:miembro_enviar_ficha_email' miembro.pk %}" class="odoo-btn odoo-btn-secondary">
            <span class="material-icons">mail</span>
            Enviar
        </a>
        <a href="{% url 'miembros_app:ficha' miembro.pk %}" class="odoo-btn odoo-btn-secondary">
            <span class="material-icons">description</span>
            Ficha
        </a>
        {% if miembro.activo and can_dar_salida %}
            <a href="{% url 'miembros_app:miembro_dar_salida' miembro.pk %}" class="odoo-btn odoo-btn-secondary" style="border-color:#f1c40f;">
                <span class="material-icons">person_off</span>
                Dar salida
            </a>
        {% endif %}

        <a href="{% url 'miembros_app:editar' miembro.pk %}" class="odoo-btn odoo-btn-primary">
            <span class="material-icons">edit</span>
            Editar
        </a>
    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     CONTENIDO PRINCIPAL (Layout estilo Odoo Form)
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="odoo-detail-container">

    <!-- HEADER: Avatar + Nombre + Info rÃ¡pida -->
    <div class="odoo-detail-header">
        
        <!-- Avatar -->
        <div class="odoo-detail-avatar" style="background: {% if miembro.genero == 'M' %}#3b82f6{% else %}#ec4899{% endif %};">
            {% if miembro.foto %}
                <img src="{{ miembro.foto.url }}" alt="{{ miembro.nombres }}">
            {% else %}
                <span class="odoo-avatar-initial">{{ miembro.nombres|slice:":1"|upper }}</span>
            {% endif %}
        </div>

        <!-- Info principal -->
        <div class="odoo-detail-info">
            <h1 class="odoo-detail-name">{{ miembro.nombres }} {{ miembro.apellidos }}</h1>
            
            <div class="odoo-detail-badges">
                {% if not miembro.activo %}
                    <span class="odoo-badge odoo-badge-danger">Inactivo</span>
                {% endif %}
                
                {% if miembro.estado_miembro %}
                    <span class="odoo-badge odoo-badge-{% if miembro.estado_miembro == 'activo' %}success{% elif miembro.estado_miembro == 'pasivo' %}warning{% elif miembro.estado_miembro == 'disciplina' or miembro.estado_miembro == 'descarriado' %}danger{% else %}info{% endif %}">
                        {{ miembro.get_estado_miembro_display }}
                    </span>
                {% endif %}
                
                {% if miembro.edad and miembro.edad < EDAD_MINIMA_MIEMBRO_OFICIAL %}
                    <span class="odoo-badge odoo-badge-neutral">NiÃ±o(a)</span>
                {% endif %}
                
                {% if miembro.edad %}
                    <span class="odoo-badge odoo-badge-info">{{ miembro.edad }} aÃ±os</span>
                {% endif %}
                
                {% if miembro.categoria_edad %}
                    <span class="odoo-badge odoo-badge-neutral">{{ miembro.get_categoria_edad_display }}</span>
                {% endif %}
                
                {% if miembro.bautizado_confirmado %}
                    <span class="odoo-badge odoo-badge-success">Bautizado</span>
                {% endif %}
            </div>

            <!-- Quick info -->
            <div class="odoo-detail-quick">
                {% if miembro.email %}
                <div class="odoo-quick-item">
                    <span class="material-icons">mail</span>
                    <a href="mailto:{{ miembro.email }}">{{ miembro.email }}</a>
                </div>
                {% endif %}
                {% if miembro.telefono %}
                <div class="odoo-quick-item">
                    <span class="material-icons">phone</span>
                    <span>{{ miembro.telefono }}</span>
                </div>
                {% endif %}
                {% if miembro.whatsapp %}
                <div class="odoo-quick-item">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="#25d366">
                        <path d="M12 2C6.486 2 2 6.486 2 12c0 1.86.507 3.599 1.387 5.106L2 22l5.043-1.356A9.93 9.93 0 0 0 12 22c5.514 0 10-4.486 10-10S17.514 2 12 2z"/>
                    </svg>
                    <a href="https://wa.me/{{ miembro.whatsapp|cut:' '|cut:'-' }}" target="_blank">{{ miembro.whatsapp }}</a>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- CÃ³digo del miembro -->
        <div class="odoo-detail-code">
            <span class="odoo-code-label">CÃ³digo</span>
            <span class="odoo-code-value">{{ miembro.codigo_miembro }}</span>
        </div>
    </div>

    <!-- SITUACIÃ“N EN LA IGLESIA (Card destacada) -->
    <div class="odoo-situation-card {% if not miembro.activo %}odoo-situation-inactive{% elif miembro.estado_miembro == 'disciplina' or miembro.estado_miembro == 'descarriado' %}odoo-situation-warning{% else %}odoo-situation-ok{% endif %}">
        <div class="odoo-situation-icon">
            {% if not miembro.activo %}
                <span class="material-icons">person_off</span>
            {% elif miembro.estado_miembro == 'disciplina' %}
                <span class="material-icons">gavel</span>
            {% elif miembro.estado_miembro == 'descarriado' %}
                <span class="material-icons">heart_broken</span>
            {% elif miembro.estado_miembro == 'observacion' %}
                <span class="material-icons">visibility</span>
            {% elif miembro.es_miembro_oficial %}
                <span class="material-icons">verified</span>
            {% else %}
                <span class="material-icons">person</span>
            {% endif %}
        </div>
        <div class="odoo-situation-content">
            <strong>SituaciÃ³n actual en la iglesia</strong>
            
            {% if not miembro.activo %}
                <p>Actualmente no estÃ¡ activo en la membresÃ­a oficial.</p>
                {% if miembro.razon_salida %}
                    <p><span class="odoo-sit-label">RazÃ³n:</span> {{ miembro.razon_salida }}</p>
                {% endif %}
                {% if miembro.fecha_salida %}
                    <p><span class="odoo-sit-label">Fecha de salida:</span> {{ miembro.fecha_salida|date:"d/m/Y" }}</p>
                {% endif %}
                {% if miembro.comentario_salida %}
                    <p><span class="odoo-sit-label">Comentario:</span> {{ miembro.comentario_salida }}</p>
                {% endif %}
                
            {% elif miembro.edad and miembro.edad < EDAD_MINIMA_MIEMBRO_OFICIAL %}
                <p>Menor de {{ EDAD_MINIMA_MIEMBRO_OFICIAL }} aÃ±os. Registrado como niÃ±o(a) de la congregaciÃ³n, aÃºn no forma parte de la membresÃ­a oficial.</p>
                
            {% else %}
                {% if miembro.es_miembro_oficial %}
                    {% if miembro.estado_miembro == "pasivo" %}
                        <p>Forma parte de la membresÃ­a oficial, pero estÃ¡ en estado <strong>pasivo</strong> y no participa activamente.</p>
                    {% elif miembro.estado_miembro == "observacion" %}
                        <p>Miembro oficial en <strong>observaciÃ³n pastoral</strong> con restricciones para participar en algunas Ã¡reas.</p>
                    {% elif miembro.estado_miembro == "disciplina" %}
                        <p>Miembro oficial bajo <strong>disciplina</strong>. No puede participar en ministerios ni servicios.</p>
                    {% elif miembro.estado_miembro == "descarriado" %}
                        <p>Miembro <strong>descarriado</strong>: no se congrega regularmente. Se mantiene en registro para seguimiento pastoral.</p>
                    {% elif miembro.estado_miembro == "catecumeno" %}
                        <p><strong>CatecÃºmeno</strong>: en proceso de preparaciÃ³n antes de ser recibido como miembro oficial.</p>
                    {% else %}
                        <p>Forma parte de la <strong>membresÃ­a oficial</strong> y puede participar normalmente en ministerios y actividades.</p>
                    {% endif %}
                {% else %}
                    {% if miembro.estado_miembro == "catecumeno" %}
                        <p><strong>CatecÃºmeno</strong>: asistiendo y en preparaciÃ³n para ser recibido como miembro oficial.</p>
                    {% else %}
                        <p>Se congrega en la iglesia, pero aÃºn no forma parte de la <strong>membresÃ­a oficial</strong>.</p>
                    {% endif %}
                {% endif %}
            {% endif %}
        </div>
    </div>

    <!-- TABS DE INFORMACIÃ“N -->
    <div class="odoo-detail-tabs">
        <button type="button" class="odoo-tab active" data-tab="personal">
            <span class="material-icons">person</span>
            Personal
        </button>
        <button type="button" class="odoo-tab" data-tab="contacto">
            <span class="material-icons">contact_phone</span>
            Contacto
        </button>
        <button type="button" class="odoo-tab" data-tab="membresia">
            <span class="material-icons">card_membership</span>
            MembresÃ­a
        </button>
        <button type="button" class="odoo-tab" data-tab="salud">
            <span class="material-icons">medical_services</span>
            Salud
        </button>
        <button type="button" class="odoo-tab" data-tab="trabajo">
            <span class="material-icons">work</span>
            Trabajo
        </button>
        <button type="button" class="odoo-tab" data-tab="familia">
            <span class="material-icons">family_restroom</span>
            Familia
        </button>

        <button type="button" class="odoo-tab" data-tab="privado">
        <span class="material-icons">lock</span>
        Privado
    </button>
        {% if MODULOS_ACTIVOS.Finanzas %}
        <button type="button" class="odoo-tab" data-tab="finanzas">
            <span class="material-icons">account_balance_wallet</span>
            Historial Financiero
        </button>
        {% endif %}
        {% if MODULOS_ACTIVOS.Estructura or MODULOS_ACTIVOS.Unidad or MODULOS_ACTIVOS.Unidades %}
        <button type="button" class="odoo-tab" data-tab="unidades">
        <span class="material-icons">apartment</span>
        Unidades
        </button>
        {% endif %}



        <button type="button" class="odoo-tab" data-tab="otros">
            <span class="material-icons">more_horiz</span>
            Otros
        </button>
    </div>

    <!-- CONTENIDO DE TABS -->
    <div class="odoo-tab-contents">
        
        <!-- TAB: Personal -->
        <div class="odoo-tab-content active" id="tab-personal">
            <div class="odoo-fields-grid">
                <div class="odoo-field">
                    <label>Fecha de nacimiento</label>
                    <span>{% if miembro.fecha_nacimiento %}{{ miembro.fecha_nacimiento|date:"d/m/Y" }}{% else %}â€”{% endif %}</span>
                </div>
                <div class="odoo-field">
                    <label>Lugar de nacimiento</label>
                    <span>{{ miembro.lugar_nacimiento|default:"â€”" }}</span>
                </div>
                <div class="odoo-field">
                    <label>GÃ©nero</label>
                    <span>{{ miembro.get_genero_display|default:"â€”" }}</span>
                </div>
                <div class="odoo-field">
                <label>Estado civil</label>
                <span>{% if miembro.estado_civil %}{{ miembro.estado_civil }}{% else %}â€”{% endif %}</span>
                </div>

                <div class="odoo-field">
                    <label>Nacionalidad</label>
                    <span>{{ miembro.nacionalidad|default:"â€”" }}</span>
                </div>
                <div class="odoo-field">
                    <label>CÃ©dula</label>
                    <span>{{ miembro.cedula|default:"â€”" }}</span>
                </div>
                <div class="odoo-field">
                    <label>Pasaporte</label>
                    <span>{{ miembro.pasaporte|default:"â€”" }}</span>
                </div>
                <div class="odoo-field">
                <label>Nivel educativo</label>
                <span>{% if miembro.nivel_educativo %}{{ miembro.nivel_educativo }}{% else %}â€”{% endif %}</span>
                </div>

                <div class="odoo-field">
                    <label>ProfesiÃ³n</label>
                    <span>{{ miembro.profesion|default:"â€”" }}</span>
                </div>
            </div>
        </div>

        <!-- TAB: Contacto -->
        <div class="odoo-tab-content" id="tab-contacto">
            <div class="odoo-fields-grid">
                <div class="odoo-field">
                    <label>TelÃ©fono principal</label>
                    <span>{{ miembro.telefono|default:"â€”" }}</span>
                </div>
                <div class="odoo-field">
                    <label>TelÃ©fono secundario</label>
                    <span>{{ miembro.telefono_secundario|default:"â€”" }}</span>
                </div>
                <div class="odoo-field">
                    <label>WhatsApp</label>
                    <span>
                        {% if miembro.whatsapp %}
                            <a href="https://wa.me/{{ miembro.whatsapp|cut:' '|cut:'-' }}" target="_blank">{{ miembro.whatsapp }}</a>
                        {% else %}â€”{% endif %}
                    </span>
                </div>
                <div class="odoo-field">
                    <label>Correo electrÃ³nico</label>
                    <span>
                        {% if miembro.email %}
                            <a href="mailto:{{ miembro.email }}">{{ miembro.email }}</a>
                        {% else %}â€”{% endif %}
                    </span>
                </div>
                <div class="odoo-field odoo-field-full">
                    <label>DirecciÃ³n</label>
                    <span>
                        {% if miembro.direccion %}
                            {{ miembro.direccion }}
                            {% if miembro.sector %}, {{ miembro.sector }}{% endif %}
                            {% if miembro.ciudad %}, {{ miembro.ciudad }}{% endif %}
                            {% if miembro.provincia %}, {{ miembro.provincia }}{% endif %}
                            {% if miembro.codigo_postal %} ({{ miembro.codigo_postal }}){% endif %}
                        {% else %}â€”{% endif %}
                    </span>
                </div>
            </div>
        </div>

        <!-- TAB: MembresÃ­a -->
        <div class="odoo-tab-content" id="tab-membresia">
            <div class="odoo-fields-grid">
                <div class="odoo-field">
                    <label>Estado del miembro</label>
                    <span>
                        {% if miembro.estado_miembro %}
                            <span class="odoo-badge odoo-badge-{% if miembro.estado_miembro == 'activo' %}success{% elif miembro.estado_miembro == 'pasivo' %}warning{% else %}info{% endif %}">
                                {{ miembro.get_estado_miembro_display }}
                            </span>
                        {% else %}â€”{% endif %}
                    </span>
                </div>
                <div class="odoo-field">
                    <label>CategorÃ­a</label>
                    <span>
                        {% if miembro.categoria_edad %}
                            {{ miembro.get_categoria_edad_display }}
                        {% else %}
                            â€”
                        {% endif %}
                    </span>
                </div>

                <div class="odoo-field">
                    <label>Fecha de ingreso</label>
                    <span>{% if miembro.fecha_ingreso_iglesia %}{{ miembro.fecha_ingreso_iglesia|date:"d/m/Y" }}{% else %}â€”{% endif %}</span>
                </div>
                <div class="odoo-field">
                    <label>Iglesia anterior</label>
                    <span>{{ miembro.iglesia_anterior|default:"â€”" }}</span>
                </div>
                <div class="odoo-field">
                    <label>Fecha de conversiÃ³n</label>
                    <span>{% if miembro.fecha_conversion %}{{ miembro.fecha_conversion|date:"d/m/Y" }}{% else %}â€”{% endif %}</span>
                </div>
                <div class="odoo-field">
                    <label>Fecha de bautismo</label>
                    <span>{% if miembro.fecha_bautismo %}{{ miembro.fecha_bautismo|date:"d/m/Y" }}{% else %}â€”{% endif %}</span>
                </div>
                <div class="odoo-field">
                    <label>Bautizado confirmado</label>
                    <span>
                        {% if miembro.bautizado_confirmado %}
                            <span class="odoo-badge odoo-badge-success">SÃ­</span>
                        {% else %}
                            <span class="odoo-badge odoo-badge-neutral">No</span>
                        {% endif %}
                    </span>
                </div>
                <div class="odoo-field">
                    <label>Mentor</label>
                    <span>{{ miembro.mentor|default:"â€”" }}</span>
                </div>
                <div class="odoo-field">
                    <label>LÃ­der de cÃ©lula</label>
                    <span>{{ miembro.lider_celula|default:"â€”" }}</span>
                </div>
            </div>
        </div>

        <!-- TAB: Salud -->
        <div class="odoo-tab-content" id="tab-salud">
            <div class="odoo-fields-grid">
                <div class="odoo-field">
                    <label>Contacto de emergencia</label>
                    <span>{{ miembro.contacto_emergencia_nombre|default:"â€”" }}</span>
                </div>
                <div class="odoo-field">
                    <label>TelÃ©fono de emergencia</label>
                    <span>{{ miembro.contacto_emergencia_telefono|default:"â€”" }}</span>
                </div>
                <div class="odoo-field">
                    <label>RelaciÃ³n</label>
                    <span>{{ miembro.contacto_emergencia_relacion|default:"â€”" }}</span>
                </div>
                <div class="odoo-field">
                    <label>Tipo de sangre</label>
                    <span>{{ miembro.tipo_sangre|default:"â€”" }}</span>
                </div>
                <div class="odoo-field odoo-field-full">
                    <label>Alergias</label>
                    <span>{{ miembro.alergias|default:"â€”" }}</span>
                </div>
                <div class="odoo-field odoo-field-full">
                    <label>Condiciones mÃ©dicas</label>
                    <span>{{ miembro.condiciones_medicas|default:"â€”" }}</span>
                </div>
                <div class="odoo-field odoo-field-full">
                    <label>Medicamentos</label>
                    <span>{{ miembro.medicamentos|default:"â€”" }}</span>
                </div>
            </div>
        </div>

        <!-- TAB: Trabajo -->
        <div class="odoo-tab-content" id="tab-trabajo">
            <div class="odoo-fields-grid">
                <div class="odoo-field">
                    <label>Empleador</label>
                    <span>{{ miembro.empleador|default:"â€”" }}</span>
                </div>
                <div class="odoo-field">
                    <label>Puesto</label>
                    <span>{{ miembro.puesto|default:"â€”" }}</span>
                </div>
                <div class="odoo-field">
                    <label>TelÃ©fono del trabajo</label>
                    <span>{{ miembro.telefono_trabajo|default:"â€”" }}</span>
                </div>
                <div class="odoo-field odoo-field-full">
                    <label>DirecciÃ³n del trabajo</label>
                    <span>{{ miembro.direccion_trabajo|default:"â€”" }}</span>
                </div>
            </div>
        </div>

        <!-- TAB: Familia -->
<!-- TAB: Familia -->
<div class="odoo-tab-content" id="tab-familia">
    {% if relaciones_familia %}
    <div class="odoo-table-container">
        <table class="odoo-table">
            <thead>
                <tr>
                    <th>Familiar</th>
                    <th>RelaciÃ³n</th>
                    <th>Vive junto</th>
                    <th>Responsable</th>
                </tr>
            </thead>
            <tbody>
                {% for rel in relaciones_familia %}
                <tr>
                    <td>
                        <a href="{% url 'miembros_app:detalle' rel.otro.pk %}">
                            {{ rel.otro.nombres }} {{ rel.otro.apellidos }}
                        </a>
                        {% if rel.notas %}
                            <div style="font-size:12px;color:#6c757d;margin-top:4px;">
                                {{ rel.notas }}
                            </div>
                        {% endif %}
                    </td>

                    <td>
                        <span class="odoo-badge odoo-badge-neutral">
                            {{ rel.tipo_label }}
                        </span>
                    </td>

                    <td>
                        {% if rel.vive_junto %}
                            <span class="odoo-badge odoo-badge-success">SÃ­</span>
                        {% else %}
                            <span class="odoo-badge odoo-badge-neutral">No</span>
                        {% endif %}
                    </td>

                    <td>
                        {% if rel.es_responsable %}
                            <span class="odoo-badge odoo-badge-info">SÃ­</span>
                        {% else %}
                            <span class="odoo-badge odoo-badge-neutral">No</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <p class="odoo-empty">No hay familiares registrados para este miembro.</p>
    {% endif %}
</div>
<!-- TAB: Privado -->
<div class="odoo-tab-content" id="tab-privado">

    {% if not privado_desbloqueado %}

        <div class="odoo-lock-box">
            <span class="material-icons odoo-lock-icon">lock</span>
            <h3>InformaciÃ³n privada</h3>
            <p>Esta secciÃ³n estÃ¡ protegida.</p>

            <input type="password"
                   id="privado-password"
                   class="odoo-input"
                   placeholder="ContraseÃ±a">

            <button type="button"
                    class="odoo-btn odoo-btn-primary"
                    onclick="desbloquearPrivado({{ miembro.pk }})">
                Desbloquear
            </button>

            <p id="privado-error" class="odoo-error" style="display:none;">
                ContraseÃ±a incorrecta
            </p>
        </div>

    {% else %}
    <div style="display:flex; justify-content:flex-end; margin-bottom:10px;">
    <button type="button" class="odoo-btn odoo-btn-secondary" onclick="bloquearPrivado({{ miembro.pk }})">
        <span class="material-icons" style="font-size:18px;">lock</span>
        Bloquear
    </button>
    </div>

        <!-- âœ… CONTENIDO SOLO CUANDO ESTÃ DESBLOQUEADO -->
        <div class="odoo-fields-grid">

            <div class="odoo-field">
                <label>Vivienda</label>
                <span>
                    {% if miembro.tipo_vivienda %}
                        {{ miembro.get_tipo_vivienda_display }}
                    {% else %}
                        â€”
                    {% endif %}
                </span>
            </div>

            <div class="odoo-field">
                <label>Tiene vehÃ­culo</label>
                <span>
                    {% if miembro.tiene_vehiculo %}
                        <span class="odoo-badge odoo-badge-success">SÃ­</span>
                    {% else %}
                        <span class="odoo-badge odoo-badge-neutral">No</span>
                    {% endif %}
                </span>
            </div>

            <div class="odoo-field">
                <label>Tipo de vehÃ­culo</label>
                <span>
                    {% if miembro.vehiculo_tipo %}
                        {{ miembro.get_vehiculo_tipo_display }}
                    {% else %}
                        â€”
                    {% endif %}
                </span>
            </div>

            <div class="odoo-field">
                <label>Marca</label>
                <span>{{ miembro.vehiculo_marca|default:"â€”" }}</span>
            </div>

            <div class="odoo-field">
                <label>Placa</label>
                <span>{{ miembro.vehiculo_placa|default:"â€”" }}</span>
            </div>

            <div class="odoo-field">
                <label>SituaciÃ³n econÃ³mica</label>
                <span>
                    {% if miembro.situacion_economica %}
                        {{ miembro.get_situacion_economica_display }}
                    {% else %}
                        â€”
                    {% endif %}
                </span>
            </div>

        </div>

    {% endif %}

</div>



{% if MODULOS_ACTIVOS.Finanzas %}
<!-- TAB: Finanzas -->
<div class="odoo-tab-content" id="tab-finanzas">

    {% if not finanzas_desbloqueado %}
        <!-- ğŸ”’ BLOQUEO HISTORIAL FINANCIERO -->
        <div class="odoo-lock-box">
            <span class="material-icons odoo-lock-icon">lock</span>
            <h3>Historial financiero</h3>
            <p>Esta informaciÃ³n estÃ¡ protegida.</p>

            <input type="password"
                   id="finanzas-password"
                   class="odoo-input"
                   placeholder="ContraseÃ±a">

            <button type="button"
                    class="odoo-btn odoo-btn-primary"
                    onclick="desbloquearFinanzas({{ miembro.pk }})">
                Desbloquear
            </button>

            <p id="finanzas-error" class="odoo-error" style="display:none;">
                ContraseÃ±a incorrecta
            </p>
        </div>

    {% else %}
        <!-- ğŸ”“ CONTENIDO FINANCIERO -->
        <div style="display:flex; justify-content:flex-end; margin-bottom:10px;">
            <button type="button"
                    class="odoo-btn odoo-btn-secondary"
                    onclick="bloquearFinanzas({{ miembro.pk }})">
                <span class="material-icons">lock</span>
                Bloquear
            </button>
        </div>

        <div class="odoo-fields-grid">
            <div class="odoo-field">
                <label>Total aportado</label>
                <span>RD$ {{ total_aportes|floatformat:2 }}</span>
            </div>
            <div class="odoo-field">
                <label>Movimientos</label>
                <span>{{ movimientos_financieros|length }}</span>
            </div>
        </div>

        {% if movimientos_financieros %}
            <div class="odoo-table-container" style="margin-top:12px;">
                <table class="odoo-table">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Tipo</th>
                            <th>CategorÃ­a</th>
                            <th>Monto</th>
                            <th>Referencia</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for mov in movimientos_financieros %}
                        <tr>
                            <td>{{ mov.fecha|date:"d/m/Y" }}</td>
                            <td>{{ mov.get_tipo_display }}</td>
                            <td>{{ mov.categoria }}</td>
                            <td>RD$ {{ mov.monto|floatformat:2 }}</td>
                            <td>{{ mov.referencia|default:"â€”" }}</td>

                            <td style="text-align:right;">
                                {% if mov.es_transferencia %}
                                    <a class="odoo-icon-link"
                                       href="{% url 'finanzas_app:transferencia_detalle' mov.pk %}"
                                       title="Ver transferencia">
                                        <span class="material-icons" style="font-size:18px;">visibility</span>
                                    </a>
                                {% else %}
                                    {% if mov.tipo == 'ingreso' %}
                                        <a class="odoo-icon-link"
                                           href="{% url 'finanzas_app:ingreso_detalle' mov.pk %}"
                                           title="Ver ingreso">
                                            <span class="material-icons" style="font-size:18px;">visibility</span>
                                        </a>
                                    {% else %}
                                        <a class="odoo-icon-link"
                                           href="{% url 'finanzas_app:movimiento_editar' mov.pk %}"
                                           title="Ver egreso">
                                            <span class="material-icons" style="font-size:18px;">visibility</span>
                                        </a>
                                    {% endif %}
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <p class="odoo-muted" style="margin-top:10px;">
                No hay movimientos financieros registrados.
            </p>
        {% endif %}

    {% endif %}
</div>
{% endif %}


{% if MODULOS_ACTIVOS.Estructura or MODULOS_ACTIVOS.Unidad or MODULOS_ACTIVOS.Unidades %}
<!-- TAB: Unidades -->
<div class="odoo-tab-content" id="tab-unidades">

    <div class="odoo-fields-grid">
        <div class="odoo-field">
            <label>Total de unidades activas</label>
            <span>{{ unidades_total|default:"0" }}</span>
        </div>
    </div>

    {% if unidades_resumen %}
        <div class="odoo-table-container" style="margin-top:12px;">
            <table class="odoo-table">
                <thead>
                    <tr>
                        <th>Unidad</th>
                        <th>Rol</th>
                        <th style="width:160px;">Tipo</th>
                    </tr>
                </thead>
                <tbody>
                    {% for it in unidades_resumen %}
                        <tr>
                            <td><strong>{{ it.unidad }}</strong></td>
                            <td>{{ it.rol|default:"Miembro" }}</td>
                            <td>
                                <span class="odoo-badge odoo-badge-neutral">
                                    {{ it.tipo|default:"â€”" }}
                                </span>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p class="odoo-empty" style="margin-top:12px;">
            Este miembro no tiene asignaciones activas en unidades.
        </p>
    {% endif %}

</div>
{% endif %}




        
        <!-- TAB: Otros -->
        <div class="odoo-tab-content" id="tab-otros">
            <div class="odoo-fields-grid">
                <div class="odoo-field odoo-field-full">
                    <label>Intereses</label>
                    <span>{{ miembro.intereses|default:"â€”" }}</span>
                </div>
                <div class="odoo-field odoo-field-full">
                    <label>Otros intereses</label>
                    <span>{{ miembro.otros_intereses|default:"â€”" }}</span>
                </div>
                <div class="odoo-field odoo-field-full">
                    <label>Habilidades</label>
                    <span>{{ miembro.habilidades|default:"â€”" }}</span>
                </div>
                <div class="odoo-field odoo-field-full">
                    <label>Otras habilidades</label>
                    <span>{{ miembro.otras_habilidades|default:"â€”" }}</span>
                </div>
            </div>
            
            <div class="odoo-notes-section">
                <h3>Notas pastorales</h3>
                <div class="odoo-notes-content">
                    {{ miembro.notas|default:"Sin notas registradas."|linebreaks }}
                </div>
            </div>
        </div>

    </div>

</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ESTILOS
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<style>


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TAB UNIDADES (decente, simple)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

.odoo-unidades-head {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 12px;
    padding: 14px 16px;
    border: 1px solid #e9ecef;
    border-radius: 10px;
    background: #fbfcfd;
    margin-bottom: 14px;
}

.odoo-unidades-title {
    display: flex;
    gap: 10px;
    align-items: flex-start;
}

.odoo-unidades-title .material-icons {
    font-size: 22px;
    color: #017e84;
    margin-top: 1px;
}

.odoo-unidades-h {
    font-size: 14px;
    font-weight: 700;
    color: #212529;
    line-height: 1.2;
}

.odoo-unidades-sub {
    font-size: 12px;
    color: #6c757d;
    margin-top: 2px;
}

.odoo-unidades-counter {
    text-align: right;
    padding-left: 8px;
    flex-shrink: 0;
}

.odoo-unidades-counter-label {
    display: block;
    font-size: 11px;
    color: #6c757d;
    text-transform: uppercase;
    letter-spacing: 0.4px;
}

.odoo-unidades-counter-value {
    font-size: 20px;
    font-weight: 800;
    color: #212529;
    line-height: 1.1;
}

/* Lista */
.odoo-unidades-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.odoo-unidad-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 12px;
    padding: 12px 14px;
    border: 1px solid #e9ecef;
    border-radius: 10px;
    background: #ffffff;
    transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.12s ease;
}

.odoo-unidad-row:hover {
    background: #fbfcfd;
    box-shadow: 0 8px 16px rgba(0,0,0,0.04);
    transform: translateY(-1px);
}

.odoo-unidad-left {
    display: flex;
    align-items: center;
    gap: 10px;
    min-width: 0;
}

.odoo-unidad-ico {
    font-size: 20px;
    color: #6c757d;
    flex-shrink: 0;
}

.odoo-unidad-text {
    min-width: 0;
}

.odoo-unidad-name {
    font-size: 14px;
    font-weight: 700;
    color: #212529;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 52vw;
}

.odoo-unidad-meta {
    font-size: 12px;
    color: #6c757d;
    margin-top: 2px;
}

.odoo-unidad-right {
    display: flex;
    align-items: center;
    gap: 10px;
    flex-shrink: 0;
}

.odoo-unidad-pill {
    font-size: 12px;
    padding: 4px 10px;
    border-radius: 999px;
    background: #f1f5f9;
    color: #374151;
    border: 1px solid #e2e8f0;
    white-space: nowrap;
}

.odoo-unidad-arrow {
    font-size: 20px;
    color: #c0c7cf;
}

/* Empty state */
.odoo-unidades-empty {
    display: flex;
    gap: 10px;
    align-items: flex-start;
    padding: 14px 16px;
    border: 1px dashed #dee2e6;
    border-radius: 10px;
    background: #ffffff;
    color: #6c757d;
}

.odoo-unidades-empty .material-icons {
    color: #6c757d;
}

.odoo-unidades-empty-title {
    font-size: 13px;
    font-weight: 700;
    color: #212529;
}

.odoo-unidades-empty-sub {
    font-size: 12px;
    margin-top: 2px;
}

/* Responsive */
@media (max-width: 480px) {
    .odoo-unidad-name {
        max-width: 60vw;
    }
}


/* Subsections: separar bien */
.odoo-subsection {
    margin-top: 28px;
    padding-top: 16px;
    border-top: 1px solid #e9ecef;
}

.odoo-subsection-strong {
    border-top: none;
    margin-top: 18px;
    padding-top: 0;
}

.odoo-subtitle-help {
    font-size: 12px;
    color: #6c757d;
    margin: 6px 0 12px 0;
}

.odoo-subtitle-strong {
    display: flex;
    align-items: center;
    gap: 8px;
}

.odoo-subtitle-badge {
    margin-left: 6px;
    font-size: 11px;
    padding: 3px 8px;
    border-radius: 999px;
    background: rgba(1,126,132,0.10);
    color: #017e84;
    border: 1px solid rgba(1,126,132,0.25);
}

/* Responsive cards */
@media (max-width: 992px) {
    .odoo-unidades-cards {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 480px) {
    .odoo-unidades-cards {
        grid-template-columns: 1fr;
    }
}


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BARRA DE CONTROL
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.odoo-control-bar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 16px;
    background: #f8f9fa;
    border-bottom: 1px solid #dee2e6;
    position: sticky;
    top: 0;
    z-index: 100;
}

.odoo-control-left,
.odoo-control-right {
    display: flex;
    align-items: center;
    gap: 8px;
}

.odoo-btn {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 6px 12px;
    font-size: 13px;
    font-weight: 500;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    text-decoration: none;
    transition: all 0.15s ease;
}

.odoo-btn .material-icons {
    font-size: 18px;
}

.odoo-btn-primary {
    background: #017e84;
    color: white;
}

.odoo-btn-primary:hover {
    background: #016166;
}

.odoo-btn-secondary {
    background: white;
    color: #495057;
    border: 1px solid #dee2e6;
}

.odoo-btn-secondary:hover {
    background: #e9ecef;
}

.odoo-breadcrumb {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: 13px;
}

.odoo-breadcrumb-link {
    color: #017e84;
    text-decoration: none;
}

.odoo-breadcrumb-link:hover {
    text-decoration: underline;
}

.odoo-breadcrumb .material-icons {
    font-size: 16px;
    color: #6c757d;
}

.odoo-breadcrumb-current {
    color: #495057;
    font-weight: 500;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONTAINER
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.odoo-detail-container {
    background: white;
    min-height: calc(100vh - 60px);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HEADER
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.odoo-detail-header {
    display: flex;
    align-items: flex-start;
    gap: 20px;
    padding: 24px;
    border-bottom: 1px solid #e9ecef;
    background: linear-gradient(180deg, #f8f9fa 0%, white 100%);
}

.odoo-detail-avatar {
    width: 100px;
    height: 100px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    overflow: hidden;
}

.odoo-detail-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.odoo-avatar-initial {
    font-size: 42px;
    font-weight: 500;
    color: white;
}

.odoo-detail-info {
    flex: 1;
    min-width: 0;
}

.odoo-detail-name {
    font-size: 24px;
    font-weight: 600;
    color: #212529;
    margin: 0 0 8px 0;
}

.odoo-detail-badges {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-bottom: 12px;
}

.odoo-badge {
    display: inline-flex;
    align-items: center;
    padding: 3px 10px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 500;
}

.odoo-badge-success {
    background: #d1fae5;
    color: #065f46;
}

.odoo-badge-warning {
    background: #fef3c7;
    color: #92400e;
}

.odoo-badge-danger {
    background: #fee2e2;
    color: #991b1b;
}

.odoo-badge-info {
    background: #dbeafe;
    color: #1e40af;
}

.odoo-badge-neutral {
    background: #f3f4f6;
    color: #374151;
}

.odoo-detail-quick {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
}

.odoo-quick-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 13px;
    color: #495057;
}

.odoo-quick-item .material-icons {
    font-size: 16px;
    color: #6c757d;
}

.odoo-quick-item a {
    color: #017e84;
    text-decoration: none;
}

.odoo-quick-item a:hover {
    text-decoration: underline;
}

.odoo-detail-code {
    text-align: right;
    flex-shrink: 0;
}

.odoo-code-label {
    display: block;
    font-size: 11px;
    color: #6c757d;
    text-transform: uppercase;
}

.odoo-code-value {
    font-size: 16px;
    font-weight: 600;
    color: #1e3a8a;
    font-family: 'Roboto Mono', monospace;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SITUATION CARD
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.odoo-situation-card {
    display: flex;
    gap: 16px;
    padding: 16px 24px;
    border-bottom: 1px solid #e9ecef;
}

.odoo-situation-ok {
    background: #f0fdf4;
}

.odoo-situation-warning {
    background: #fffbeb;
}

.odoo-situation-inactive {
    background: #fef2f2;
}

.odoo-situation-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.odoo-situation-ok .odoo-situation-icon {
    background: #d1fae5;
    color: #059669;
}

.odoo-situation-warning .odoo-situation-icon {
    background: #fef3c7;
    color: #d97706;
}

.odoo-situation-inactive .odoo-situation-icon {
    background: #fee2e2;
    color: #dc2626;
}

.odoo-situation-icon .material-icons {
    font-size: 20px;
}

.odoo-situation-content {
    flex: 1;
}

.odoo-situation-content strong {
    display: block;
    font-size: 13px;
    color: #212529;
    margin-bottom: 4px;
}

.odoo-situation-content p {
    margin: 0 0 4px 0;
    font-size: 13px;
    color: #495057;
}

.odoo-sit-label {
    font-weight: 600;
    color: #212529;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TABS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.odoo-detail-tabs {
    display: flex;
    gap: 0;
    padding: 0 24px;
    border-bottom: 1px solid #dee2e6;
    background: white;
    overflow-x: auto;
}

.odoo-tab {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 12px 16px;
    font-size: 13px;
    font-weight: 500;
    color: #6c757d;
    background: none;
    border: none;
    border-bottom: 2px solid transparent;
    cursor: pointer;
    transition: all 0.15s ease;
    white-space: nowrap;
}

.odoo-tab .material-icons {
    font-size: 18px;
}

.odoo-tab:hover {
    color: #495057;
    background: #f8f9fa;
}

.odoo-tab.active {
    color: #017e84;
    border-bottom-color: #017e84;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TAB CONTENTS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.odoo-tab-contents {
    padding: 24px;
}

.odoo-tab-content {
    display: none;
}

.odoo-tab-content.active {
    display: block;
}

.odoo-fields-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
}

.odoo-field {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.odoo-field-full {
    grid-column: 1 / -1;
}

.odoo-field label {
    font-size: 12px;
    font-weight: 500;
    color: #6c757d;
}

.odoo-field span {
    font-size: 14px;
    color: #212529;
}

.odoo-field a {
    color: #017e84;
    text-decoration: none;
}

.odoo-field a:hover {
    text-decoration: underline;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TABLE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.odoo-table-container {
    overflow-x: auto;
}

.odoo-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 13px;
}

.odoo-table th {
    text-align: left;
    padding: 10px 12px;
    background: #f8f9fa;
    color: #495057;
    font-weight: 500;
    border-bottom: 1px solid #dee2e6;
}

.odoo-table td {
    padding: 10px 12px;
    border-bottom: 1px solid #e9ecef;
    color: #212529;
}

.odoo-table tr:hover {
    background: #f8f9fa;
}

.odoo-table a {
    color: #017e84;
    text-decoration: none;
}

.odoo-table a:hover {
    text-decoration: underline;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NOTES
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.odoo-notes-section {
    margin-top: 24px;
    padding-top: 20px;
    border-top: 1px solid #e9ecef;
}

.odoo-notes-section h3 {
    font-size: 14px;
    font-weight: 600;
    color: #212529;
    margin: 0 0 12px 0;
}

.odoo-notes-content {
    font-size: 14px;
    color: #495057;
    line-height: 1.6;
    background: #f8f9fa;
    padding: 16px;
    border-radius: 6px;
}

.odoo-empty {
    font-size: 13px;
    color: #6c757d;
    text-align: center;
    padding: 24px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESPONSIVE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media (max-width: 992px) {
    .odoo-fields-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 768px) {
    .odoo-detail-header {
        flex-direction: column;
        align-items: center;
        text-align: center;
    }

    .odoo-detail-quick {
        justify-content: center;
    }

    .odoo-detail-code {
        text-align: center;
    }

    .odoo-fields-grid {
        grid-template-columns: 1fr;
    }

    .odoo-control-bar {
        flex-wrap: wrap;
        gap: 8px;
    }

    .odoo-control-right {
        flex-wrap: wrap;
    }
}
</style>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     JAVASCRIPT
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Tab switching
    const tabs = document.querySelectorAll('.odoo-tab');
    const contents = document.querySelectorAll('.odoo-tab-content');

    tabs.forEach(tab => {
        tab.addEventListener('click', function() {
            const targetId = 'tab-' + this.dataset.tab;

            // Remove active from all
            tabs.forEach(t => t.classList.remove('active'));
            contents.forEach(c => c.classList.remove('active'));

            // Add active to clicked
            this.classList.add('active');
            document.getElementById(targetId).classList.add('active');
        });
    });

    // Check URL for tab parameter
    const urlParams = new URLSearchParams(window.location.search);
    const tabParam = urlParams.get('tab');
    if (tabParam) {
        const targetTab = document.querySelector(`.odoo-tab[data-tab="${tabParam}"]`);
        if (targetTab) {
            targetTab.click();
        }
    }
});
</script>

<script>
function goTab(tab) {
  window.location.href = window.location.pathname + "?tab=" + tab;
}

/* ======================
   PRIVADO (como ya lo tienes)
====================== */
function desbloquearPrivado(pk) {
  const password = document.getElementById("privado-password").value;

  fetch(`/miembros/miembros/${pk}/privado/desbloquear/`, {
    method: "POST",
    headers: {
      "X-CSRFToken": "{{ csrf_token }}",
      "X-Requested-With": "XMLHttpRequest",
      "Content-Type": "application/x-www-form-urlencoded"
    },
    body: new URLSearchParams({ password })
  })
  .then(async (r) => {
    if (!r.ok) {
      const t = await r.text();
      throw new Error("HTTP " + r.status + " -> " + t.slice(0, 120));
    }
    return r.json();
  })
  .then(data => {
    if (data.ok) {
      goTab("privado");
    } else {
      const err = document.getElementById("privado-error");
      if (err) err.style.display = "block";
    }
  })
  .catch((e) => {
    console.error(e);
    const err = document.getElementById("privado-error");
    if (err) {
      err.style.display = "block";
      err.textContent = "Error al desbloquear (revisa URL/permisos).";
    }
  });
}

function bloquearPrivado(pk) {
  fetch(`/miembros/miembros/${pk}/privado/bloquear/`, {
    method: "POST",
    headers: {
      "X-CSRFToken": "{{ csrf_token }}",
      "X-Requested-With": "XMLHttpRequest"
    }
  })
  .then(async (r) => {
    if (!r.ok) {
      const t = await r.text();
      throw new Error("HTTP " + r.status + " -> " + t.slice(0, 120));
    }
    return r.json();
  })
  .then(data => {
    if (data.ok) goTab("privado");
  })
  .catch((e) => console.error(e));
}

/* ======================
   FINANZAS (igual patrÃ³n que Privado)
====================== */
function desbloquearFinanzas(pk) {
  const password = document.getElementById("finanzas-password").value;

  fetch(`/miembros/miembros/${pk}/finanzas/desbloquear/`, {
    method: "POST",
    headers: {
      "X-CSRFToken": "{{ csrf_token }}",
      "X-Requested-With": "XMLHttpRequest",
      "Content-Type": "application/x-www-form-urlencoded"
    },
    body: new URLSearchParams({ password })
  })
  .then(async (r) => {
    if (!r.ok) {
      const t = await r.text();
      throw new Error("HTTP " + r.status + " -> " + t.slice(0, 120));
    }
    return r.json();
  })
  .then(data => {
    if (data.ok) {
      goTab("finanzas");
    } else {
      const err = document.getElementById("finanzas-error");
      if (err) err.style.display = "block";
    }
  })
  .catch((e) => {
    console.error(e);
    const err = document.getElementById("finanzas-error");
    if (err) {
      err.style.display = "block";
      err.textContent = "Error al desbloquear (revisa URL/permisos).";
    }
  });
}

function bloquearFinanzas(pk) {
  fetch(`/miembros/miembros/${pk}/finanzas/bloquear/`, {
    method: "POST",
    headers: {
      "X-CSRFToken": "{{ csrf_token }}",
      "X-Requested-With": "XMLHttpRequest"
    }
  })
  .then(async (r) => {
    if (!r.ok) {
      const t = await r.text();
      throw new Error("HTTP " + r.status + " -> " + t.slice(0, 120));
    }
    return r.json();
  })
  .then(data => {
    if (data.ok) goTab("finanzas");
  })
  .catch((e) => console.error(e));
}
</script>





{% endblock %}