{% extends 'miembros_app/base_miembros.html' %}
{% load static %}

{% block title %}Familias{% endblock %}

{% block miembros_content %}

<div class="odoo-form">
  <!-- Barra superior -->
  <div class="odoo-control-bar">
    <div class="odoo-control-left">
      <span class="odoo-breadcrumb-current">Familias</span>
      <span class="odoo-badge">{{ familias|length }} hogares</span>
    </div>

    <div class="odoo-control-right">
      <div class="odoo-search">
        <span class="material-icons">search</span>
        <input id="familiasSearch" type="text" placeholder="Buscar familia por nombre…">
      </div>
    </div>
  </div>

  <div class="odoo-form-container">
    <div class="odoo-form-main">

      <div class="familiar-seccion">
        <h3 class="familiar-seccion-titulo">
          <span class="material-icons">home</span>
          Hogares
        </h3>

        <div class="familias-grid" id="familiasGrid">

          {% for f in familias %}
          <a class="familia-card" href="{% url 'miembros_app:familia_detalle' f.id %}" data-name="{{ f.nombre|lower }}">
            <div class="familia-card-left">
              <div class="familia-avatar">
                <span class="material-icons">family_restroom</span>
              </div>

              <div class="familia-info">
                <div class="familia-nombre">{{ f.nombre }}</div>
                <div class="familia-meta">{{ f.miembros_count }} miembros</div>
              </div>
            </div>

            <div class="familia-card-right">
              <span class="material-icons">chevron_right</span>
            </div>
          </a>
          {% empty %}

          <div class="familiar-vacio">
            <span class="material-icons">family_restroom</span>
            <p>No hay familias creadas todavía</p>
          </div>

          {% endfor %}

        </div>
      </div>

    </div>
  </div>
</div>

<!-- Estilos (solo para esta pantalla) -->
<style>
  .odoo-badge{
    display:inline-flex;
    align-items:center;
    gap:6px;
    margin-left:10px;
    padding:2px 10px;
    border-radius:999px;
    font-size:12px;
    background:rgba(0,0,0,.06);
  }

  .odoo-search{
    display:flex;
    align-items:center;
    gap:8px;
    padding:8px 10px;
    border-radius:10px;
    background:#fff;
    border:1px solid rgba(0,0,0,.08);
    min-width:320px;
  }
  .odoo-search input{
    border:none;
    outline:none;
    width:100%;
    font-size:14px;
    background:transparent;
  }

  .familias-grid{
    display:grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap:12px;
    margin-top:10px;
  }

  .familia-card{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:14px 14px;
    border-radius:14px;
    background:#fff;
    border:1px solid rgba(0,0,0,.08);
    text-decoration:none;
    transition:transform .08s ease, box-shadow .08s ease;
  }
  .familia-card:hover{
    transform: translateY(-1px);
    box-shadow:0 10px 22px rgba(0,0,0,.08);
  }

  .familia-card-left{
    display:flex;
    align-items:center;
    gap:12px;
    min-width:0;
  }

  .familia-avatar{
    width:42px;
    height:42px;
    border-radius:12px;
    display:flex;
    align-items:center;
    justify-content:center;
    background:rgba(0,0,0,.06);
  }

  .familia-info{
    min-width:0;
  }
  .familia-nombre{
    font-weight:700;
    color:#111;
    line-height:1.2;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
    max-width:460px;
  }
  .familia-meta{
    margin-top:4px;
    font-size:12px;
    color:rgba(0,0,0,.55);
  }

  .familia-card-right{
    color:rgba(0,0,0,.45);
    display:flex;
    align-items:center;
  }

  @media (max-width: 520px){
    .odoo-search{ min-width: 0; width:100%; }
    .familia-nombre{ max-width: 220px; }
  }
</style>

<!-- Buscador client-side -->
<script>
  (function(){
    const input = document.getElementById("familiasSearch");
    const grid = document.getElementById("familiasGrid");
    if(!input || !grid) return;

    input.addEventListener("input", function(){
      const q = (this.value || "").toLowerCase().trim();
      const cards = grid.querySelectorAll(".familia-card");
      cards.forEach(card => {
        const name = card.getAttribute("data-name") || "";
        card.style.display = name.includes(q) ? "" : "none";
      });
    });
  })();
</script>

{% endblock %}
