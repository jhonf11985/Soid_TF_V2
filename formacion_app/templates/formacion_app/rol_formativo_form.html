{% extends "formacion_app/base_formacion.html" %}

{% block title %}Maestros y Ayudantes · Formación{% endblock %}

{% block formacion_content %}
<div style="max-width:960px;margin:0 auto;padding:16px 16px 80px;">

  <!-- Encabezado -->
  <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:12px;flex-wrap:wrap;margin-bottom:20px;">
    <div>
      <h2 style="margin:0 0 4px;font-size:1.4rem;font-weight:800;color:#1e293b;">Maestros y Ayudantes</h2>
      <p style="margin:0;font-size:0.84rem;color:#64748b;font-weight:500;">
        Gestión de roles formativos del equipo docente
      </p>
    </div>
    <a href="{% url 'formacion:rol_formativo_nuevo' %}"
       style="display:inline-flex;align-items:center;gap:6px;background:#5c9ead;color:#fff;font-weight:800;font-size:0.84rem;padding:10px 18px;border-radius:10px;text-decoration:none;transition:all .2s;box-shadow:0 2px 6px rgba(92,158,173,.2);"
       onmouseover="this.style.background='#4a8a99';this.style.transform='translateY(-1px)'"
       onmouseout="this.style.background='#5c9ead';this.style.transform='translateY(0)'">
      <span class="material-icons" style="font-size:18px;">add</span>
      Añadir
    </a>
  </div>

  <!-- Card contenedora -->
  <div style="background:#fff;border:1px solid #e2e8f0;border-radius:14px;overflow:hidden;">

    <!-- Tabs -->
    <div style="display:flex;border-bottom:2px solid #f1f5f9;background:#fafbfc;" id="roles-tabs">
      <button class="roles-tab active" data-tab="maestros"
              style="flex:1;border:none;background:transparent;padding:14px 16px;cursor:pointer;font-weight:700;font-size:0.88rem;color:#94a3b8;border-bottom:3px solid transparent;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:6px;">
        <span class="material-icons" style="font-size:18px;">school</span>
        Maestros
        <span style="background:#f1f5f9;padding:2px 8px;border-radius:999px;font-size:0.7rem;font-weight:800;color:#64748b;">{{ maestros|length }}</span>
      </button>
      <button class="roles-tab" data-tab="ayudantes"
              style="flex:1;border:none;background:transparent;padding:14px 16px;cursor:pointer;font-weight:700;font-size:0.88rem;color:#94a3b8;border-bottom:3px solid transparent;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:6px;">
        <span class="material-icons" style="font-size:18px;">support_agent</span>
        Ayudantes
        <span style="background:#f1f5f9;padding:2px 8px;border-radius:999px;font-size:0.7rem;font-weight:800;color:#64748b;">{{ ayudantes|length }}</span>
      </button>
    </div>

    <!-- Panel Maestros -->
    <div class="roles-panel active" id="panel-maestros" style="padding:8px 0;">
      {% for r in maestros %}
        <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 18px;border-bottom:1px solid #f8fafc;flex-wrap:wrap;transition:background .15s;"
             onmouseover="this.style.background='#fafcfd'"
             onmouseout="this.style.background='transparent'">

          <!-- Persona -->
          <div style="display:flex;align-items:center;gap:12px;flex:1;min-width:180px;">
            <div style="width:38px;height:38px;border-radius:50%;background:linear-gradient(135deg,#5c9ead,#8bbcc7);color:#fff;display:flex;align-items:center;justify-content:center;font-size:0.72rem;font-weight:800;flex-shrink:0;">
              {{ r.miembro.nombres|first }}{{ r.miembro.apellidos|first }}
            </div>
            <div>
              <div style="font-weight:700;font-size:0.88rem;color:#1e293b;">{{ r.miembro.nombres }} {{ r.miembro.apellidos }}</div>
              <div style="font-size:0.75rem;color:#94a3b8;font-family:'Roboto Mono',monospace;">{{ r.miembro.codigo_miembro|default:"—" }}</div>
            </div>
          </div>

          <!-- Estado + Acción -->
          <div style="display:flex;align-items:center;gap:10px;flex-shrink:0;">
            {% if r.activo %}
              <span style="display:inline-flex;align-items:center;gap:4px;padding:4px 10px;border-radius:999px;font-size:0.7rem;font-weight:700;background:rgba(34,197,94,.1);border:1px solid rgba(34,197,94,.25);color:#16a34a;">
                <span class="material-icons" style="font-size:12px;">check_circle</span>
                Activo
              </span>
            {% else %}
              <span style="display:inline-flex;align-items:center;gap:4px;padding:4px 10px;border-radius:999px;font-size:0.7rem;font-weight:700;background:#f8fafc;border:1px solid #e2e8f0;color:#94a3b8;">
                <span class="material-icons" style="font-size:12px;">pause_circle</span>
                Inactivo
              </span>
            {% endif %}

            <form method="post" action="{% url 'formacion:rol_formativo_toggle' r.id %}" style="margin:0;">
              {% csrf_token %}
              {% if r.activo %}
                <button type="submit"
                        style="display:inline-flex;align-items:center;gap:5px;padding:6px 12px;border-radius:8px;font-size:0.75rem;font-weight:700;color:#ef4444;background:rgba(239,68,68,.06);border:1px solid rgba(239,68,68,.2);cursor:pointer;transition:all .2s;"
                        onmouseover="this.style.background='rgba(239,68,68,.12)'"
                        onmouseout="this.style.background='rgba(239,68,68,.06)'">
                  <span class="material-icons" style="font-size:15px;">block</span>
                  Desactivar
                </button>
              {% else %}
                <button type="submit"
                        style="display:inline-flex;align-items:center;gap:5px;padding:6px 12px;border-radius:8px;font-size:0.75rem;font-weight:700;color:#16a34a;background:rgba(34,197,94,.06);border:1px solid rgba(34,197,94,.2);cursor:pointer;transition:all .2s;"
                        onmouseover="this.style.background='rgba(34,197,94,.12)'"
                        onmouseout="this.style.background='rgba(34,197,94,.06)'">
                  <span class="material-icons" style="font-size:15px;">check_circle</span>
                  Activar
                </button>
              {% endif %}
            </form>
          </div>

        </div>
      {% empty %}
        <div style="text-align:center;padding:40px 20px;">
          <span class="material-icons" style="font-size:40px;color:#cbd5e1;">person_off</span>
          <p style="color:#94a3b8;font-size:0.88rem;margin:10px 0 0;">No hay maestros registrados.</p>
        </div>
      {% endfor %}
    </div>

    <!-- Panel Ayudantes -->
    <div class="roles-panel" id="panel-ayudantes" style="padding:8px 0;display:none;">
      {% for r in ayudantes %}
        <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 18px;border-bottom:1px solid #f8fafc;flex-wrap:wrap;transition:background .15s;"
             onmouseover="this.style.background='#fafcfd'"
             onmouseout="this.style.background='transparent'">

          <!-- Persona -->
          <div style="display:flex;align-items:center;gap:12px;flex:1;min-width:180px;">
            <div style="width:38px;height:38px;border-radius:50%;background:linear-gradient(135deg,#5c9ead,#8bbcc7);color:#fff;display:flex;align-items:center;justify-content:center;font-size:0.72rem;font-weight:800;flex-shrink:0;">
              {{ r.miembro.nombres|first }}{{ r.miembro.apellidos|first }}
            </div>
            <div>
              <div style="font-weight:700;font-size:0.88rem;color:#1e293b;">{{ r.miembro.nombres }} {{ r.miembro.apellidos }}</div>
              <div style="font-size:0.75rem;color:#94a3b8;font-family:'Roboto Mono',monospace;">{{ r.miembro.codigo_miembro|default:"—" }}</div>
            </div>
          </div>

          <!-- Estado + Acción -->
          <div style="display:flex;align-items:center;gap:10px;flex-shrink:0;">
            {% if r.activo %}
              <span style="display:inline-flex;align-items:center;gap:4px;padding:4px 10px;border-radius:999px;font-size:0.7rem;font-weight:700;background:rgba(34,197,94,.1);border:1px solid rgba(34,197,94,.25);color:#16a34a;">
                <span class="material-icons" style="font-size:12px;">check_circle</span>
                Activo
              </span>
            {% else %}
              <span style="display:inline-flex;align-items:center;gap:4px;padding:4px 10px;border-radius:999px;font-size:0.7rem;font-weight:700;background:#f8fafc;border:1px solid #e2e8f0;color:#94a3b8;">
                <span class="material-icons" style="font-size:12px;">pause_circle</span>
                Inactivo
              </span>
            {% endif %}

            <form method="post" action="{% url 'formacion:rol_formativo_toggle' r.id %}" style="margin:0;">
              {% csrf_token %}
              {% if r.activo %}
                <button type="submit"
                        style="display:inline-flex;align-items:center;gap:5px;padding:6px 12px;border-radius:8px;font-size:0.75rem;font-weight:700;color:#ef4444;background:rgba(239,68,68,.06);border:1px solid rgba(239,68,68,.2);cursor:pointer;transition:all .2s;"
                        onmouseover="this.style.background='rgba(239,68,68,.12)'"
                        onmouseout="this.style.background='rgba(239,68,68,.06)'">
                  <span class="material-icons" style="font-size:15px;">block</span>
                  Desactivar
                </button>
              {% else %}
                <button type="submit"
                        style="display:inline-flex;align-items:center;gap:5px;padding:6px 12px;border-radius:8px;font-size:0.75rem;font-weight:700;color:#16a34a;background:rgba(34,197,94,.06);border:1px solid rgba(34,197,94,.2);cursor:pointer;transition:all .2s;"
                        onmouseover="this.style.background='rgba(34,197,94,.12)'"
                        onmouseout="this.style.background='rgba(34,197,94,.06)'">
                  <span class="material-icons" style="font-size:15px;">check_circle</span>
                  Activar
                </button>
              {% endif %}
            </form>
          </div>

        </div>
      {% empty %}
        <div style="text-align:center;padding:40px 20px;">
          <span class="material-icons" style="font-size:40px;color:#cbd5e1;">person_off</span>
          <p style="color:#94a3b8;font-size:0.88rem;margin:10px 0 0;">No hay ayudantes registrados.</p>
        </div>
      {% endfor %}
    </div>

  </div>

</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const tabs = document.querySelectorAll(".roles-tab");
    const panels = {
      maestros: document.getElementById("panel-maestros"),
      ayudantes: document.getElementById("panel-ayudantes"),
    };

    tabs.forEach(tab => {
      tab.addEventListener("click", () => {
        // Reset tabs
        tabs.forEach(t => {
          t.classList.remove("active");
          t.style.color = "#94a3b8";
          t.style.borderBottomColor = "transparent";
          t.style.background = "transparent";
        });
        // Reset panels
        Object.values(panels).forEach(p => p.style.display = "none");

        // Activate
        tab.classList.add("active");
        tab.style.color = "#5c9ead";
        tab.style.borderBottomColor = "#5c9ead";
        tab.style.background = "#fff";
        panels[tab.dataset.tab].style.display = "block";
      });
    });

    // Init active tab style
    const activeTab = document.querySelector(".roles-tab.active");
    if (activeTab) {
      activeTab.style.color = "#5c9ead";
      activeTab.style.borderBottomColor = "#5c9ead";
      activeTab.style.background = "#fff";
    }
  });
</script>

{% endblock %}