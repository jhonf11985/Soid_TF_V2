{% extends 'formacion_app/base_formacion.html' %}
{% load static %}

{% block formacion_content %}
<div style="padding:16px;max-width:1200px;margin:0 auto;">

  <!-- Header de la sesi贸n -->
  <div style="background:#fff;border:1px solid #e9ecef;border-radius:16px;padding:20px;margin-bottom:16px;box-shadow:0 2px 8px rgba(0,0,0,.04);">
    <div style="display:flex;justify-content:space-between;align-items:flex-start;flex-wrap:wrap;gap:16px;">
      <div>
        <div style="display:inline-flex;align-items:center;gap:10px;margin-bottom:8px;">
          <span class="material-icons" style="font-size:28px;color:#5c9ead;">school</span>
          <h2 style="margin:0;font-weight:900;font-size:24px;">Sesi贸n en Curso</h2>
        </div>
        <div style="color:#6c757d;font-weight:600;font-size:15px;line-height:1.6;">
           Grupo: <strong style="color:#2c2c2c;">{{ grupo.nombre }}</strong><br>
           Fecha: <strong style="color:#2c2c2c;">{{ sesion.fecha|date:"d/m/Y" }}</strong><br>
           Hora: <strong style="color:#2c2c2c;">{{ sesion.inicio|date:"H:i" }}</strong>
        </div>
      </div>

      <div style="display:inline-flex;align-items:center;gap:10px;border-radius:999px;padding:10px 16px;font-weight:900;font-size:13px;border:1px solid rgba(25,135,84,.25);color:#0f5132;background:rgba(25,135,84,.12);box-shadow:0 2px 4px rgba(25,135,84,.08);">
        <span class="material-icons" style="font-size:20px;">check_circle</span>
        SESIN ACTIVA
      </div>
    </div>
  </div>

  <!-- Botones de acci贸n -->
  <div style="display:flex;gap:12px;flex-wrap:wrap;margin-bottom:20px;">
    <a href="{% url 'formacion:sesion_kiosko' sesion.id %}"
       style="display:inline-flex;align-items:center;gap:10px;background:#5c9ead;color:#fff;padding:14px 18px;border-radius:12px;text-decoration:none;font-weight:900;font-size:14px;transition:all .2s;box-shadow:0 2px 6px rgba(92,158,173,.2);"
       onmouseover="this.style.background='#4a7d8d';this.style.transform='translateY(-1px)';this.style.boxShadow='0 4px 12px rgba(92,158,173,.3)'"
       onmouseout="this.style.background='#5c9ead';this.style.transform='translateY(0)';this.style.boxShadow='0 2px 6px rgba(92,158,173,.2)'">
      <span class="material-icons" style="font-size:22px;">qr_code_scanner</span>
      PASE DE LISTA
    </a>

    <a href="{% url 'formacion:inicio_maestro' %}"
       style="display:inline-flex;align-items:center;gap:10px;background:#fff;color:#5c9ead;padding:14px 18px;border-radius:12px;text-decoration:none;font-weight:900;font-size:14px;border:2px solid rgba(92,158,173,.3);transition:all .2s;"
       onmouseover="this.style.borderColor='#5c9ead';this.style.background='rgba(92,158,173,.05)'"
       onmouseout="this.style.borderColor='rgba(92,158,173,.3)';this.style.background='#fff'">
      <span class="material-icons" style="font-size:22px;">arrow_back</span>
      VOLVER AL PANEL
    </a>

    <form method="post" action="{% url 'formacion:sesion_cerrar' sesion.id %}" style="display:inline;" onsubmit="return confirm('驴Est谩s seguro de cerrar esta sesi贸n? Esto finalizar谩 la clase.');">
      {% csrf_token %}
      <button type="submit"
              style="display:inline-flex;align-items:center;gap:10px;background:#dc3545;color:#fff;padding:14px 18px;border-radius:12px;border:none;font-weight:900;font-size:14px;cursor:pointer;transition:all .2s;box-shadow:0 2px 6px rgba(220,53,69,.2);"
              onmouseover="this.style.background='#bb2d3b';this.style.boxShadow='0 4px 12px rgba(220,53,69,.3)'"
              onmouseout="this.style.background='#dc3545';this.style.boxShadow='0 2px 6px rgba(220,53,69,.2)'">
        <span class="material-icons" style="font-size:22px;">stop_circle</span>
        CERRAR SESIN
      </button>
    </form>
  </div>

  <!-- Panel de asistencia -->
  <div style="background:#fff;border:1px solid #e9ecef;border-radius:16px;padding:20px;box-shadow:0 2px 8px rgba(0,0,0,.04);">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;flex-wrap:wrap;gap:12px;">
      <h3 style="margin:0;font-weight:900;font-size:20px;display:inline-flex;align-items:center;gap:10px;">
        <span class="material-icons" style="font-size:24px;color:#5c9ead;">fact_check</span>
        Asistencia de Hoy
      </h3>
      
      {% if asistencias %}
        <div style="display:inline-flex;align-items:center;gap:8px;background:rgba(92,158,173,.1);border:1px solid rgba(92,158,173,.25);border-radius:999px;padding:8px 14px;">
          <span class="material-icons" style="font-size:18px;color:#5c9ead;">group</span>
          <span style="font-weight:900;font-size:14px;color:#5c9ead;">{{ asistencias|length }} / {{ total_grupo }}</span>
        </div>
      {% endif %}
    </div>

    {% if asistencias %}
      <!-- Lista de asistencias -->
      <div style="display:grid;gap:10px;">
        {% for a in asistencias %}
          <div style="
            background:linear-gradient(135deg, rgba(92,158,173,.02) 0%, rgba(92,158,173,.06) 100%);
            border:1px solid #e9ecef;
            border-left:3px solid #5c9ead;
            border-radius:10px;
            padding:14px 16px;
            display:flex;
            justify-content:space-between;
            align-items:center;
            transition:all .2s;
          "
          onmouseover="this.style.background='linear-gradient(135deg, rgba(92,158,173,.06) 0%, rgba(92,158,173,.10) 100%)';this.style.transform='translateX(4px)'"
          onmouseout="this.style.background='linear-gradient(135deg, rgba(92,158,173,.02) 0%, rgba(92,158,173,.06) 100%)';this.style.transform='translateX(0)'">
            <div>
              <div style="font-weight:800;font-size:15px;color:#2c2c2c;">
                <span class="material-icons" style="font-size:18px;color:#5c9ead;vertical-align:middle;margin-right:6px;">person</span>
                {% firstof a.miembro.nombre_completo a.miembro.nombre a.miembro.nombres a.miembro.full_name a.miembro a.miembro_id "Miembro" %}
              </div>
            </div>
            <div style="display:inline-flex;align-items:center;gap:6px;color:#6c757d;font-size:13px;font-weight:700;">
              <span class="material-icons" style="font-size:16px;">schedule</span>
              {{ a.marcado_en|date:"H:i" }}
            </div>
          </div>
        {% endfor %}
      </div>

      <!-- Resumen -->
      <div style="margin-top:16px;padding:14px;background:linear-gradient(135deg, rgba(92,158,173,.06) 0%, rgba(92,158,173,.10) 100%);border-left:3px solid #5c9ead;border-radius:10px;">
        <div style="display:flex;gap:24px;flex-wrap:wrap;">
          <div>
            <div style="font-size:12px;color:#6c757d;font-weight:700;text-transform:uppercase;margin-bottom:4px;">Presentes</div>
            <div style="font-size:24px;font-weight:900;color:#5c9ead;">{{ asistencias|length }}</div>
          </div>
          <div>
            <div style="font-size:12px;color:#6c757d;font-weight:700;text-transform:uppercase;margin-bottom:4px;">Total Grupo</div>
            <div style="font-size:24px;font-weight:900;color:#2c2c2c;">{{ total_grupo }}</div>
          </div>
          <div>
            <div style="font-size:12px;color:#6c757d;font-weight:700;text-transform:uppercase;margin-bottom:4px;">Asistencia</div>
            <div style="font-size:24px;font-weight:900;color:#5c9ead;">
              {% widthratio asistencias|length total_grupo 100 %}%
            </div>
          </div>
        </div>
      </div>

    {% else %}
      <!-- Sin asistencias -->
      <div style="background:linear-gradient(135deg, rgba(255,193,7,.06) 0%, rgba(255,193,7,.10) 100%);border:1px dashed rgba(255,193,7,.5);border-radius:12px;padding:32px;text-align:center;">
        <span class="material-icons" style="font-size:48px;color:rgba(255,193,7,.6);margin-bottom:12px;">pending_actions</span>
        <div style="color:#997404;font-weight:700;font-size:16px;line-height:1.6;">
           A煤n no hay asistencias registradas.<br>
          <span style="font-size:14px;font-weight:600;">Los estudiantes pueden escanear el c贸digo QR del kiosko para marcar su asistencia.</span>
        </div>
      </div>
    {% endif %}

  </div>

</div>

<style>
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  [style*="display:grid"] > div {
    animation: fadeIn 0.3s ease-out;
  }
</style>

{% endblock %}