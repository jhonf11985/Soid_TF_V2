{% extends 'core/base.html' %}

{% block title %}Inicio · Soid_Tf_2{% endblock %}

{% block content %}
<!-- ========== VISTA MÓVIL (estilo Android Launcher) ========== -->
<div class="home-mobile">
    <!-- Saludo personalizado -->
    <div class="home-mobile-greeting">
        <h1>¡Hola {{ user.first_name|default:user.username }}!</h1>
    </div>

    <!-- Grid de módulos circulares -->
    <div class="home-mobile-grid">
        {% for module in modules %}
        <a href="{% url module.url_name %}" class="home-mobile-app">
            <div class="home-mobile-icon" style="background-color: {{ module.color|default:'#6772e5' }}">
                <span class="material-icons">{{ module.icon|default:"apps" }}</span>
            </div>
            <span class="home-mobile-label">{{ module.name }}</span>
        </a>
        {% empty %}
        <p class="home-mobile-empty">No hay módulos activos.</p>
        {% endfor %}

        {% if user.is_staff %}
        <a href="{% url 'admin:index' %}" class="home-mobile-app">
            <div class="home-mobile-icon" style="background-color: #64748b">
                <span class="material-icons">admin_panel_settings</span>
            </div>
            <span class="home-mobile-label">Admin</span>
        </a>
        {% endif %}
    </div>
</div>

<!-- ========== VISTA ESCRITORIO (estilo Odoo original) ========== -->
<div class="home-desktop">
    <div class="app-container">
        <div class="app-grid">
            {% for module in modules %}
            <a href="{% url module.url_name %}" class="odoo-app">
                <div class="odoo-app-icon" style="background-color: {{ module.color|default:'#6772e5' }}">
                    <span class="material-icons">{{ module.icon|default:"apps" }}</span>
                </div>
                <div class="odoo-app-name">{{ module.name }}</div>
            </a>
            {% empty %}
            <p>No hay módulos activos.</p>
            {% endfor %}

            {% if user.is_staff %}
            <a href="{% url 'admin:index' %}" class="odoo-app">
                <div class="odoo-app-icon" style="background-color: #444;">
                    <span class="material-icons">admin_panel_settings</span>
                </div>
                <div class="odoo-app-name">Administración</div>
            </a>
            {% endif %}
        </div>
    </div>
</div>

<!-- BOTÓN FLOTANTE CON MENÚ — HOME -->
<div class="fab-home-wrapper" id="fabHomeWrapper">
    <!-- Botón principal -->
    <button type="button" class="fab-home-main" id="fabHomeMain">
        <span class="material-icons">add</span>
    </button>

    <!-- Acciones secundarias -->
    <div class="fab-home-actions">
        <a href="/miembros/nuevos-creyentes/registrar/" class="fab-home-action">
            <span class="fab-home-action-label">Registrar nuevo creyente</span>
            <span class="material-icons fab-home-action-icon">hail</span>
        </a>

        <a href="/miembros/crear/" class="fab-home-action">
            <span class="fab-home-action-label">Crear miembro</span>
            <span class="material-icons fab-home-action-icon">person_add</span>
        </a>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const wrapper = document.getElementById('fabHomeWrapper');
    const mainBtn = document.getElementById('fabHomeMain');

    if (!wrapper || !mainBtn) return;

    function toggleFab() {
        wrapper.classList.toggle('is-open');
    }

    mainBtn.addEventListener('click', function (e) {
        e.stopPropagation();
        toggleFab();
    });

    // Cerrar al hacer clic fuera
    document.addEventListener('click', function () {
        wrapper.classList.remove('is-open');
    });

    // Evitar que al hacer clic dentro del menú se cierre antes de navegar
    wrapper.addEventListener('click', function (e) {
        e.stopPropagation();
    });
});
</script>
{% endblock %}

{% block extra_css %}
<style>
/* ============================
   HOME MÓVIL - ESTILO ANDROID LAUNCHER
   ============================ */

/* Por defecto: ocultar móvil, mostrar escritorio */
.home-mobile {
    display: none;
}

.home-desktop {
    display: block;
}

/* En móvil: mostrar móvil, ocultar escritorio */
@media (max-width: 768px) {
    .home-mobile {
        display: block;
        padding: 24px 16px 100px;
        min-height: calc(100vh - 120px);
    }

    .home-desktop {
        display: none;
    }

    /* Ocultar el nav secundario en móvil para la home */
    .main-nav {
        display: none;
    }
}

/* Saludo */
.home-mobile-greeting {
    text-align: center;
    margin-bottom: 28px;
}

.home-mobile-greeting h1 {
    font-size: 22px;
    font-weight: 600;
    color: #1f2937;
    margin: 0;
}

/* Grid de módulos - 3 columnas fijas */
.home-mobile-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 24px 16px;
    max-width: 360px;
    margin: 0 auto;
}

/* Cada módulo */
.home-mobile-app {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-decoration: none;
    gap: 10px;
    padding: 8px 4px;
    border-radius: 12px;
    transition: background 0.15s ease;
    -webkit-tap-highlight-color: transparent;
}

.home-mobile-app:active {
    background: rgba(0, 0, 0, 0.05);
}

/* Círculo del icono */
.home-mobile-icon {
    width: 75px;
    height: 75px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.home-mobile-icon .material-icons {
    font-size: 34px;
    color: rgba(255, 255, 255, 0.95);
}

.home-mobile-app:active .home-mobile-icon {
    transform: scale(0.92);
}

/* Nombre del módulo */
.home-mobile-label {
    font-size: 12px;
    font-weight: 500;
    color: #374151;
    text-align: center;
    max-width: 90px;
    line-height: 1.3;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.home-mobile-empty {
    grid-column: 1 / -1;
    text-align: center;
    color: #9ca3af;
    font-size: 14px;
}

/* Ajustes para pantallas muy pequeñas */
@media (max-width: 360px) {
    .home-mobile-grid {
        gap: 20px 12px;
        max-width: 300px;
    }
    
    .home-mobile-icon {
        width: 65px;
        height: 65px;
    }

    .home-mobile-icon .material-icons {
        font-size: 30px;
    }

    .home-mobile-greeting h1 {
        font-size: 20px;
    }
    
    .home-mobile-label {
        font-size: 11px;
    }
}

/* Para tablets - 3 columnas más espaciadas */
@media (min-width: 500px) and (max-width: 768px) {
    .home-mobile-grid {
        max-width: 420px;
        gap: 28px 24px;
    }

    .home-mobile-icon {
        width: 85px;
        height: 85px;
    }

    .home-mobile-icon .material-icons {
        font-size: 38px;
    }
    
    .home-mobile-label {
        font-size: 13px;
        max-width: 100px;
    }
}
</style>
{% endblock %}

<!-- Versión: 2025-01-15-android-launcher -->