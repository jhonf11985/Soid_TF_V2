{% extends "core/base.html" %}

{% block title %}
    {{ titulo_pagina|default:"Enviar correo" }}
{% endblock %}

{% block breadcrumb %}
    {{ titulo_pagina|default:"Enviar correo" }}
{% endblock %}

{% block content %}
<section class="page-section">

    <h1 class="page-title">
        {{ titulo_pagina|default:"Enviar correo" }}
    </h1>

    {% if descripcion %}
        <p class="page-subtitle">
            {{ descripcion }}
        </p>
    {% endif %}

    {% if objeto_label %}
        <p class="mb-2">
            <strong>{{ objeto_label }}</strong>
        </p>
    {% endif %}

    {# Errores generales del formulario #}
    {% if form.non_field_errors %}
        <div class="alert alert-error" style="margin-bottom: 12px;">
            {{ form.non_field_errors }}
        </div>
    {% endif %}

    <form method="post" enctype="multipart/form-data" class="card">
        {% csrf_token %}

        <div class="form-grid">
            {# DESTINATARIO(S) #}
            <div class="form-field form-field-full">
                {{ form.destinatario.label_tag }}
                {{ form.destinatario }}
                <p class="form-help">
                    Puedes escribir varios correos separados por coma o punto y coma.
                    <br>
                    Ejemplo: <code>persona1@mail.com, persona2@mail.com; persona3@mail.com</code>
                </p>
                {% if form.destinatario.help_text %}
                    <p class="form-help">{{ form.destinatario.help_text }}</p>
                {% endif %}
                {% if form.destinatario.errors %}
                    <div class="form-error">
                        {{ form.destinatario.errors }}
                    </div>
                {% endif %}
            </div>

            {# ASUNTO #}
            <div class="form-field form-field-full">
                {{ form.asunto.label_tag }}
                {{ form.asunto }}
                {% if form.asunto.errors %}
                    <div class="form-error">
                        {{ form.asunto.errors }}
                    </div>
                {% endif %}
            </div>

            {# MENSAJE #}
            <div class="form-field form-field-full">
                {{ form.mensaje.label_tag }}
                {{ form.mensaje }}
                {% if form.mensaje.help_text %}
                    <p class="form-help">{{ form.mensaje.help_text }}</p>
                {% endif %}
                {% if form.mensaje.errors %}
                    <div class="form-error">
                        {{ form.mensaje.errors }}
                    </div>
                {% endif %}
            </div>

            {# ADJUNTO MANUAL (como antes) #}
            <div class="form-field form-field-full">
                {{ form.adjunto.label_tag }}
                {{ form.adjunto }}
                {% if form.adjunto.help_text %}
                    <p class="form-help">{{ form.adjunto.help_text }}</p>
                {% endif %}
                {% if form.adjunto.errors %}
                    <div class="form-error">
                        {{ form.adjunto.errors }}
                    </div>
                {% endif %}
            </div>

            {# INFO DEL PDF AUTOMÁTICO CON ICONO #}
            {% if adjunto_auto_nombre %}
                <div class="form-field form-field-full">
                    <label>Archivo generado automáticamente</label>
                    <div class="adjunto-card" style="
                        display:flex;
                        align-items:center;
                        gap:8px;
                        background:#f7f7f7;
                        padding:6px 10px;
                        border-radius:6px;
                        border:1px solid #e0e0e0;
                    ">
                        <!-- Icono PDF estilo Odoo -->
                        <svg xmlns="http://www.w3.org/2000/svg"
                             viewBox="0 0 24 24"
                             style="width:22px;height:22px;flex-shrink:0;"
                             fill="#d32f2f">
                            <path d="M6 2h7l5 5v13a2 2 0 0 1-2 2H6
                                     a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z"/>
                            <text x="50%" y="65%" text-anchor="middle"
                                  font-size="8" fill="white" font-family="Arial"
                                  font-weight="bold">PDF</text>
                        </svg>
                        <div>
                            <strong>{{ adjunto_auto_nombre }}</strong><br>
                            <small style="color:#555;">
                                Este archivo se adjunta automáticamente junto con cualquier archivo que selecciones arriba.
                            </small>
                        </div>
                    </div>
                </div>
            {% endif %}

        </div>

        <div class="form-actions">
            <button type="submit" class="btn-primary">
                Enviar correo
            </button>
            {% if url_cancelar %}
                <a href="{{ url_cancelar }}" class="btn-secondary">
                    Cancelar
                </a>
            {% endif %}
        </div>
    </form>
</section>
{% endblock %}
