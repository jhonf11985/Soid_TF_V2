{% extends "core/base.html" %}

{% block title %}Centro Ejecutivo{% endblock %}

{% block content %}
<style>
  .wrap{max-width:1100px;margin:22px auto;padding:16px}
  .head h2{margin:0;font-weight:800}
  .sub{margin:6px 0 18px;color:#6b7280}

  .kpis{display:grid;grid-template-columns:repeat(5,minmax(0,1fr));gap:12px;margin:14px 0 20px}
  .kpi{background:#fff;border:1px solid #e5e7eb;border-radius:14px;padding:12px}
  .kpi .label{font-size:12px;color:#6b7280;margin-bottom:4px}
  .kpi .val{font-size:22px;font-weight:800;color:#111827}

  .section-title{margin:0 0 10px;font-weight:800}
  .focos{display:flex;flex-direction:column;gap:10px}
  .foco{background:#fff;border:1px solid #e5e7eb;border-radius:14px;padding:12px;display:flex;justify-content:space-between;gap:12px}
  .foco .t{font-weight:800;margin:0 0 4px}
  .foco .d{margin:0;color:#6b7280}

  .tag{font-size:12px;font-weight:800;padding:4px 10px;border-radius:999px;align-self:flex-start}
  .tag.alta{background:#fee2e2;color:#991b1b}
  .tag.media{background:#fef3c7;color:#92400e}
  .tag.baja{background:#e0f2fe;color:#075985}

  .btn{
    display:inline-block;text-decoration:none;
    padding:8px 12px;border-radius:10px;
    background:#111827;color:#fff;font-weight:700;
    white-space:nowrap;
  }

  .empty{background:#f9fafb;border:1px dashed #e5e7eb;color:#6b7280;border-radius:14px;padding:14px}
  @media (max-width: 1000px){
    .kpis{grid-template-columns:repeat(2,minmax(0,1fr))}
  }
</style>

<div class="wrap">
  <div class="head">
    <h2>Centro Ejecutivo</h2>
    <p class="sub">{{ estado_general }}</p>
  </div>

  <div class="kpis">
    {% for k in kpis %}
      <div class="kpi">
        <div class="label">{{ k.label }}</div>
        <div class="val">{{ k.value }}</div>
      </div>
    {% endfor %}
  </div>
<!-- Salud de la membresía (basada en OFICIALES vs estado pastoral activo) -->
<style>
  .mcard{background:#fff;border:1px solid #e5e7eb;border-radius:14px;padding:14px;margin:14px 0 18px}
  .mgrid{display:flex;justify-content:space-between;gap:14px;flex-wrap:wrap}
  .mleft{min-width:280px}
  .mtitle{margin:0 0 6px;font-weight:900}
  .mmsg{margin:0;color:#6b7280}
  .mstat{display:flex;gap:14px;align-items:flex-end}
  .mstat .big{font-size:28px;font-weight:900}
  .mstat .small{color:#6b7280;font-weight:700}
  .badge{font-size:12px;font-weight:900;padding:4px 10px;border-radius:999px;display:inline-block;margin-bottom:8px}
  .b-saludable{background:#dcfce7;color:#166534}
  .b-atencion{background:#fef3c7;color:#92400e}
  .b-preocupante{background:#ffe4e6;color:#9f1239}
  .b-critico{background:#fee2e2;color:#991b1b}
  .b-sin_datos{background:#f3f4f6;color:#374151}
  .mini{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
  .pill{background:#f9fafb;border:1px solid #e5e7eb;border-radius:999px;padding:6px 10px;font-weight:800;font-size:12px;color:#374151}
</style>

<div class="mcard">
  <div class="mgrid">
    <div class="mleft">
      <span class="badge b-{{ membresia.diag.nivel }}">{{ membresia.diag.titulo }}</span>
      <h4 class="mtitle">Salud de la membresía (oficiales)</h4>
      <p class="mmsg">{{ membresia.diag.mensaje }}</p>

      <div class="mini">
        {% for x in membresia.desglose_no_activos %}
          <div class="pill">{{ x.label }}: {{ x.value }}</div>
        {% endfor %}
      </div>
    </div>

    <div class="mstat">
      <div>
        <div class="big">{{ membresia.oficiales_estado_activo }}</div>
        <div class="small">Oficiales en estado pastoral activo</div>
      </div>
      <div>
        <div class="big">{{ membresia.oficiales_total }}</div>
        <div class="small">Oficiales totales</div>
      </div>
      <div>
        <a class="btn" href="{{ membresia.cta_url }}">Revisar</a>
      </div>
    </div>
  </div>
</div>

  <h4 class="section-title">Alertas principales</h4>

  {% if focos %}
    <div class="focos">
      {% for f in focos %}
        <div class="foco">
          <div>
            <div class="tag {{ f.nivel }}">{{ f.nivel|capfirst }}</div>
            <p class="t">{{ f.titulo }}</p>
            <p class="d">{{ f.detalle }}</p>
          </div>
          <div>
            <a class="btn" href="{{ f.cta_url }}">{{ f.cta_texto }}</a>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="empty">No hay alertas activas. Si quieres, entramos a “Personas” para revisar en detalle.</div>
  {% endif %}
</div>
{% endblock %}
