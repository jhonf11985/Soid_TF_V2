{% extends "core/base.html" %}

{% block title %}{{ titulo }}{% endblock %}

{% block content %}

<form method="post" class="odoo-form" novalidate>
    {% csrf_token %}

    <!-- ══════════════════════════════════════════════════════════════════════════
         BARRA SUPERIOR (Control Bar)
         ══════════════════════════════════════════════════════════════════════════ -->
    <div class="odoo-control-bar">
        <div class="odoo-control-left">
            <a href="{% url 'votacion:lista_votaciones' %}" class="odoo-breadcrumb-link">
                <span class="material-icons">arrow_back</span>
                Votaciones
            </a>
            <span class="odoo-breadcrumb-sep">/</span>
            <span class="odoo-breadcrumb-current">
                {% if es_nueva %}Nueva{% else %}{{ votacion.nombre|truncatechars:30 }}{% endif %}
            </span>
            
            {% if es_nueva %}
            <span class="odoo-new-badge">Nuevo</span>
            {% endif %}
        </div>
        
        <div class="odoo-control-right">
            {% if votacion %}
            <div class="odoo-status-pill {% if votacion.estado == 'ABIERTA' %}odoo-status-success{% elif votacion.estado == 'CERRADA' %}odoo-status-muted{% else %}odoo-status-warning{% endif %}">
                <span class="odoo-status-dot"></span>
                {{ votacion.get_estado_display }}
            </div>
            {% else %}
            <div class="odoo-status-pill odoo-status-warning">
                <span class="odoo-status-dot"></span>
                Nueva (borrador)
            </div>
            {% endif %}
        </div>
    </div>

    <!-- ══════════════════════════════════════════════════════════════════════════
         CONTENIDO PRINCIPAL
         ══════════════════════════════════════════════════════════════════════════ -->
    <div class="odoo-form-container">
        
        <!-- ÁREA PRINCIPAL DEL FORMULARIO -->
        <div class="odoo-form-main">
            
            <!-- ─────────────────────────────────────────────────────────────────────
                 HEADER: Icono + Título + Info principal
                 ───────────────────────────────────────────────────────────────────── -->
            <div class="odoo-form-header">
                
                <!-- Icono de votación -->
                <div class="odoo-avatar-section">
                    <div class="odoo-avatar odoo-avatar-votacion">
                        <span class="material-icons">how_to_vote</span>
                    </div>
                </div>

                <!-- Info principal -->
                <div class="odoo-header-info">
                    
                    <!-- Tipo de votación -->
                    <div class="odoo-radio-group">
                        {% for radio in form.tipo %}
                        <label class="odoo-radio">
                            {{ radio.tag }}
                            <span>{{ radio.choice_label }}</span>
                        </label>
                        {% endfor %}
                    </div>

                    <!-- Nombre grande -->
                    <div class="odoo-name-field">
                        <input type="text" 
                               name="nombre" 
                               id="{{ form.nombre.id_for_label }}"
                               value="{{ form.nombre.value|default:'' }}"
                               placeholder="Nombre de la elección"
                               class="odoo-name-input {% if form.nombre.errors %}odoo-input-error{% endif %}"
                               required>
                    </div>
                    {% if form.nombre.errors %}
                    <span class="odoo-error-inline">{{ form.nombre.errors.0 }}</span>
                    {% endif %}

                    <!-- Campos rápidos -->
                    <div class="odoo-quick-fields">
                        <div class="odoo-quick-field">
                            <span class="material-icons">event</span>
                            <input type="date" 
                                   name="fecha_inicio" 
                                   id="{{ form.fecha_inicio.id_for_label }}"
                                   value="{{ form.fecha_inicio.value|default:'' }}"
                                   title="Fecha inicio">
                        </div>
                        <div class="odoo-quick-field">
                            <span class="material-icons">event_busy</span>
                            <input type="date" 
                                   name="fecha_fin" 
                                   id="{{ form.fecha_fin.id_for_label }}"
                                   value="{{ form.fecha_fin.value|default:'' }}"
                                   title="Fecha cierre">
                        </div>
                        <div class="odoo-quick-field">
                            <span class="material-icons">people</span>
                            <input type="number" 
                                   name="numero_cargos" 
                                   id="{{ form.numero_cargos.id_for_label }}"
                                   value="{{ form.numero_cargos.value|default:'1' }}"
                                   placeholder="Cargos"
                                   min="1"
                                   style="width: 80px;">
                            <span class="odoo-quick-label">cargos</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ─────────────────────────────────────────────────────────────────────
                 TABS
                 ───────────────────────────────────────────────────────────────────── -->
            <div class="odoo-tabs-section">
                <div class="odoo-tabs-bar">
                    <button type="button" class="odoo-tab active" data-tab="config">
                        Configuración
                    </button>
                    <button type="button" class="odoo-tab" data-tab="quorum">
                        Quórum
                    </button>
                    <button type="button" class="odoo-tab" data-tab="opciones">
                        Opciones
                    </button>
                    <button type="button" class="odoo-tab" data-tab="candidatos">
                        Candidatos
                    </button>
                    <button type="button" class="odoo-tab" data-tab="vueltas">
                        Vueltas
                    </button>
                </div>

                <div class="odoo-tabs-content">

                    <!-- ═══════════════════════════════════════════════════════════
                         TAB: CONFIGURACIÓN GENERAL
                         ═══════════════════════════════════════════════════════════ -->
                    <div id="tab-config" class="odoo-tab-panel active">
                        <div class="odoo-tab-grid">
                            
                            <div class="odoo-field">
                                <label class="odoo-label">
                                    Regla de votación
                                    <a href="{% url 'votacion:documentacion_sistemas_votacion' %}"
                                       class="odoo-info-link"
                                       target="_blank"
                                       title="Ver explicación">ⓘ</a>
                                </label>
                                <div class="odoo-field-input">
                                    {{ form.regla_ganador }}
                                </div>
                            </div>
                            {% if form.regla_ganador.errors %}
                            <div class="odoo-field-error">{{ form.regla_ganador.errors.0 }}</div>
                            {% endif %}

                            {% if form.edad_minima_candidato %}
                            <div class="odoo-field">
                                <label class="odoo-label">Edad mínima candidato</label>
                                <div class="odoo-field-input">
                                    {{ form.edad_minima_candidato }}
                                </div>
                            </div>
                            {% endif %}

                            <div class="odoo-field odoo-field-full">
                                <label class="odoo-label">Observaciones internas</label>
                                <div class="odoo-field-input">
                                    <textarea name="observaciones_internas" 
                                              id="{{ form.observaciones_internas.id_for_label }}"
                                              class="odoo-textarea"
                                              rows="3"
                                              placeholder="Notas internas sobre esta elección...">{{ form.observaciones_internas.value|default:'' }}</textarea>
                                </div>
                            </div>

                        </div>
                    </div>

                    <!-- ═══════════════════════════════════════════════════════════
                         TAB: QUÓRUM Y ASISTENCIA
                         ═══════════════════════════════════════════════════════════ -->
                    <div id="tab-quorum" class="odoo-tab-panel">
                        
                        <div class="odoo-quorum-cards">
                            
                            <!-- Card: Habilitados -->
                            <div class="odoo-quorum-card odoo-quorum-highlight">
                                <div class="odoo-quorum-label">Miembros con derecho a voto</div>
                                <div class="odoo-quorum-value">{{ form.total_habilitados.value|default:"—" }}</div>
                                <div class="odoo-quorum-help">Miembros oficiales activos que cumplen la edad mínima.</div>
                                <div style="display:none;">{{ form.total_habilitados }}</div>
                            </div>

                            <!-- Card: Presentes -->
                            <div class="odoo-quorum-card">
                                <div class="odoo-quorum-label">Miembros presentes hoy</div>
                                <div class="odoo-quorum-field">
                                    {{ form.miembros_presentes }}
                                </div>
                                <div class="odoo-quorum-help">Cuántos están físicamente presentes.</div>
                            </div>

                        </div>

                        <!-- Regla de quórum -->
                        <div class="odoo-subsection">
                            <div class="odoo-subsection-title">Regla de quórum</div>
                            
                            <div class="odoo-tab-grid odoo-grid-3">
                                <div class="odoo-field">
                                    <label class="odoo-label">Base</label>
                                    <div class="odoo-field-input">
                                        {{ form.base_quorum }}
                                    </div>
                                    <span class="odoo-field-hint">Habilitados o presentes</span>
                                </div>

                                <div class="odoo-field">
                                    <label class="odoo-label">Tipo</label>
                                    <div class="odoo-field-input">
                                        {{ form.tipo_quorum }}
                                    </div>
                                    <span class="odoo-field-hint">Porcentaje o cantidad fija</span>
                                </div>

                                <div class="odoo-field">
                                    <label class="odoo-label">Valor</label>
                                    <div class="odoo-field-input">
                                        {{ form.valor_quorum }}
                                    </div>
                                    <span class="odoo-field-hint">Número o porcentaje</span>
                                </div>
                            </div>

                            <div class="odoo-quorum-result">
                                <label class="odoo-label">Votos mínimos requeridos</label>
                                <div class="odoo-field-input">
                                    {{ form.votos_minimos_requeridos }}
                                </div>
                                <span class="odoo-field-hint">Calculado según la base y el valor configurados.</span>
                            </div>
                        </div>
                    </div>

                    <!-- ═══════════════════════════════════════════════════════════
                         TAB: OPCIONES ADICIONALES
                         ═══════════════════════════════════════════════════════════ -->
                    <div id="tab-opciones" class="odoo-tab-panel">
                        <div class="odoo-tab-grid">
                            
                            <div class="odoo-field-checkbox">
                                <label>
                                    {{ form.permite_empates }}
                                    <span>Permitir empates</span>
                                </label>
                            </div>

                            <div class="odoo-field-checkbox">
                                <label>
                                    {{ form.permite_voto_remoto }}
                                    <span>Permitir voto remoto</span>
                                </label>
                            </div>

                        </div>

                        {% if votacion %}
                        <div class="odoo-subsection">
                            <div class="odoo-subsection-title">Cambiar estado</div>
                            <div class="odoo-estado-actions">
                                {% if votacion.estado == 'BORRADOR' %}
                                <button type="submit" formaction="{% url 'votacion:cambiar_estado' votacion.pk %}" name="nuevo_estado" value="ABIERTA" class="odoo-btn odoo-btn-success">
                                    <span class="material-icons">play_arrow</span>
                                    Abrir votación
                                </button>
                                {% elif votacion.estado == 'ABIERTA' %}
                                <button type="submit" formaction="{% url 'votacion:cambiar_estado' votacion.pk %}" name="nuevo_estado" value="CERRADA" class="odoo-btn odoo-btn-secondary">
                                    <span class="material-icons">stop</span>
                                    Cerrar votación
                                </button>
                                {% elif votacion.estado == 'CERRADA' %}
                                <button type="submit" formaction="{% url 'votacion:cambiar_estado' votacion.pk %}" name="nuevo_estado" value="BORRADOR" class="odoo-btn odoo-btn-secondary">
                                    <span class="material-icons">edit</span>
                                    Volver a borrador
                                </button>
                                {% endif %}
                            </div>
                        </div>
                        {% endif %}
                    </div>

                    <!-- ═══════════════════════════════════════════════════════════
                         TAB: CARGAR CANDIDATOS
                         ═══════════════════════════════════════════════════════════ -->
                    <div id="tab-candidatos" class="odoo-tab-panel">
                        {% if not votacion %}
                        <div class="odoo-empty-state">
                            <span class="material-icons">info</span>
                            <p>Guarda primero la votación para habilitar esta sección.</p>
                        </div>
                        {% else %}
                        <div class="odoo-tab-grid">
                            <div class="odoo-field">
                                <label class="odoo-label">Lista de candidatos</label>
                                <div class="odoo-field-input">
                                    <select name="lista_candidatos_id" id="id_lista_candidatos" class="odoo-select">
                                        <option value="">Selecciona una lista…</option>
                                        {% for lista in listas_candidatos_disponibles %}
                                        <option value="{{ lista.pk }}">{{ lista.nombre }} — {{ lista.items.count }} miembros</option>
                                        {% empty %}
                                        <option value="">No hay listas confirmadas</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <span class="odoo-field-hint">Solo se muestran listas confirmadas.</span>
                            </div>

                            <div class="odoo-field" style="align-self: flex-end;">
                                <button type="submit" formaction="{% url 'votacion:cargar_candidatos_desde_lista' votacion.pk %}" class="odoo-btn odoo-btn-secondary">
                                    <span class="material-icons">download</span>
                                    Cargar lista
                                </button>
                            </div>
                        </div>
                        {% endif %}
                    </div>

                    <!-- ═══════════════════════════════════════════════════════════
                         TAB: VUELTAS
                         ═══════════════════════════════════════════════════════════ -->
                    <div id="tab-vueltas" class="odoo-tab-panel">
                        {% if es_nueva or not votacion %}
                        <div class="odoo-empty-state">
                            <span class="material-icons">info</span>
                            <p>Primero guarda la configuración general para gestionar las vueltas.</p>
                        </div>
                        {% else %}
                        
                        <div class="odoo-add-line" style="margin-bottom: 16px;">
                            <button type="submit" formaction="{% url 'votacion:agregar_ronda' votacion.pk %}" class="odoo-btn odoo-btn-secondary">
                                <span class="material-icons">add</span>
                                Nueva vuelta
                            </button>
                        </div>

                        {% with votacion.rondas.all as rondas %}
                        {% if rondas %}
                        <table class="odoo-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Nombre</th>
                                    <th>Estado</th>
                                    <th>Votos</th>
                                    <th>Inicio</th>
                                    <th>Cierre</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for ronda in rondas %}
                                <tr>
                                    <td>{{ ronda.numero }}</td>
                                    <td>
                                        {% if ronda.numero == 1 %}Primera vuelta
                                        {% elif ronda.numero == 2 %}Segunda vuelta
                                        {% else %}Vuelta {{ ronda.numero }}{% endif %}
                                        {% if ronda.nombre %} - {{ ronda.nombre }}{% endif %}
                                    </td>
                                    <td>
                                        {% if ronda.estado == "ABIERTA" %}
                                        <span class="odoo-badge odoo-badge-success">Abierta</span>
                                        {% elif ronda.estado == "CERRADA" %}
                                        <span class="odoo-badge odoo-badge-muted">Cerrada</span>
                                        {% else %}
                                        <span class="odoo-badge odoo-badge-warning">Borrador</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ ronda.votos.count }}</td>
                                    <td>{{ ronda.fecha_inicio|default:"—" }}</td>
                                    <td>{{ ronda.fecha_fin|default:"—" }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        {% else %}
                        <div class="odoo-empty-text">Aún no hay vueltas registradas.</div>
                        {% endif %}
                        {% endwith %}
                        {% endif %}
                    </div>

                </div>
            </div>

        </div>

        <!-- ═══════════════════════════════════════════════════════════════════════
             PANEL LATERAL
             ═══════════════════════════════════════════════════════════════════════ -->
        <div class="odoo-form-aside">
            
            <!-- Botones de acción -->
            <div class="odoo-aside-actions">
                <button type="submit" name="accion" value="guardar_votacion" class="odoo-btn-save">
                    <span class="material-icons">check</span>
                    Guardar
                </button>
                <a href="{% url 'votacion:lista_votaciones' %}" class="odoo-btn-cancel">
                    Descartar
                </a>
            </div>

            {% if not es_nueva and votacion %}
            <!-- Acciones adicionales -->
            <div class="odoo-aside-extra">
                <button type="submit" formaction="{% url 'votacion:duplicar_votacion' votacion.pk %}" class="odoo-btn-link">
                    <span class="material-icons">content_copy</span>
                    Duplicar elección
                </button>
                <button type="submit" formaction="{% url 'votacion:eliminar_votacion' votacion.pk %}" 
                        onclick="return confirm('¿Seguro que deseas eliminar esta elección?')"
                        class="odoo-btn-link odoo-btn-danger">
                    <span class="material-icons">delete</span>
                    Eliminar
                </button>
            </div>
            {% endif %}

            <!-- Consejos -->
            <div class="odoo-aside-tips">
                <div class="odoo-info-title">
                    <span class="material-icons">lightbulb</span>
                    Consejos
                </div>
                <ul class="odoo-tips-list">
                    <li>Define <strong>nombre, tipo y regla</strong> primero.</li>
                    <li>Ajusta el <strong>quórum</strong> según asistencia.</li>
                    <li>Configura <strong>fechas</strong> y opciones.</li>
                    <li>Después de guardar, gestiona las <strong>vueltas</strong>.</li>
                </ul>
            </div>

            <!-- Info de estado -->
            <div class="odoo-aside-info">
                <div class="odoo-info-title">
                    <span class="material-icons">info</span>
                    Estado
                </div>
                <div class="odoo-info-content">
                    <p>Usa <strong>Borrador</strong> mientras preparas.</p>
                    <p>Cambia a <strong>Abierta</strong> para iniciar.</p>
                </div>
            </div>

        </div>

    </div>

</form>

<!-- ══════════════════════════════════════════════════════════════════════════════
     ESTILOS
     ══════════════════════════════════════════════════════════════════════════════ -->
<style>
/* ═══════════════════════════════════════════════════════════════════════════
   RESET Y BASE
   ═══════════════════════════════════════════════════════════════════════════ */
.odoo-form {
    background: #f8f9fa;
    min-height: 100vh;
}

/* ═══════════════════════════════════════════════════════════════════════════
   BARRA DE CONTROL
   ═══════════════════════════════════════════════════════════════════════════ */
.odoo-control-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 16px;
    background: white;
    border-bottom: 1px solid #dee2e6;
    position: sticky;
    top: 0;
    z-index: 100;
}

.odoo-control-left {
    display: flex;
    align-items: center;
    gap: 8px;
}

.odoo-breadcrumb-link {
    display: flex;
    align-items: center;
    gap: 4px;
    color: #017e84;
    text-decoration: none;
    font-size: 13px;
    font-weight: 500;
}

.odoo-breadcrumb-link:hover {
    text-decoration: underline;
}

.odoo-breadcrumb-link .material-icons {
    font-size: 18px;
}

.odoo-breadcrumb-sep {
    color: #6c757d;
}

.odoo-breadcrumb-current {
    font-size: 13px;
    color: #495057;
    font-weight: 500;
}

.odoo-new-badge {
    background: #d1fae5;
    color: #065f46;
    font-size: 11px;
    padding: 2px 8px;
    border-radius: 4px;
    font-weight: 500;
}

.odoo-control-right {
    display: flex;
    align-items: center;
    gap: 12px;
}

.odoo-status-pill {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 500;
}

.odoo-status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
}

.odoo-status-success {
    background: #d1fae5;
    color: #065f46;
}
.odoo-status-success .odoo-status-dot {
    background: #10b981;
}

.odoo-status-warning {
    background: #fef3c7;
    color: #92400e;
}
.odoo-status-warning .odoo-status-dot {
    background: #f59e0b;
}

.odoo-status-muted {
    background: #f3f4f6;
    color: #4b5563;
}
.odoo-status-muted .odoo-status-dot {
    background: #6b7280;
}

/* ═══════════════════════════════════════════════════════════════════════════
   CONTENEDOR PRINCIPAL
   ═══════════════════════════════════════════════════════════════════════════ */
.odoo-form-container {
    display: grid;
    grid-template-columns: 1fr 280px;
    min-height: calc(100vh - 50px);
}

.odoo-form-main {
    background: white;
    padding: 0;
    border-right: 1px solid #dee2e6;
}

/* ═══════════════════════════════════════════════════════════════════════════
   HEADER DEL FORMULARIO
   ═══════════════════════════════════════════════════════════════════════════ */
.odoo-form-header {
    display: flex;
    gap: 24px;
    padding: 24px;
    border-bottom: 1px solid #e9ecef;
    background: linear-gradient(180deg, #f8f9fa 0%, white 100%);
}

.odoo-avatar-section {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
}

.odoo-avatar {
    width: 110px;
    height: 110px;
    border-radius: 8px;
    background: #e9ecef;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
}

.odoo-avatar-votacion {
    background: linear-gradient(135deg, #6366f1, #4f46e5);
}

.odoo-avatar .material-icons {
    font-size: 48px;
    color: white;
}

.odoo-header-info {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 12px;
}

/* Radio group */
.odoo-radio-group {
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
}

.odoo-radio {
    display: flex;
    align-items: center;
    gap: 6px;
    cursor: pointer;
    font-size: 13px;
    color: #495057;
}

.odoo-radio input {
    accent-color: #017e84;
}

/* Name field */
.odoo-name-field {
    display: flex;
    gap: 12px;
}

.odoo-name-input {
    flex: 1;
    border: none;
    border-bottom: 2px solid #e9ecef;
    padding: 8px 0;
    font-size: 24px;
    font-weight: 500;
    color: #212529;
    background: transparent;
    transition: border-color 0.2s ease;
}

.odoo-name-input:hover {
    border-color: #adb5bd;
}

.odoo-name-input:focus {
    outline: none;
    border-color: #017e84;
}

.odoo-name-input::placeholder {
    color: #adb5bd;
    font-weight: 400;
}

.odoo-name-input.odoo-input-error {
    border-color: #dc3545;
}

.odoo-error-inline {
    color: #dc3545;
    font-size: 12px;
    margin-top: -8px;
}

/* Quick fields */
.odoo-quick-fields {
    display: flex;
    gap: 24px;
    flex-wrap: wrap;
}

.odoo-quick-field {
    display: flex;
    align-items: center;
    gap: 8px;
}

.odoo-quick-field .material-icons {
    font-size: 18px;
    color: #6c757d;
}

.odoo-quick-field input {
    border: none;
    border-bottom: 1px solid transparent;
    padding: 4px 0;
    font-size: 14px;
    color: #212529;
    background: transparent;
    transition: border-color 0.2s ease;
}

.odoo-quick-field input:hover {
    border-color: #dee2e6;
}

.odoo-quick-field input:focus {
    outline: none;
    border-color: #017e84;
}

.odoo-quick-label {
    font-size: 13px;
    color: #6c757d;
}

/* ═══════════════════════════════════════════════════════════════════════════
   TABS
   ═══════════════════════════════════════════════════════════════════════════ */
.odoo-tabs-section {
    padding: 0 24px 24px;
}

.odoo-tabs-bar {
    display: flex;
    gap: 0;
    border-bottom: 1px solid #dee2e6;
    flex-wrap: wrap;
    margin-bottom: 20px;
}

.odoo-tab {
    padding: 10px 16px;
    font-size: 13px;
    font-weight: 500;
    color: #6c757d;
    background: transparent;
    border: none;
    border-bottom: 2px solid transparent;
    cursor: pointer;
    transition: all 0.2s ease;
}

.odoo-tab:hover {
    color: #495057;
    background: #f8f9fa;
}

.odoo-tab.active {
    color: #017e84;
    border-bottom-color: #017e84;
}

.odoo-tabs-content {
    min-height: 200px;
}

.odoo-tab-panel {
    display: none;
}

.odoo-tab-panel.active {
    display: block;
}

.odoo-tab-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px 32px;
}

.odoo-grid-3 {
    grid-template-columns: repeat(3, 1fr);
}

.odoo-field-full {
    grid-column: 1 / -1;
}

/* ═══════════════════════════════════════════════════════════════════════════
   FIELDS
   ═══════════════════════════════════════════════════════════════════════════ */
.odoo-field {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.odoo-label {
    font-size: 12px;
    font-weight: 500;
    color: #495057;
    display: flex;
    align-items: center;
    gap: 6px;
}

.odoo-info-link {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: rgba(1, 126, 132, 0.1);
    color: #017e84;
    font-size: 11px;
    text-decoration: none;
}

.odoo-info-link:hover {
    background: #017e84;
    color: white;
}

.odoo-field-input select,
.odoo-field-input input,
.odoo-select {
    width: 100%;
    border: none;
    border-bottom: 1px solid #dee2e6;
    border-radius: 0;
    padding: 6px 0;
    font-size: 14px;
    font-family: inherit;
    color: #212529;
    background: transparent;
    transition: border-color 0.2s ease;
}

.odoo-field-input select:hover,
.odoo-field-input input:hover {
    border-bottom-color: #adb5bd;
}

.odoo-field-input select:focus,
.odoo-field-input input:focus {
    outline: none;
    border-bottom-color: #017e84;
    border-bottom-width: 2px;
    padding-bottom: 5px;
}

.odoo-textarea {
    width: 100%;
    border: none;
    border-bottom: 1px solid #dee2e6;
    border-radius: 0;
    padding: 8px 0;
    font-size: 14px;
    font-family: inherit;
    resize: vertical;
    min-height: 60px;
    background: transparent;
    transition: border-color 0.2s ease;
}

.odoo-textarea:hover {
    border-bottom-color: #adb5bd;
}

.odoo-textarea:focus {
    outline: none;
    border-bottom-color: #017e84;
    border-bottom-width: 2px;
}

.odoo-field-hint {
    font-size: 11px;
    color: #6c757d;
}

.odoo-field-error {
    color: #dc3545;
    font-size: 12px;
}

/* Checkbox */
.odoo-field-checkbox {
    display: flex;
    align-items: center;
}

.odoo-field-checkbox label {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    font-size: 14px;
    color: #212529;
}

.odoo-field-checkbox input {
    accent-color: #017e84;
}

/* ═══════════════════════════════════════════════════════════════════════════
   QUÓRUM CARDS
   ═══════════════════════════════════════════════════════════════════════════ */
.odoo-quorum-cards {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    margin-bottom: 20px;
}

.odoo-quorum-card {
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 16px;
}

.odoo-quorum-highlight {
    background: #eff6ff;
    border-color: #bfdbfe;
}

.odoo-quorum-label {
    font-size: 12px;
    font-weight: 600;
    color: #495057;
    margin-bottom: 8px;
}

.odoo-quorum-value {
    font-size: 32px;
    font-weight: 700;
    color: #212529;
    line-height: 1;
    margin-bottom: 8px;
}

.odoo-quorum-field input {
    width: 100%;
    border: none;
    border-bottom: 1px solid #dee2e6;
    padding: 8px 0;
    font-size: 24px;
    font-weight: 600;
    color: #212529;
    background: transparent;
}

.odoo-quorum-field input:focus {
    outline: none;
    border-bottom-color: #017e84;
}

.odoo-quorum-help {
    font-size: 11px;
    color: #6c757d;
}

.odoo-quorum-result {
    margin-top: 16px;
    padding-top: 16px;
    border-top: 1px dashed #dee2e6;
}

.odoo-quorum-result input {
    width: 150px;
    border: none;
    border-bottom: 1px solid #dee2e6;
    padding: 6px 0;
    font-size: 18px;
    font-weight: 600;
    color: #212529;
    background: transparent;
}

/* ═══════════════════════════════════════════════════════════════════════════
   SUBSECTION
   ═══════════════════════════════════════════════════════════════════════════ */
.odoo-subsection {
    margin-top: 20px;
    padding-top: 16px;
    border-top: 1px dashed #dee2e6;
}

.odoo-subsection-title {
    font-size: 13px;
    font-weight: 600;
    color: #495057;
    margin-bottom: 16px;
}

/* ═══════════════════════════════════════════════════════════════════════════
   TABLA
   ═══════════════════════════════════════════════════════════════════════════ */
.odoo-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 13px;
}

.odoo-table th {
    text-align: left;
    padding: 10px 12px;
    background: #f8f9fa;
    color: #495057;
    font-weight: 500;
    border-bottom: 1px solid #dee2e6;
}

.odoo-table td {
    padding: 10px 12px;
    border-bottom: 1px solid #e9ecef;
    color: #212529;
}

.odoo-table tr:hover td {
    background: #f8f9fa;
}

/* Badges */
.odoo-badge {
    display: inline-flex;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 500;
}

.odoo-badge-success {
    background: #d1fae5;
    color: #065f46;
}

.odoo-badge-warning {
    background: #fef3c7;
    color: #92400e;
}

.odoo-badge-muted {
    background: #f3f4f6;
    color: #4b5563;
}

/* Empty state */
.odoo-empty-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 40px;
    color: #6c757d;
    text-align: center;
}

.odoo-empty-state .material-icons {
    font-size: 48px;
    opacity: 0.5;
    margin-bottom: 8px;
}

.odoo-empty-text {
    color: #6c757d;
    font-size: 13px;
    font-style: italic;
}

/* ═══════════════════════════════════════════════════════════════════════════
   BOTONES
   ═══════════════════════════════════════════════════════════════════════════ */
.odoo-btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 8px 16px;
    font-size: 13px;
    font-weight: 500;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    text-decoration: none;
    transition: all 0.2s ease;
    font-family: inherit;
}

.odoo-btn .material-icons {
    font-size: 18px;
}

.odoo-btn-secondary {
    background: white;
    color: #495057;
    border: 1px solid #dee2e6;
}

.odoo-btn-secondary:hover {
    background: #e9ecef;
}

.odoo-btn-success {
    background: #10b981;
    color: white;
}

.odoo-btn-success:hover {
    background: #059669;
}

.odoo-estado-actions {
    display: flex;
    gap: 8px;
}

/* ═══════════════════════════════════════════════════════════════════════════
   PANEL LATERAL
   ═══════════════════════════════════════════════════════════════════════════ */
.odoo-form-aside {
    background: #f8f9fa;
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 16px;
}

/* Botones de acción */
.odoo-aside-actions {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.odoo-btn-save {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    width: 100%;
    padding: 10px 16px;
    background: #017e84;
    color: white;
    border: none;
    border-radius: 4px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.2s ease;
    font-family: inherit;
}

.odoo-btn-save:hover {
    background: #016166;
}

.odoo-btn-save .material-icons {
    font-size: 18px;
}

.odoo-btn-cancel {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    padding: 10px 16px;
    background: white;
    color: #495057;
    border: 1px solid #dee2e6;
    border-radius: 4px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    text-decoration: none;
    transition: background 0.2s ease;
}

.odoo-btn-cancel:hover {
    background: #e9ecef;
}

/* Extra actions */
.odoo-aside-extra {
    display: flex;
    flex-direction: column;
    gap: 4px;
    padding-top: 8px;
    border-top: 1px solid #dee2e6;
}

.odoo-btn-link {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px 0;
    background: none;
    border: none;
    color: #017e84;
    font-size: 13px;
    cursor: pointer;
    text-decoration: none;
}

.odoo-btn-link:hover {
    text-decoration: underline;
}

.odoo-btn-link .material-icons {
    font-size: 18px;
}

.odoo-btn-danger {
    color: #dc3545;
}

/* Info cards */
.odoo-aside-info,
.odoo-aside-tips {
    background: white;
    border-radius: 4px;
    padding: 12px;
}

.odoo-info-title {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 12px;
    font-weight: 600;
    color: #495057;
    text-transform: uppercase;
    margin-bottom: 8px;
}

.odoo-info-title .material-icons {
    font-size: 16px;
    color: #017e84;
}

.odoo-info-content {
    font-size: 13px;
    color: #6c757d;
}

.odoo-info-content p {
    margin: 0 0 4px;
}

/* Tips */
.odoo-tips-list {
    margin: 0;
    padding-left: 16px;
    font-size: 12px;
    color: #6c757d;
    line-height: 1.6;
}

.odoo-tips-list li {
    margin-bottom: 4px;
}

/* ═══════════════════════════════════════════════════════════════════════════
   RESPONSIVE
   ═══════════════════════════════════════════════════════════════════════════ */
@media (max-width: 1200px) {
    .odoo-form-container {
        grid-template-columns: 1fr;
    }
    
    .odoo-form-main {
        border-right: none;
        border-bottom: 1px solid #dee2e6;
    }
    
    .odoo-form-aside {
        flex-direction: row;
        flex-wrap: wrap;
        gap: 16px;
    }
    
    .odoo-aside-actions {
        flex-direction: row;
        width: 100%;
    }
    
    .odoo-btn-save,
    .odoo-btn-cancel {
        flex: 1;
    }
    
    .odoo-aside-info,
    .odoo-aside-tips {
        flex: 1;
        min-width: 200px;
    }
}

@media (max-width: 768px) {
    .odoo-form-header {
        flex-direction: column;
        align-items: center;
        text-align: center;
    }
    
    .odoo-quick-fields {
        flex-direction: column;
        width: 100%;
    }
    
    .odoo-tab-grid,
    .odoo-grid-3 {
        grid-template-columns: 1fr;
    }
    
    .odoo-quorum-cards {
        grid-template-columns: 1fr;
    }
}
</style>

<!-- ══════════════════════════════════════════════════════════════════════════════
     SCRIPTS
     ══════════════════════════════════════════════════════════════════════════════ -->
<script>
// Tabs
document.addEventListener('DOMContentLoaded', function() {
    const tabs = document.querySelectorAll('.odoo-tab');
    const panels = document.querySelectorAll('.odoo-tab-panel');
    
    tabs.forEach(tab => {
        tab.addEventListener('click', function() {
            const targetId = 'tab-' + this.dataset.tab;
            
            tabs.forEach(t => t.classList.remove('active'));
            panels.forEach(p => p.classList.remove('active'));
            
            this.classList.add('active');
            document.getElementById(targetId)?.classList.add('active');
        });
    });
    
    // URL params
    const params = new URLSearchParams(window.location.search);
    const tabParam = params.get('tab');
    if (tabParam) {
        const targetTab = document.querySelector(`[data-tab="${tabParam}"]`);
        if (targetTab) targetTab.click();
    }
});

// Cálculo de quórum
function recalcularQuorumPreview() {
    const baseField = document.getElementById("id_base_quorum");
    const tipoField = document.getElementById("id_tipo_quorum");
    const valorField = document.getElementById("id_valor_quorum");
    const totalHabilitadosField = document.getElementById("id_total_habilitados");
    const presentesField = document.getElementById("id_miembros_presentes");
    const votosMinField = document.getElementById("id_votos_minimos_requeridos");

    if (!baseField || !tipoField || !valorField || !votosMinField) return;

    const base = baseField.value;
    const tipo = tipoField.value;
    const valor = parseFloat((valorField.value || "").replace(",", "."));

    let baseNumero = 0;
    if (base === "HABILITADOS" && totalHabilitadosField) {
        baseNumero = parseInt(totalHabilitadosField.value || "0", 10);
    } else if (base === "PRESENTES" && presentesField) {
        baseNumero = parseInt(presentesField.value || "0", 10);
    }

    if (!tipo || tipo === "NINGUNO" || isNaN(valor) || baseNumero <= 0) {
        votosMinField.value = "";
        return;
    }

    let resultado = 0;
    if (tipo === "PORCENTAJE") {
        const porcentaje = Math.max(0, Math.min(valor, 100));
        resultado = Math.ceil(baseNumero * (porcentaje / 100));
    } else if (tipo === "CANTIDAD") {
        resultado = Math.max(0, Math.floor(valor));
    }

    votosMinField.value = resultado;
}

document.addEventListener("DOMContentLoaded", function () {
    const ids = ["id_base_quorum", "id_tipo_quorum", "id_valor_quorum", "id_total_habilitados", "id_miembros_presentes"];
    ids.forEach(function (id) {
        const el = document.getElementById(id);
        if (el) {
            el.addEventListener("change", recalcularQuorumPreview);
            el.addEventListener("keyup", recalcularQuorumPreview);
        }
    });
    recalcularQuorumPreview();
});
</script>

{% endblock %}
