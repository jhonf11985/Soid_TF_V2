{% extends "core/base.html" %}

{% block title %}{{ titulo }} · Soid_Tf_2{% endblock %}

{% block content %}

<!-- ===========================
     ENCABEZADO
=========================== -->
<section class="page-header">
    <div>
        <h1 class="page-title">{{ titulo }}</h1>
        <p class="page-subtitle">
            Configura el tipo de elección, las reglas, las vueltas y el quórum de forma organizada.
        </p>
    </div>

    <div class="page-header-actions">
        {% if not es_nueva and votacion %}

            <!-- Duplicar -->
            <form method="post"
                  action="{% url 'votacion:duplicar_votacion' votacion.pk %}"
                  style="display:inline-block; margin-right: 8px;">
                {% csrf_token %}
                <button type="submit" class="btn-secondary">
                    <span class="material-icons" style="font-size: 18px;">content_copy</span>
                    Duplicar
                </button>
            </form>

            <!-- Eliminar -->
            <form method="post"
                  action="{% url 'votacion:eliminar_votacion' votacion.pk %}"
                  onsubmit="return confirm('¿Seguro que deseas eliminar esta elección?')"
                  style="display:inline-block; margin-right: 8px;">
                {% csrf_token %}
                <button type="submit" class="btn-danger">
                    <span class="material-icons" style="font-size: 18px;">delete</span>
                    Eliminar
                </button>
            </form>
        {% endif %}

        <!-- Volver -->
        <a href="{% url 'votacion:lista_votaciones' %}" class="btn-secondary">
            <span class="material-icons" style="font-size: 18px;">arrow_back</span>
            Volver
        </a>
    </div>
</section>

<section class="votacion-config-wrapper">

    <!-- MENSAJES -->
    {% if messages %}
        <div class="messages-container" style="margin-bottom:10px;">
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">{{ message }}</div>
            {% endfor %}
        </div>
    {% endif %}

    <div class="votacion-card">

        <!-- ENCABEZADO INTERNO -->
<div class="votacion-card-header">
    <div>
        <h2>Ficha de configuración</h2>
        <p class="votacion-card-subtitle">
            Ajusta primero la configuración general. Luego revisa quórum, fechas y vueltas.
        </p>
    </div>

    {% if votacion %}
        <div class="estado-wrapper">
            <!-- PILL SOLO LECTURA DEL ESTADO -->
            <div class="votacion-status-pill">
                <span class="status-dot
                    {% if votacion.estado == 'ABIERTA' %} status-open
                    {% elif votacion.estado == 'CERRADA' %} status-closed
                    {% else %} status-draft
                    {% endif %}
                "></span>
                {{ votacion.get_estado_display }}
            </div>

            <!-- BOTONES DE CAMBIO DE ESTADO -->
            <div class="estado-actions">
                {% if votacion.estado == 'BORRADOR' %}
                    <form method="post" action="{% url 'votacion:cambiar_estado' votacion.pk %}">
                        {% csrf_token %}
                        <input type="hidden" name="nuevo_estado" value="ABIERTA">
                        <button type="submit" class="btn-secondary btn-xs">
                            Abrir votación
                        </button>
                    </form>
                {% elif votacion.estado == 'ABIERTA' %}
                    <form method="post" action="{% url 'votacion:cambiar_estado' votacion.pk %}">
                        {% csrf_token %}
                        <input type="hidden" name="nuevo_estado" value="CERRADA">
                        <button type="submit" class="btn-secondary btn-xs">
                            Cerrar votación
                        </button>
                    </form>
                {% elif votacion.estado == 'CERRADA' %}
                    <form method="post" action="{% url 'votacion:cambiar_estado' votacion.pk %}">
                        {% csrf_token %}
                        <input type="hidden" name="nuevo_estado" value="BORRADOR">
                        <button type="submit" class="btn-secondary btn-xs">
                            Volver a borrador
                        </button>
                    </form>
                {% endif %}
            </div>
        </div>
    {% else %}
        <!-- Cuando aún no existe (creación) -->
        <div class="votacion-status-pill">
            <span class="status-dot status-draft"></span>
            Nueva (borrador)
        </div>
    {% endif %}
</div>


        <!-- TABS -->
<div class="votacion-tabs-bar">
    <button type="button"
            class="votacion-tab-btn active"
            onclick="openVotacionTab('tab-config', this)">
        Configuración general
    </button>

    <button type="button"
            class="votacion-tab-btn"
            onclick="openVotacionTab('tab-quorum', this)">
        Quórum y asistencia
    </button>

    <button type="button"
            class="votacion-tab-btn"
            onclick="openVotacionTab('tab-fechas', this)">
        Fechas y opciones
    </button>

    <button type="button"
            class="votacion-tab-btn"
            onclick="openVotacionTab('tab-cargar', this)">
        Cargar candidatos
    </button>

    <button type="button"
            class="votacion-tab-btn"
            onclick="openVotacionTab('tab-vueltas', this)">
        Vueltas
    </button>   
</div>


        

        <div class="votacion-layout">
            <!-- CONTENIDO PRINCIPAL -->
            <div class="votacion-main">

                <!-- ========== FORM PRINCIPAL (Config + Quórum + Fechas) ========== -->
                <form method="post" novalidate>
                    {% csrf_token %}

                    <!-- BARRA SUPERIOR DE GUARDAR -->
                    <div class="form-actions form-actions-top">
                        <div class="form-actions-main">
                            <button type="submit"
                                    name="accion"
                                    value="guardar_votacion"
                                    class="btn-primary"
                                    style="justify-content:center; max-width:260px;">
                                <span class="material-icons" style="font-size: 18px;">save</span>
                                Guardar configuración
                            </button>
                            {% if es_nueva %}
                                <p class="form-actions-help">
                                    Guarda al menos una vez para poder gestionar las
                                    <strong>vueltas</strong>.
                                </p>
                            {% else %}
                                <p class="form-actions-help">
                                    Puedes actualizar los datos generales y luego seguir con las vueltas.
                                </p>
                            {% endif %}
                        </div>
                    </div>

                    <!-- ========== TAB: CONFIGURACIÓN GENERAL ========== -->
                    <div id="tab-config" class="votacion-tab-content" style="display:block;">
                        <h3 class="tab-title">Configuración general</h3>
                        <p class="tab-description">
                            Define el nombre de la elección, su tipo, estado y regla de ganador.
                        </p>

                        <!-- BLOQUE 1: DATOS BÁSICOS -->
                        <div class="form-section">
                            <h4 class="tab-subtitle">Datos básicos</h4>
                            <div class="form-grid">
                            <div class="form-grid grid-2">
                                <div class="form-field">
                                    <label>Nombre de la elección</label>
                                    {{ form.nombre }}
                                </div>

                                <div class="form-field">
                                    <label>Tipo de votación</label>
                                    {{ form.tipo }}
                                </div>
                            </div>


                                <div class="form-field">
                                    <label for="id_regla_ganador" style="display:flex; align-items:center; gap:6px;">
                                        Regla de votación
                                        <a href="{% url 'votacion:documentacion_sistemas_votacion' %}"
                                           class="info-badge"
                                           target="_blank"
                                           title="Ver explicación de los sistemas de votación">
                                            ⓘ
                                        </a>
                                    </label>
                                    {{ form.regla_ganador }}
                                </div>

                                <div class="form-field">
                                    <label>Número de cargos</label>
                                    {{ form.numero_cargos }}
                                    <div class="field-help">Ej.: 3 diáconos, 2 líderes…</div>
                                </div>

                                {% if form.edad_minima_candidato %}
                                <div class="form-field">
                                    <label>Edad mínima del candidato</label>
                                    {{ form.edad_minima_candidato }}
                                    <div class="field-help">Ej.: 18 años</div>
                                </div>
                                {% endif %}

                                <div class="form-field form-field-full">
                                    <label>Observaciones internas</label>
                                    {{ form.observaciones_internas }}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ========== TAB: QUÓRUM Y ASISTENCIA (VERSIÓN SIMPLE) ========== -->
                    <div id="tab-quorum" class="votacion-tab-content" style="display:none;">
                        <h3 class="tab-title">Quórum y asistencia</h3>
                        <p class="tab-description">
                            Indica cuántos pueden votar, cuántos están presentes y el mínimo de votos requeridos.
                        </p>

                        <div class="quorum-simple-grid">

                            <!-- TARJETA 1: HABILITADOS -->
                            <div class="q-card q-card-highlight">
                                <div class="q-card-label">Miembros con derecho a voto</div>
                                <div class="q-card-value">
                                    {{ form.total_habilitados.value|default:"—" }}
                                </div>
                                <div class="q-card-help">
                                    Miembros oficiales activos que cumplen la edad mínima del sistema.
                                </div>

                                <!-- Campo real oculto para el POST -->
                                <div style="display:none;">
                                    {{ form.total_habilitados }}
                                </div>
                            </div>

                            <!-- TARJETA 2: PRESENTES -->
                            <div class="q-card">
                                <div class="q-card-label">Miembros presentes hoy</div>
                                <div class="q-card-field">
                                    {{ form.miembros_presentes }}
                                </div>
                                <div class="q-card-help">
                                    Cuántos de los habilitados están físicamente presentes en el local.
                                </div>
                            </div>

                            <!-- TARJETA 3: REGLA DE QUÓRUM -->
                            <div class="q-card q-card-full">
                                <div class="q-card-header-row">
                                    <div class="q-card-title">Regla de quórum</div>
                                    <div class="q-card-pill">Define la base y el mínimo requerido</div>
                                </div>

                                <div class="q-card-grid">
                                    <div class="form-field">
                                        <label>Base</label>
                                        {{ form.base_quorum }}
                                        <div class="field-help">
                                            Habilitados = todos los que pueden votar.  
                                            Presentes = solo los que están hoy.
                                        </div>
                                    </div>

                                    <div class="form-field">
                                        <label>Tipo</label>
                                        {{ form.tipo_quorum }}
                                        <div class="field-help">
                                            Porcentaje o cantidad fija de personas.
                                        </div>
                                    </div>

                                    <div class="form-field">
                                        <label>Valor</label>
                                        {{ form.valor_quorum }}
                                        <div class="field-help">
                                            Si es porcentaje, número entre 1 y 100.  
                                            Si es cantidad, cuántas personas mínimo.
                                        </div>
                                    </div>
                                </div>

                                <div class="q-card-result-row">
                                    <div class="q-card-result-label">Votos mínimos requeridos</div>
                                    <div class="q-card-result-field">
                                        {{ form.votos_minimos_requeridos }}
                                    </div>
                                    <div class="q-card-result-help">
                                        El sistema calculará aquí el mínimo de votos según la base y el valor configurados.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ========== TAB: FECHAS Y OPCIONES ADICIONALES ========== -->
                    <div id="tab-fechas" class="votacion-tab-content" style="display:none;">
                        <h3 class="tab-title">Fechas y opciones adicionales</h3>
                        <p class="tab-description">
                            Define el periodo de la elección y algunas opciones adicionales.
                        </p>

                        <div class="form-section">
                            <div class="form-grid">
                                <div class="form-field">
                                    <label>Fecha inicio</label>
                                    {{ form.fecha_inicio }}
                                </div>

                                <div class="form-field">
                                    <label>Fecha cierre</label>
                                    {{ form.fecha_fin }}
                                </div>

                                <div class="form-field">
                                    <label>{{ form.permite_empates }} Permitir empates</label>
                                </div>

                                <div class="form-field">
                                    <label>{{ form.permite_voto_remoto }} Permitir voto remoto</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>

                <!-- ========== TAB: CARGAR CANDIDATOS ========== -->
<div id="tab-cargar" class="votacion-tab-content" style="display:none;">

    <h3 class="tab-title">Cargar candidatos desde una lista</h3>

    <p class="tab-description">
        Selecciona una lista de candidatos previamente creada y confirmada.
        Todos los miembros de esa lista se cargarán como candidatos en esta elección.
    </p>

    {% if not votacion %}
        <p class="section-help">
            Guarda primero la votación para habilitar esta sección.
        </p>
    {% else %}

        <form method="post" action="{% url 'votacion:cargar_candidatos_desde_lista' votacion.pk %}">
            {% csrf_token %}

            <div class="form-grid grid-2" style="margin-top:12px;">
                <div class="form-field">
                    <label for="id_lista_candidatos">Lista de candidatos</label>
                    <select name="lista_candidatos_id" id="id_lista_candidatos">
                        <option value="">Selecciona una lista…</option>
                        {% for lista in listas_candidatos_disponibles %}
                            <option value="{{ lista.pk }}">
                                {{ lista.nombre }} — {{ lista.items.count }} miembros
                            </option>
                        {% empty %}
                            <option value="">No hay listas confirmadas disponibles</option>
                        {% endfor %}
                    </select>
                    <div class="field-help">
                        Solo se muestran listas confirmadas.
                    </div>
                </div>

                <div class="form-field" style="align-self:flex-end;">
                    <button type="submit" class="btn-secondary">
                        <span class="material-icons" style="font-size:18px;">download</span>
                        Cargar lista
                    </button>
                </div>
            </div>
        </form>

    {% endif %}
</div>


                <!-- ========== TAB: VUELTAS ========== -->
                <div id="tab-vueltas" class="votacion-tab-content" style="display:none;">
                    <h3 class="tab-title">Vueltas de esta elección</h3>
                    <p class="tab-description">
                        Cada vuelta representa una ronda de votación. Puedes agregar nuevas vueltas según las reglas definidas.
                    </p>

                    {% if es_nueva or not votacion %}
                        <p class="section-help">
                            Primero debes <strong>guardar la configuración general</strong> de la votación
                            usando el botón <strong>“Guardar configuración”</strong> de arriba para poder gestionar las vueltas.
                        </p>
                    {% else %}
                        <div class="form-actions" style="justify-content:flex-end; margin-bottom:10px;">
                            <form method="post" action="{% url 'votacion:agregar_ronda' votacion.pk %}">
                                {% csrf_token %}
                                <button type="submit" class="btn-secondary">
                                    <span class="material-icons" style="font-size:18px;">add</span>
                                    Nueva vuelta
                                </button>
                            </form>
                        </div>

                        {% with votacion.rondas.all as rondas %}
                            {% if rondas %}
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Nombre</th>
                                            <th>Estado</th>
                                            <th>Votos</th>
                                            <th>Inicio</th>
                                            <th>Cierre</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for ronda in rondas %}
                                        <tr>
                                            <td>{{ ronda.numero }}</td>
                                            <td>
                                                {% if ronda.numero == 1 %}
                                                    Primera vuelta
                                                {% elif ronda.numero == 2 %}
                                                    Segunda vuelta
                                                {% else %}
                                                    Vuelta {{ ronda.numero }}
                                                {% endif %}
                                                {% if ronda.nombre %} - {{ ronda.nombre }}{% endif %}
                                            </td>
                                            <td>
                                                {% if ronda.estado == "ABIERTA" %}
                                                    <span class="badge-soft badge-soft-success">Abierta</span>
                                                {% elif ronda.estado == "CERRADA" %}
                                                    <span class="badge-soft badge-soft-muted">Cerrada</span>
                                                {% else %}
                                                    <span class="badge-soft badge-soft-warning">Borrador</span>
                                                {% endif %}
                                            </td>
                                            <td>{{ ronda.votos.count }}</td>
                                            <td>{{ ronda.fecha_inicio|default:"—" }}</td>
                                            <td>{{ ronda.fecha_fin|default:"—" }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            {% else %}
                                <p class="section-help">Aún no hay vueltas registradas.</p>
                            {% endif %}
                        {% endwith %}
                    {% endif %}
                </div>
            </div>


            <!-- ASIDE / AYUDA -->
            <aside class="votacion-aside">
                <div class="aside-card">
                    <h4>Consejos rápidos</h4>
                    <ul>
                        <li>Primero define <strong>nombre, tipo y regla</strong> en Configuración general.</li>
                        <li>Luego ajusta el <strong>quórum y la asistencia</strong>.</li>
                        <li>Configura las <strong>fechas</strong> y opciones como empates o voto remoto.</li>
                        <li>Después de guardar, pasa a <strong>Vueltas</strong>.</li>
                    </ul>
                </div>

                <div class="aside-card">
                    <h4>Estado de la elección</h4>
                    <p class="votacion-card-subtitle" style="margin-bottom:6px;">
                        Usa el estado <strong>Borrador</strong> mientras preparas todo.
                    </p>
                    <p class="votacion-card-subtitle">
                        Cuando todo esté listo, cambia a <strong>Abierta</strong> para empezar la votación.
                    </p>
                </div>
            </aside>
        </div>
    </div>
</section>

<script>
    // Mantener scroll
    if ('scrollRestoration' in history) {
        history.scrollRestoration = 'manual';
    }
    window.addEventListener("beforeunload", function () {
        localStorage.setItem("scrollPos", window.scrollY);
    });
    window.addEventListener("load", function () {
        const pos = localStorage.getItem("scrollPos");
        if (pos) window.scrollTo(0, parseInt(pos));
    });

    // TABS
    function openVotacionTab(tabId, btn) {
        // Ocultar todas las tabs
        document.querySelectorAll('.votacion-tab-content').forEach(function (tab) {
            tab.style.display = 'none';
        });

        // Quitar active de todos los botones
        document.querySelectorAll('.votacion-tab-btn').forEach(function (b) {
            b.classList.remove('active');
        });

        // Mostrar tab seleccionada
        const target = document.getElementById(tabId);
        if (target) {
            target.style.display = 'block';
        }

        // Activar botón
        if (btn) {
            btn.classList.add('active');
        } else {
            // Si viene de ?tab=..., intenta buscar el botón por su onclick
            document.querySelectorAll('.votacion-tab-btn').forEach(function (b) {
                const onclick = b.getAttribute('onclick') || "";
                if (onclick.includes("'" + tabId + "'")) {
                    b.classList.add('active');
                }
            });
        }
    }

    // Permitir abrir una pestaña específica con ?tab=...
    document.addEventListener('DOMContentLoaded', function () {
        const params = new URLSearchParams(window.location.search);
        const tabParam = params.get('tab');

        if (tabParam === 'vueltas') {
            openVotacionTab('tab-vueltas', null);
        } else if (tabParam === 'quorum') {
            openVotacionTab('tab-quorum', null);
        } else if (tabParam === 'fechas') {
            openVotacionTab('tab-fechas', null);
        } else {
            // Por defecto, configuración general
            openVotacionTab('tab-config', null);
        }
    });
</script>

<script>
    // ===== CÁLCULO PREVIO DEL QUÓRUM EN EL NAVEGADOR =====
    function recalcularQuorumPreview() {
        const baseField = document.getElementById("id_base_quorum");
        const tipoField = document.getElementById("id_tipo_quorum");
        const valorField = document.getElementById("id_valor_quorum");
        const totalHabilitadosField = document.getElementById("id_total_habilitados");
        const presentesField = document.getElementById("id_miembros_presentes");
        const votosMinField = document.getElementById("id_votos_minimos_requeridos");

        if (!baseField || !tipoField || !valorField || !votosMinField) {
            return;
        }

        const base = baseField.value;
        const tipo = tipoField.value;
        const valor = parseFloat((valorField.value || "").replace(",", "."));

        let baseNumero = 0;

        if (base === "HABILITADOS" && totalHabilitadosField) {
            baseNumero = parseInt(totalHabilitadosField.value || "0", 10);
        } else if (base === "PRESENTES" && presentesField) {
            baseNumero = parseInt(presentesField.value || "0", 10);
        }

        if (!tipo || tipo === "NINGUNO" || isNaN(valor) || baseNumero <= 0) {
            votosMinField.value = "";
            return;
        }

        let resultado = 0;

        if (tipo === "PORCENTAJE") {
            const porcentaje = Math.max(0, Math.min(valor, 100));
            resultado = Math.ceil(baseNumero * (porcentaje / 100));
        } else if (tipo === "CANTIDAD") {
            resultado = Math.max(0, Math.floor(valor));
        }

        votosMinField.value = resultado;
    }

    document.addEventListener("DOMContentLoaded", function () {
        const ids = [
            "id_base_quorum",
            "id_tipo_quorum",
            "id_valor_quorum",
            "id_total_habilitados",
            "id_miembros_presentes"
        ];

        ids.forEach(function (id) {
            const el = document.getElementById(id);
            if (el) {
                el.addEventListener("change", recalcularQuorumPreview);
                el.addEventListener("keyup", recalcularQuorumPreview);
            }
        });

        // Calcula una primera vez al cargar la página
        recalcularQuorumPreview();
    });
</script>

<!-- ===========================
     ESTILOS LOCALES
=========================== -->
<style>
    .votacion-config-wrapper {
        margin-top: 10px;
    }

    .votacion-card {
        background: #ffffff;
        border-radius: 16px;
        padding: 18px 18px 20px;
        box-shadow: 0 10px 25px rgba(15,23,42,0.08);
        border: 1px solid #e5e7eb;
    }

    .votacion-card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
        margin-bottom: 16px;
    }

    .votacion-card-header h2 {
        margin: 0;
        font-size: 18px;
        color: #111827;
    }

    .votacion-card-subtitle {
        margin: 4px 0 0;
        font-size: 12px;
        color: #6b7280;
    }

    .votacion-status-pill {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 11px;
        background: #eff6ff;
        color: #1d4ed8;
        border: 1px solid #bfdbfe;
        white-space: nowrap;
    }

    .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 999px;
        background: #22c55e;
    }

    .votacion-tabs-bar {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        background: #f3f4f6;
        padding: 6px;
        border-radius: 999px;
        margin-bottom: 16px;
    }

    .votacion-tab-btn {
        border: none;
        background: transparent;
        padding: 6px 12px;
        border-radius: 999px;
        font-size: 12px;
        cursor: pointer;
        color: #4b5563;
        display: inline-flex;
        align-items: center;
    }

    .votacion-tab-btn.active {
        background: #ffffff;
        color: #111827;
        box-shadow: 0 2px 6px rgba(15,23,42,0.12);
    }

    .votacion-layout {
        display: grid;
        grid-template-columns: minmax(0, 3fr) minmax(220px, 1.2fr);
        gap: 18px;
        align-items: flex-start;
    }

    .votacion-main {
        min-width: 0;
    }

    .votacion-aside {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .aside-card {
        background: #f9fafb;
        border-radius: 12px;
        padding: 10px 12px;
        border: 1px solid #e5e7eb;
        margin-bottom: 10px;
        font-size: 12px;
        color: #4b5563;
    }

    .aside-card h4 {
        margin: 0 0 6px;
        font-size: 13px;
        color: #111827;
    }

    .aside-card ul {
        padding-left: 18px;
        margin: 0;
    }

    .aside-card ul li {
        margin-bottom: 4px;
    }

    .tab-title {
        margin: 0 0 4px;
        font-size: 15px;
        color: #111827;
    }

    .tab-description {
        margin: 0 0 12px;
        font-size: 12px;
        color: #6b7280;
    }

    .tab-subtitle {
        margin: 0 0 6px;
        font-size: 13px;
        color: #111827;
    }

    .form-section {
        margin-bottom: 16px;
        padding-bottom: 8px;
        border-bottom: 1px dashed #e5e7eb;
    }

    .form-section:last-of-type {
        border-bottom: none;
    }

    .section-help {
        font-size: 13px;
        color: var(--color-text-muted, #6b7280);
    }

    .field-help {
        font-size: 12px;
        color: var(--color-text-muted, #6b7280);
        margin-top: 2px;
    }

    /* Barra superior de guardar */
    .form-actions-top {
        display: flex;
        justify-content: flex-start;
        margin-bottom: 12px;
        padding: 8px 10px;
        border-radius: 10px;
        background: #f9fafb;
        border: 1px solid #e5e7eb;
    }

    .form-actions-main {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .form-actions-help {
        font-size: 12px;
        color: #6b7280;
        margin: 0;
    }

    /* Botón info sistemas */
    .info-badge {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: rgba(25, 135, 84, 0.12);
        color: var(--primary, #198754);
        font-size: 12px;
        font-weight: 700;
        text-decoration: none;
        cursor: pointer;
        transition: 0.2s ease;
    }

    .info-badge:hover {
        background: var(--primary, #198754);
        color: #ffffff;
    }

    .subsection-title {
        margin: 0 0 4px;
        font-size: 14px;
        font-weight: 600;
    }

    /* --- QUÓRUM SIMPLE --- */
    .quorum-simple-grid {
        display: grid;
        grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.1fr);
        grid-auto-rows: 1fr;
        gap: 12px;
        margin-top: 8px;
    }

    .q-card {
        background: #f9fafb;
        border-radius: 12px;
        border: 1px solid #e5e7eb;
        padding: 10px 12px;
        font-size: 12px;
        color: #4b5563;
        display: flex;
        flex-direction: column;
        gap: 6px;
    }

    .q-card-highlight {
        background: #eff6ff;
        border-color: #bfdbfe;
    }

    .q-card-full {
        grid-column: 1 / -1;
    }

    .q-card-label {
        font-size: 12px;
        font-weight: 600;
        color: #111827;
    }

    .q-card-value {
        font-size: 24px;
        font-weight: 700;
        color: #111827;
        line-height: 1.1;
    }

    .q-card-field input,
    .q-card-field select,
    .q-card-grid select,
    .q-card-grid input {
        width: 100%;
    }

    .q-card-help {
        font-size: 11px;
        color: #6b7280;
    }

    .q-card-header-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 8px;
    }

    .q-card-title {
        font-size: 13px;
        font-weight: 600;
        color: #111827;
    }

    .q-card-pill {
        font-size: 10px;
        padding: 2px 8px;
        border-radius: 999px;
        background: #eef2ff;
        color: #4338ca;
        border: 1px solid #e0e7ff;
        white-space: nowrap;
    }

    .q-card-grid {
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 10px;
        margin-top: 4px;
    }

    .q-card-result-row {
        margin-top: 10px;
        padding-top: 8px;
        border-top: 1px dashed #e5e7eb;
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .q-card-result-label {
        font-size: 12px;
        font-weight: 600;
        color: #111827;
    }

    .q-card-result-field input {
        width: 160px;
        max-width: 100%;
    }

    .q-card-result-help {
        font-size: 11px;
        color: #6b7280;
    }

    /* Responsive */
    @media (max-width: 900px) {
        .votacion-layout {
            grid-template-columns: 1fr;
        }

        .votacion-aside {
            flex-direction: column-reverse;
        }

        .votacion-tabs-bar {
            border-radius: 12px;
        }

        .votacion-card-header {
            flex-direction: column;
            align-items: flex-start;
        }

        .form-actions-top {
            flex-direction: column;
            align-items: stretch;
        }

        .quorum-simple-grid {
            grid-template-columns: 1fr;
        }

        .q-card-full {
            grid-column: 1 / 2;
        }
    }

    .estado-wrapper {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 6px;
}

.estado-actions {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
    justify-content: flex-end;
}

.btn-xs {
    font-size: 11px;
    padding: 4px 8px;
    border-radius: 999px;
}

/* Colores según estado */
.status-dot.status-open {
    background: #22c55e; /* verde */
}

.status-dot.status-closed {
    background: #6b7280; /* gris */
}

.status-dot.status-draft {
    background: #f59e0b; /* naranja */
}
.form-grid.grid-2 {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
}


</style>

{% endblock %}
